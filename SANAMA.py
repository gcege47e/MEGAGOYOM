from flask import Flask, render_template_string, request, redirect, url_for, flash, jsonify
from flask_sqlalchemy import SQLAlchemy
from flask_login import LoginManager, UserMixin, login_user, logout_user, login_required, current_user
from werkzeug.security import generate_password_hash, check_password_hash
from flask_socketio import SocketIO, join_room, leave_room, emit
import datetime
import base64
import os

# Flask app setup
app = Flask(__name__)
app.config['SECRET_KEY'] = 'a1b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6e7f8a9b0c1d2e3f4a5b6c7d8e9f0a1b2'
app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///places.db'
app.config['SQLALCHEMY_TRACK_MODIFICATIONS'] = False

# Extensions
db = SQLAlchemy(app)
login_manager = LoginManager()
login_manager.init_app(app)
socketio = SocketIO(app, cors_allowed_origins="*")

# Data lists
CITIES = [
    "ุดูุฑฺฉ ุตุฏุฑุง", "ุดูุฑฺฉ ฺฏูุณุชุงู", "ูุนุงู ุขุจุงุฏ", "ุดูุฑฺฉ ฺฉุดู", "ุดูุฑฺฉ ููุฏู",
    "ุดูุฑฺฉ ุฒูุจู", "ุดูุฑฺฉ ุจุนุซุช", "ุดูุฑฺฉ ูุงููุฌุฑ", "ุดูุฑฺฉ ุตูุนุช ุนูู ุขุจุงุฏ",
    "ฺฉู ุงูุงู ุฑุถุง", "ุดูุฑฺฉ ฺฏูู", "ุดูุฑฺฉ ุจุฒู", "ุดูุฑฺฉ ุฑุญูุช ุขุจุงุฏ", "ุดูุฑฺฉ ุฎูุฑุดุฏ",
    "ุดูุฑฺฉ ุณูุงูุช", "ุดูุฑฺฉ ูุฑููฺฏุงู", "ฺฉู ุฒุงฺฏุฑุณ", "ฺฉู ูพุงุณุฏุงุฑุงู", "ุดูุฑฺฉ ุนุฑูุงู",
    "ุดูุฑฺฉ ููุฑุณุชุงู"
]

CATEGORIES = {
    "๐ฝ๏ธ ุฎูุฑุงฺฉ ู ููุดุฏู": [
        "ุฑุณุชูุฑุงูโูุง (ุณูุชุ ูุณุช ููุฏุ ุจูโุงููููุ ุฏุฑุงุ ฺฏุงูุฎูุงุฑ)",
        "ฺฉุงูู ู ฺฉุงูโุดุงูพ (ฺฉุงููโุฑุณุชูุฑุงูุ ูููู ุชุฎุตุต)",
        "ุจุณุชูโูุฑูุด ู ุขุจูููโูุฑูุด (ุจุณุชู ุณูุชุ ุจุณุชู ุงุชุงูุง)",
        "ุดุฑูโูพุฒ ู ูุงููุง (ูุงููุง ุณูุชุ ุดุฑูโูพุฒ ููุงุฏ)",
        "ุณูุฑูโุฎุงูู ู ฺุงุฎุงูู (ูููู ุฎุงูู ุณูุชุ ฺุงุฎุงูู ูุฏุฑู)",
        "ููุฏฺฉูุฑุช ู ูุฑุงฺฉุฒ ุบุฐุงุฎูุฑ",
        "ฺฉุจุงุจ ู ุฌฺฏุฑฺฉ (ฺฉุจุงุจโูุฑูุดุ ุฌฺฏุฑฺฉุ ุฏุฒโุณุฑุง)",
        "ุณุงูุฏูฺโูุฑูุด ู ูพุชุฒุงูุฑูุด (ูพุชุฒุงูุฑูุดุ ุณุงูุฏูฺโูุฑูุด ูุญู)",
        "ููุงุฏ ู ุดฺฉูุงุชโูุฑูุด (ุดฺฉูุงุชโูุฑูุด ุชุฎุตุตุ ุขุจูุจุงุชโูุฑูุด)",
        "ุขุฌูโูุฑูุด ู ุฎุดฺฉุจุงุฑ (ุขุฌูโูุฑูุดุ ุฎุดฺฉุจุงุฑูุฑูุด)",
        "ุณููพุฑูุงุฑฺฉุช ูุญู ู ูุงูพุฑ",
        "ูุตุงุจ ู ูุฑุบ ูุฑูุด (ูุตุงุจุ ูุฑุบโูุฑูุดุ ูุงูโูุฑูุด)",
        "ูููโูุฑูุด ู ุชุฑูโุจุงุฑ (ูููโูุฑูุดุ ุณุจุฒโูุฑูุด)",
        "ูุงูโูุฑูุด ู ุบุฐุงูุง ุฏุฑุง",
        "ูุฑูุดฺฏุงู ููุงุฏ ุบุฐุง ูุญู",
        "ุนุณูโูุฑูุด ู ูุญุตููุงุช ุฒูุจูุฑุฏุงุฑ",
        "ูุญุตููุงุช ูุญู ู ููุทููโุง",
        "ูุฑูุดฺฏุงู ูุญุตููุงุช ุงุฑฺฏุงูฺฉ",
        "ูุฑูุดฺฏุงู ููุงุฏ ุบุฐุง ููุฌูุฏ",
        "ูุฑูุดฺฏุงู ูุญุตููุงุช ูุจู ู ูพูุฑ",
        "ูุงูโูุฑูุด ุชุฎุตุต (ูุงู ุจุงฺฏุชุ ูุงู ุณูฺฏฺฉ)",
        "ุบุฐุงูุง ูุญู ู ุบุฐุงูุง ููู"
    ],
    "๐๏ธ ุฎุฑุฏ ู ูุฑูุด": [
        "ูพุงุณุงฺูุง ู ูุฑุงฺฉุฒ ุฎุฑุฏ (ูุงูุ ูุฑฺฉุฒ ุฎุฑุฏุ ุจุงุฒุงุฑฺู)",
        "ุณููพุฑูุงุฑฺฉุช ู ูุงูพุฑูุงุฑฺฉุช (ุฒูุฌุฑูโุงุ ูุญู)",
        "ูุฑูุดฺฏุงู ุฒูุฌุฑูโุง",
        "ุจุงุฒุงุฑ ุณูุช ู ุจุงุฒุงุฑฺูโูุง ูุญู (ุจุงุฒุงุฑ ุฑูุฒุ ุจุงุฒุงุฑ ููุชฺฏ)",
        "ูุฑูุดฺฏุงู ูพูุดุงฺฉ ู ฺฉู ู ฺฉูุด (ูุจุงุณ ูุฑุฏุงููุ ุฒูุงููุ ุจฺฺฏุงูู)",
        "ูุฑูุดฺฏุงู ููุงุฒู ุฎุงูฺฏ ู ุงูฺฉุชุฑููฺฉ (ููุงุฒู ุจุฑูุ ุฏุฌุชุงู)",
        "ูุฑูุดฺฏุงู ููุงุฒู ูุฑุฒุด (ูุฑุฒุดุ ฺฉููููุฑุฏุ ุดูุง)",
        "ฺฉุชุงุจโูุฑูุด ู ููุงุฒู ุงูุชุญุฑุฑ (ฺฉุชุงุจโูุฑูุด ุนูููุ ุชุฎุตุต)",
        "ูุบุงุฒู ููุจุงู ู ููพโุชุงูพ (ูุฑูุดุ ุชุนูุฑุ ููุงุฒู ุฌุงูุจ)",
        "ฺฏูโูุฑูุด ู ฺฏุงูุงู ุขูพุงุฑุชูุงู (ฺฏูโูุฑูุดุ ฺฏูโุขุฑุง)",
        "ุนูฺฉโูุฑูุด ู ุงูพุชฺฉ (ุนูฺฉโูุฑูุดุ ุนูฺฉโุณุงุฒ)",
        "ุนุทุฑ ู ุงุฏฺฉูู ูุฑูุด (ุนุทุฑ ูุฑูุดุ ูุญุตููุงุช ุขุฑุงุด)",
        "ุทูุง ู ุฌูุงูุฑ ูุฑูุด (ุทูุงูุฑูุดุ ุฌูุงูุฑูุฑูุด)",
        "ุณุงุนุชโูุฑูุด (ุณุงุนุช ูฺุ ุฏูุงุฑ)",
        "ููุงุฒู ุขุฑุงุด ู ุจูุฏุงุดุช (ุขุฑุงุดุ ุจูุฏุงุดุชุ ูุฑุงูุจุช ูพูุณุช)",
        "ุงุณุจุงุจโุจุงุฒโูุฑูุด (ุงุณุจุงุจโุจุงุฒุ ุจุงุฒ ูฺฉุฑ)",
        "ุตูุงุนโุฏุณุช ู ุณูุบุงุชโูุฑูุด (ุตูุงุน ุฏุณุชุ ุณูุบุงุช)",
        "ุฏฺฉูุฑุงุณูู ู ููุงุฒู ููุฒู (ุฏฺฉูุฑุงุณููุ ููุงุฒู ุชุฒุฆู)",
        "ูุฑุด ู ฺฏูู ูุฑูุด (ูุฑุดโูุฑูุดุ ฺฏููโูุฑูุด)",
        "ูพุงุฑฺูโูุฑูุด ู ุฎุงุท (ูพุงุฑฺูโูุฑูุดุ ุฎุงุท)",
        "ฺุฑูโูุฑูุด ู ฺฉูโุณุงุฒ (ฺุฑูโูุฑูุดุ ฺฉูโุฏูุฒ)",
        "ูุฑูุดฺฏุงู ููุงุฒู ุขุดูพุฒุฎุงูู (ุธุฑููุ ููุงุฒู ุขุดูพุฒ)",
        "ูุฑูุดฺฏุงู ููุงุฒู ุจุงุบุจุงู (ููุงุฒู ุจุงุบุจุงูุ ููุงู)",
        "ูุฑูุดฺฏุงู ุญูุงูุงุช ุฎุงูฺฏ (ุญูุงูุงุชุ ุบุฐุง ุญูุงูุงุช)",
        "ูุฑูุดฺฏุงู ุฏูฺุฑุฎู ู ุงุณฺฉูุชุฑ (ุฏูฺุฑุฎูุ ุงุณฺฉูุชุฑุ ููุงุฒู)",
        "ูุฑูุดฺฏุงู ุงุจุฒุงุฑุขูุงุช (ุงุจุฒุงุฑ ุตูุนุชุ ุฏุณุช)",
        "ูุฑูุดฺฏุงู ฺฉุงููพูุชุฑ ู ฺฏู (ฺฉุงููพูุชุฑุ ฺฉูุณูู ุจุงุฒ)",
        "ูุฑูุดฺฏุงู ูุจุงุณ ุนุฑูุณ ู ูุฑุงุณู",
        "ูุฑูุดฺฏุงู ฺฉุงุฏู ู ูุฏู",
        "ูุฑูุดฺฏุงู ูุญุตููุงุช ูุฑููฺฏ (ุณ ุฏุ ุฏ ู ุฏุ ุขุซุงุฑ ููุฑ)",
        "ูุฑูุดฺฏุงู ูุญุตููุงุช ุฏุณุชโุฏูู",
        "ูุฑูุดฺฏุงู ูุญุตููุงุช ุณูุงูุช ู ุชูุฏุฑุณุช",
        "ูุฑูุดฺฏุงู ูุญุตููุงุช ุฑูุณุชุง ู ูุญู"
    ],
    "โ๏ธ ุฒุจุง ู ุขุฑุงุด": [
        "ุขุฑุงุดฺฏุงู ูุฑุฏุงูู (ุขุฑุงุดฺฏุงูุ ุงุตูุงุญ)",
        "ุขุฑุงุดฺฏุงู ุฒูุงูู (ุขุฑุงุดุ ุฑูฺฏ ูู)",
        "ุณุงููโูุง ุฒุจุง ู ุงุณูพุง (ุงุณูพุงุ ูุงุณุงฺ)",
        "ูฺู ู ุงุจุฑู (ุงฺฉุณุชูุดู ูฺูุ ูฺฉุฑูุจูุฏูฺฏ)",
        "ูุงุฎูโฺฉุงุฑ (ูุงูฺฉูุฑุ ูพุฏฺฉูุฑุ ูุงุฎู ูุตููุน)",
        "ุชุชู ู ูฺฉุฑููพฺฏููุชุดู (ุชุงุชูุ ูฺฉุฑููพฺฏููุชุดู)",
        "ุณุงููโูุง ุชุงุชู ู ูพุฑุณูฺฏ (ูพุฑุณูฺฏุ ุชุงุชู ุญูุง)",
        "ูุฑุงฺฉุฒ ุฎุฏูุงุช ูพูุณุช ู ูู (ูพุงฺฉุณุงุฒ ูพูุณุชุ ูุฒุฑ)",
        "ูุฑูุดฺฏุงู ููุงุฒู ุขุฑุงุด ุญุฑููโุง",
        "ูุฑุงฺฉุฒ ูุงุณุงฺ ู ุฑูฺฉุณุดู (ูุงุณุงฺ ุฏุฑูุงูุ ุฑูฺฉุณุดู)",
        "ูุฑุงฺฉุฒ ุงูพูุงุณูู ู ูุฒุฑ",
        "ุณุงููโูุง ุจุฑูุฒู ฺฉุฑุฏู",
        "ูุฑุงฺฉุฒ ูุดุงูุฑู ุฒุจุง",
        "ุขููุฒุดฺฏุงูโูุง ุขุฑุงุดฺฏุฑ",
        "ูุฑุงฺฉุฒ ุฎุฏูุงุช ุจูุฏุงุดุช ูุฑุฏุงูู"
    ],
    "๐ฅ ุฏุฑูุงู ู ุณูุงูุช": [
        "ุจูุงุฑุณุชุงู ู ูุฑุงฺฉุฒ ุฏุฑูุงู (ุนูููุ ุชุฎุตุตุ ุฎุตูุต)",
        "ุฏุฑูุงูฺฏุงู ู ฺฉููฺฉโูุง ุชุฎุตุต (ุฎุงููุงุฏูุ ุฒูุงูุ ููุจ)",
        "ุฏุงุฑูุฎุงูู (ุดุจุงููโุฑูุฒุ ฺฏุงู)",
        "ุฏูุฏุงูโูพุฒุดฺฉ ู ุงุฑุชูุฏูุณ (ุนูููุ ุชุฎุตุตุ ุฒุจุง)",
        "ุขุฒูุงุดฺฏุงู ูพุฒุดฺฉ ู ุฑุงุฏูููฺ (ุขุฒูุงุดฺฏุงูุ ุณูููฺฏุฑุงู)",
        "ฺฉููฺฉ ุฒุจุง ู ูุฒุฑ (ูุฒุฑุ ุจูุชุงฺฉุณุ ฺู)",
        "ูุฑุงฺฉุฒ ูุฒูุชุฑุงูพ ู ฺฉุงุฑุฏุฑูุงู (ูุฒูุชุฑุงูพุ ฺฉุงุฑุฏุฑูุงู)",
        "ุฏุงููพุฒุดฺฉ ู ฺฉููฺฉ ุญูุงูุงุช (ุฏุงููพุฒุดฺฉุ ุญูุงูุงุช ุฎุงูฺฏ)",
        "ูุฑุงฺฉุฒ ุชูุงูุจุฎุด (ุชูุงูุจุฎุดุ ฺฏูุชุงุฑุฏุฑูุงู)",
        "ูุฑุงฺฉุฒ ูุดุงูุฑู ู ุฑูุงูุดูุงุณ (ูุดุงูุฑูุ ุฑูุงูุดูุงุณ)",
        "ุดููุงโุณูุฌ ู ุณูุนฺฉ (ุณูุนฺฉุ ุดููุงโุณูุฌ)",
        "ุจูุงโุณูุฌ ู ุนูฺฉโุณุงุฒ (ุจูุงโุณูุฌุ ุนูฺฉโุณุงุฒ)",
        "ูพุฑุณุชุงุฑ ุฏุฑ ููุฒู (ูพุฑุณุชุงุฑุ ูพุฒุดฺฉ ุฏุฑ ููุฒู)",
        "ุชุฌูุฒุงุช ูพุฒุดฺฉ (ูุฑูุดุ ุงุฌุงุฑู)",
        "ูุฑุงฺฉุฒ ุงูุฏุง ุฎูู",
        "ูุฑุงฺฉุฒ ุทุจ ุณูุช ู ฺฏุงูุงู ุฏุงุฑู",
        "ูุฑุงฺฉุฒ ูุงุณุงฺ ุฏุฑูุงู",
        "ูุฑุงฺฉุฒ ุชุฑฺฉ ุงุนุชุงุฏ",
        "ูุฑุงฺฉุฒ ุฎุฏูุงุช ูพุฑุณุชุงุฑ",
        "ูุฑุงฺฉุฒ ุฎุฏูุงุช ูพุฒุดฺฉ ุณุงุฑ",
        "ูุฑุงฺฉุฒ ุชุตูุฑุจุฑุฏุงุฑ ูพุฒุดฺฉ",
        "ูุฑุงฺฉุฒ ุฎุฏูุงุช ูพุฒุดฺฉ ูุฑุฒุด"
    ],
    "โฝ ูุฑุฒุด ู ุณุฑฺฏุฑู": [
        "ุจุงุดฺฏุงู ูุฑุฒุด ู ุจุฏูุณุงุฒ (ุจุฏูุณุงุฒุ ฺฉุฑุงุณูุช)",
        "ุงุณุชุฎุฑ ู ูุฌููุนู ูุฑุฒุด (ุงุณุชุฎุฑุ ุณููุงุ ุฌฺฉูุฒ)",
        "ุณุงูู ููุชุณุงู ู ุจุณฺฉุชุจุงู (ููุชุณุงูุ ุจุณฺฉุชุจุงูุ ูุงูุจุงู)",
        "ุณููุง ู ุชุฆุงุชุฑ (ุณููุงุ ุชุฆุงุชุฑุ ููุงุด)",
        "ุดูุฑุจุงุฒ ู ูพุงุฑฺฉ ุจุงุฒ (ุดูุฑุจุงุฒุ ูพุงุฑฺฉ ุจุงุฒ)",
        "ุจูุงุฑุฏ ู ุจูููฺฏ (ุจูุงุฑุฏุ ุจูููฺฏุ ุฏุงุฑุช)",
        "ูุฑุงฺฉุฒ ุชูุฑุญ ุฎุงููุงุฏฺฏ (ุชูุฑุญุ ุจุงุฒ)",
        "ูุฑุงฺฉุฒ ูุฑููฺฏ ู ููุฑ (ูุฑููฺฏุ ููุฑ)",
        "ุณุงููโูุง ฺฉูุณุฑุช ู ููุงุด (ฺฉูุณุฑุชุ ููุงุด)",
        "ฺฏูโูุช ู ูุฑุงฺฉุฒ ุจุงุฒ (ฺฏูโูุชุ ุจุงุฒ ฺฉุงููพูุชุฑ)",
        "ุจุงุดฺฏุงู ุชุฑุงูุฏุงุฒ (ุชุฑุงูุฏุงุฒุ ฺฉูุงูโุงูุฏุงุฒ)",
        "ุจุงุดฺฏุงู ุณููุง ู ุฎุงูู ููู",
        "ูุฑุงฺฉุฒ ุขููุฒุด ููุณู (ุขููุฒุด ููุณูุ ููุงุฒูุฏฺฏ)",
        "ฺฉุชุงุจุฎุงูู ุนููู (ุนูููุ ุชุฎุตุต)",
        "ูฺฏุงุฑุฎุงูู ู ููุงุดฺฏุงู ููุฑ (ูฺฏุงุฑุฎุงููุ ููุงุดฺฏุงู)",
        "ูุฑุงฺฉุฒ ุจุงุฒ ุงุชุงู ูุฑุงุฑ",
        "ูุฑุงฺฉุฒ ูพูุช ุจุงู ู ูุฒุฑุชฺฏ",
        "ุจุงุดฺฏุงูโูุง ุฑูุต ู ุจุงูู",
        "ูุฑุงฺฉุฒ ูฺฏุง ู ูุฏุชุดู",
        "ุจุงุดฺฏุงูโูุง ูุฑุฒุดโูุง ุฑุฒู",
        "ูุฑุงฺฉุฒ ุงุณฺฉุช ู ุฑููุฑ",
        "ุจุงุดฺฏุงูโูุง ุจูฺฉุณ ู ููุฑูุง ุฑุฒู ุชุฑฺฉุจ",
        "ูุฑุงฺฉุฒ ูุฑุฒุดโูุง ุขุจ",
        "ุจุงุดฺฏุงูโูุง ฺฏูู ู ุชูุณ",
        "ูุฑุงฺฉุฒ ูุงูฺฏุฑ ู ุดฺฉุงุฑ",
        "ุจุงุดฺฏุงูโูุง ุณูุงุฑฺฉุงุฑ"
    ],
    "๐จ ุงูุงูุช ู ุณูุฑ": [
        "ูุชู ู ูุชู ุขูพุงุฑุชูุงู (ูุชูุ ูุชู ุขูพุงุฑุชูุงู)",
        "ูุณุงูุฑุฎุงูู ู ูููุงููพุฐุฑ (ูุณุงูุฑุฎุงููุ ูููุงููพุฐุฑ)",
        "ุงูุงูุชฺฏุงู ุจููโฺฏุฑุฏ (ุจููโฺฏุฑุฏุ ุงูุงูุชฺฏุงู ูุญู)",
        "ููุง ู ุณูุฆุช ุงุฌุงุฑูโุง (ููุงุ ุณูุฆุช)",
        "ฺฉููพูฺฏ ู ุงุฑุฏูฺฏุงู (ฺฉููพูฺฏุ ุงุฑุฏูฺฏุงู)",
        "ุขฺุงูุณ ูุณุงูุฑุช ู ฺฏุฑุฏุดฺฏุฑ (ูุณุงูุฑุชุ ฺฏุฑุฏุดฺฏุฑ)",
        "ุงุณุชฺฏุงู ูุทุงุฑ ู ุงุชูุจูุณ (ูุทุงุฑุ ุงุชูุจูุณ)",
        "ูุฑูุฏฺฏุงู ู ูพุงุงูู ูุณุงูุฑ (ูุฑูุฏฺฏุงูุ ูพุงุงูู)",
        "ูุฑุงฺฉุฒ ุฑุฒุฑูุงุณูู (ุฑุฒุฑู ูุชูุ ุจูุท)",
        "ุฎุฏูุงุช ูุฒุง ู ูพุงุณูพูุฑุช (ูุฒุงุ ูพุงุณูพูุฑุช)",
        "ุงุฌุงุฑู ุฎูุฏุฑู ู ุฏูฺุฑุฎู (ุงุฌุงุฑู ูุงุดูุ ุฏูฺุฑุฎู)",
        "ุฑุงูููุงุงู ฺฏุฑุฏุดฺฏุฑ (ุชูุฑูุฏุฑุ ุฑุงูููุง)",
        "ูุฑุงฺฉุฒ ุงุทูุงุนุงุช ฺฏุฑุฏุดฺฏุฑ",
        "ุฎุฏูุงุช ุชุฑุฌูู ู ุฑุงูููุง ูุญู",
        "ูุฑุงฺฉุฒ ฺฉุฑุงู ุงุชููุจู",
        "ุฎุฏูุงุช ุงูุชูุงู ูุณุงูุฑ (ุญูู ู ูููุ ุชุฑุงูุณูุฑ)",
        "ูุฑุงฺฉุฒ ุฑุฒุฑูุงุณูู ุขููุงู",
        "ุฎุฏูุงุช ุจูู ูุณุงูุฑุช",
        "ูุฑุงฺฉุฒ ุฎุฏูุงุช ุฌูุงูฺฏุฑุฏ"
    ],
    "๐๏ธ ุฎุฏูุงุช ุนููู ู ุงุฏุงุฑ": [
        "ุจุงูฺฉ ู ุฎูุฏูพุฑุฏุงุฒ (ุจุงูฺฉุ ุตุฑุงู)",
        "ุงุฏุงุฑู ูพุณุช (ูพุณุชุ ูพฺฉ ููุชูุฑ)",
        "ุฏูุงุชุฑ ูพุดุฎูุงู ุฎุฏูุงุช ุฏููุช (ูพุดุฎูุงูุ ุฎุฏูุงุช ุงูฺฉุชุฑููฺฉ)",
        "ุดูุฑุฏุงุฑ ู ูุฑุงฺฉุฒ ุฎุฏูุงุช ุดูุฑ (ุดูุฑุฏุงุฑุ ุฎุฏูุงุช ุดูุฑ)",
        "ุงุฏุงุฑู ุจุฑูุ ุขุจุ ฺฏุงุฒ (ุจุฑูุ ุขุจุ ฺฏุงุฒ)",
        "ูพูุณ +ฑฐ ู ูุฑุงฺฉุฒ ุงูุชุธุงู (ูพูุณุ ุงูุชุธุงู)",
        "ุฏุงุฏฺฏุงู ู ูุฑุงุฌุน ูุถุง (ุฏุงุฏฺฏุงูุ ูุถุง)",
        "ฺฉูุงูุชุฑ ู ูพุงุณฺฏุงู (ฺฉูุงูุชุฑุ ูพุงุณฺฏุงู)",
        "ุฏูุงุชุฑ ุงุณูุงุฏ ุฑุณู (ุงุณูุงุฏ ุฑุณูุ ุฏูุชุฑุฎุงูู)",
        "ูุฑุงฺฉุฒ ุตุฏูุฑ ฺฏูุงููุงูู (ฺฏูุงููุงููุ ูุฏุงุฑฺฉ)",
        "ุงุฏุงุฑุงุช ุฏููุช ู ูุฒุงุฑุชุฎุงููโูุง (ุฏููุชุ ูุฒุงุฑุชุฎุงูู)",
        "ฺฉูุณููฺฏุฑ ู ุณูุงุฑุชุฎุงููโูุง (ุณูุงุฑุชุ ฺฉูุณููฺฏุฑ)",
        "ูุฑุงฺฉุฒ ุฎุฏูุงุช ุงูฺฉุชุฑููฺฉ (ุฎุฏูุงุช ุขููุงูุ ุฏููุช ุงูฺฉุชุฑููฺฉ)",
        "ูุฑุงฺฉุฒ ุฎุฏูุงุช ูุดุงูุฑู ุดุบู",
        "ุฏูุงุชุฑ ุฎุฏูุงุช ูุณฺฉู ู ุงููุงฺฉ",
        "ูุฑุงฺฉุฒ ุฎุฏูุงุช ุญููู ู ูุถุง",
        "ุฏูุงุชุฑ ุฎุฏูุงุช ููุงุฌุฑุช",
        "ูุฑุงฺฉุฒ ุฎุฏูุงุช ูุงู ู ุญุณุงุจุฏุงุฑ",
        "ุฏูุงุชุฑ ุฎุฏูุงุช ุจููโุง",
        "ูุฑุงฺฉุฒ ุฎุฏูุงุช ุชุนูุฑุงุช ุดูุฑ",
        "ุฏูุงุชุฑ ุฎุฏูุงุช ูพูุงูฺฉุงุฑ"
    ],
    "๐ ุฎุฏูุงุช ุดูุฑ ู ุญููโูููู": [
        "ูพููพ ุจูุฒู ู CNG (ุจูุฒูุ ฺฏุงุฒ)",
        "ฺฉุงุฑูุงุด ู ุฎุฏูุงุช ุฎูุฏุฑู (ฺฉุงุฑูุงุดุ ุจุฑุงูโุณุงุฒ)",
        "ุชุนูุฑฺฏุงู ุฎูุฏุฑู ู ููุชูุฑุณฺฉูุช (ุชุนูุฑฺฏุงูุ ูฺฉุงูฺฉ)",
        "ุชุงฺฉุณโุณุฑูุณ ู ุชุงฺฉุณ ุงูุชุฑูุช (ุชุงฺฉุณุ ุงุณููพ)",
        "ูพุงุฑฺฉูฺฏ ุนููู (ูพุงุฑฺฉูฺฏุ ุฌุง ูพุงุฑฺฉ)",
        "ูฺฉุงูฺฉ ู ุจุฑู ุฎูุฏุฑู (ูฺฉุงูฺฉุ ุจุฑู ุฎูุฏุฑู)",
        "ูุงุณุชฺฉโูุฑูุด ู ูุฑูุด ููุงุฒู ุฏฺฉ (ูุงุณุชฺฉุ ููุงุฒู ุฏฺฉ)",
        "ุฎุฏูุงุช ููุงุด ู ุชุฑูู ุฎูุฏุฑู (ููุงุดุ ุชุฑูู)",
        "ูุฑุงฺฉุฒ ูุนุงูู ูู (ูุนุงูู ููุ ุชุณุช ุฎูุฏุฑู)",
        "ุฎุฏูุงุช ุงูุฏุงุฏ ุฎูุฏุฑู (ุฎุฏูุงุช ุงูุฏุงุฏุ ุฏฺฉโฺฉุด)",
        "ููุงูุฏฺฏ ุฎูุฏุฑู (ููุงูุฏฺฏุ ูุฑูุด ุฎูุฏุฑู)",
        "ูุฑูุดฺฏุงู ููุงุฒู ุฌุงูุจ ุฎูุฏุฑู (ููุงุฒู ุฌุงูุจุ ุชุฒุฆูุงุช)",
        "ุฎุฏูุงุช ุชูุธู ููุชูุฑ ู ุงูฺฺฉุชูุฑ",
        "ุฎุฏูุงุช ุตุงูฺฉุงุฑ ู ุฌููุจูุฏ",
        "ุฎุฏูุงุช ุชุนูุถ ุฑูุบู ู ููุชุฑ",
        "ุฎุฏูุงุช ุณุณุชู ุชููู ู ฺฉููุฑ",
        "ุฎุฏูุงุช ุชุนูุฑุงุช ุชุฎุตุต ุฎูุฏุฑู",
        "ุฎุฏูุงุช ฺฉุงุฑุชโุฎูุงู ู ูพุฑุฏุงุฎุช",
        "ุฎุฏูุงุช ูพุฎุด ูุญุตููุงุช ุฎูุฏุฑู",
        "ุฎุฏูุงุช ุญูู ู ููู ูุนูููู ู ุณุงูููุฏุงู"
    ],
    "๐ ุขููุฒุด ู ูุฑููฺฏ": [
        "ูุฏุฑุณู ู ุขููุฒุดฺฏุงู (ุฏุจุณุชุงูุ ุฏุจุฑุณุชุงู)",
        "ุฏุงูุดฺฏุงู ู ูุฑุงฺฉุฒ ุขููุฒุด ุนุงู (ุฏุงูุดฺฏุงูุ ููุณุณู ุขููุฒุด ุนุงู)",
        "ุขููุฒุดฺฏุงู ุฒุจุงู (ุฒุจุงู ุงูฺฏูุณุ ุณุงุฑ ุฒุจุงูโูุง)",
        "ุขููุฒุดฺฏุงู ููโูุญุฑููโุง (ููุ ุญุฑููโุง)",
        "ฺฉุชุงุจุฎุงูู ุนููู (ุนูููุ ุชุฎุตุต)",
        "ูุฑููฺฏุณุฑุง ู ุฎุงูู ูุฑููฺฏ (ูุฑููฺฏุณุฑุงุ ุฎุงูู ูุฑููฺฏ)",
        "ููุฒู ู ฺฏุงูุฑ (ููุฒูุ ฺฏุงูุฑ ููุฑ)",
        "ูุฑุงฺฉุฒ ุขููุฒุด ฺฉุงููพูุชุฑ (ฺฉุงููพูุชุฑุ ุจุฑูุงููโููุณ)",
        "ูุฑุงฺฉุฒ ูุดุงูุฑู ุชุญุตู (ูุดุงูุฑูุ ุงูุชุฎุงุจ ุฑุดุชู)",
        "ุขููุฒุดฺฏุงูโูุง ููุฑ (ููุงุดุ ูุฌุณููโุณุงุฒ)",
        "ูุฑุงฺฉุฒ ุขููุฒุด ุฑุงููุฏฺฏ (ุขููุฒุด ุฑุงููุฏฺฏุ ุขูโูุงูู)",
        "ููุฏฺฉูุฏฺฉ ู ูพุดโุฏุจุณุชุงู (ููุฏฺฉูุฏฺฉุ ูพุดโุฏุจุณุชุงู)",
        "ูุฑุงฺฉุฒ ุขููุฒุด ุนููู ูุฎุชูู (ุฑุงุถุ ูุฒฺฉุ ุดู)",
        "ูุฑุงฺฉุฒ ุขููุฒุด ููุงุฑุชโูุง ุฒูุฏฺฏ",
        "ุขููุฒุดฺฏุงูโูุง ุขุดูพุฒ ู ุดุฑูโูพุฒ",
        "ูุฑุงฺฉุฒ ุขููุฒุด ุฎูุงูุช ฺฉูุฏฺฉุงู",
        "ุขููุฒุดฺฏุงูโูุง ฺฉูฺฉูุฑ ู ุขุฒููู",
        "ูุฑุงฺฉุฒ ุขููุฒุด ุงุฒ ุฑุงู ุฏูุฑ",
        "ุขููุฒุดฺฏุงูโูุง ููุงุฑุชโุขููุฒ",
        "ูุฑุงฺฉุฒ ุขููุฒุด ุตูุงุน ุฏุณุช",
        "ุขููุฒุดฺฏุงูโูุง ุฎุงุท ู ุทุฑุงุญ ูุจุงุณ",
        "ูุฑุงฺฉุฒ ุขููุฒุด ุนฺฉุงุณ ู ูููุจุฑุฏุงุฑ",
        "ุขููุฒุดฺฏุงูโูุง ูุฑุฒุด ุชุฎุตุต",
        "ูุฑุงฺฉุฒ ุขููุฒุด ููุณู ูุญู",
        "ุขููุฒุดฺฏุงูโูุง ุฒุจุงู ุงุดุงุฑู",
        "ุฎุฏูุงุช ุขููุฒุด ูุฌุงุฒ ู ุขููุงู"
    ],
    "๐ ูุฐูุจ ู ูุนูู": [
        "ูุณุฌุฏ ู ูุตู (ูุณุฌุฏุ ูุตู)",
        "ุญุณูู ู ูุฆุช (ุญุณููุ ูุฆุช)",
        "ฺฉูุณุง ู ูุฑุงฺฉุฒ ูุณุญ (ฺฉูุณุงุ ูุฑุงฺฉุฒ ูุณุญ)",
        "ฺฉูุณู ู ูุฑุงฺฉุฒ ููุฏ (ฺฉูุณูุ ูุฑุงฺฉุฒ ููุฏ)",
        "ูุนุงุจุฏ ู ูพุฑุณุชุดฺฏุงูโูุง (ูุนุจุฏุ ูพุฑุณุชุดฺฏุงู)",
        "ูุฑุงฺฉุฒ ุนุฑูุงู ู ูุนูู (ุนุฑูุงูุ ูุนูู)",
        "ฺฉุชุงุจูุฑูุดโูุง ูุฐูุจ (ฺฉุชุงุจ ูุฐูุจุ ูุฑู ุงูุฒุงุฑ ูุฐูุจ)",
        "ูุฑุงฺฉุฒ ุฎุฑู ู ูฺฉูฺฉุงุฑ (ุฎุฑูุ ูฺฉูฺฉุงุฑ)",
        "ุงูุชุดุงุฑุงุช ูุฐูุจ (ุงูุชุดุงุฑุงุชุ ฺุงูพ ูุฐูุจ)",
        "ูุฑุงฺฉุฒ ุญูุธ ูุฑุขู ู ูุนุงุฑู ุงุณูุงู",
        "ูุฑุงฺฉุฒ ุฎุฏูุงุช ุญุฌ ู ุฒุงุฑุช",
        "ูุฑุงฺฉุฒ ูุดุงูุฑู ูุฐูุจ ู ุฏู",
        "ูุฑุงฺฉุฒ ุขููุฒุด ุงุญฺฉุงู ู ูุนุงุฑู",
        "ูุฑุงฺฉุฒ ุฎุฏูุงุช ุงููุงู ู ุงููุฑ ุฎุฑู",
        "ูุฑุงฺฉุฒ ุฎุฏูุงุช ูุฐูุจ ุณุงุฑ",
        "ูุฑุงฺฉุฒ ุจุฑฺฏุฒุงุฑ ูุฑุงุณู ูุฐูุจ"
    ],
    "๐ณ ุทุจุนุช ู ุชูุฑุญ ุขุฒุงุฏ": [
        "ูพุงุฑฺฉ ู ุจูุณุชุงู (ูพุงุฑฺฉ ุนูููุ ุจูุณุชุงู)",
        "ุจุงุบ ูุญุด ู ุขฺฉูุงุฑูู (ุจุงุบ ูุญุดุ ุขฺฉูุงุฑูู)",
        "ุจุงุบ ฺฏุงูโุดูุงุณ (ฺฏุงูโุดูุงุณุ ฺฏูุฎุงูู)",
        "ูพุณุช ุฏูฺุฑุฎูโุณูุงุฑ (ุฏูฺุฑุฎูโุณูุงุฑุ ุฏูฺุฑุฎู ุณูุงุฑ ุขูุฑูุฏ)",
        "ฺฉููุณุชุงู ู ูุณุฑูุง ุทุจุนุชโฺฏุฑุฏ (ฺฉููููุฑุฏุ ุทุจุนุชโฺฏุฑุฏ)",
        "ุณุงุญู ู ุฏุฑุงฺู (ุณุงุญูุ ุฏุฑุงฺู)",
        "ุขุจุดุงุฑ ู ฺุดูู (ุขุจุดุงุฑุ ฺุดูู)",
        "ุฌูฺฏู ู ููุทูู ุญูุงุธุช ุดุฏู (ุฌูฺฏูุ ููุทูู ุญูุงุธุช ุดุฏู)",
        "ฺฉููพูฺฏ ู ูพฺฉูฺฉ (ฺฉููพูฺฏุ ูพฺฉูฺฉ)",
        "ูุฑุงฺฉุฒ ุงฺฉูุชูุฑุณู (ุงฺฉูุชูุฑุณูุ ฺฏุฑุฏุดฺฏุฑ ุทุจุนุช)",
        "ูพุณุช ุงุณฺฉ ู ูุฑุฒุดโูุง ุฒูุณุชุงู (ุงุณฺฉุ ูุฑุฒุด ุฒูุณุชุงู)",
        "ุณุงููโูุง ุจููุฏุฑูฺฏ ู ุตุฎุฑูโููุฑุฏ (ุตุฎุฑูโููุฑุฏุ ุจููุฏุฑูฺฏ)",
        "ูุฑุงฺฉุฒ ูุงูฺฏุฑ ู ูุงูโุฑุงู",
        "ูพุงุฑฺฉโูุง ุขุจ ู ุงุณุชุฎุฑูุง ุฑูุจุงุฒ",
        "ูุฑุงฺฉุฒ ูพุฑูุฏูโูฺฏุฑ ู ุญุงุช ูุญุด",
        "ูุณุฑูุง ูพุงุฏูโุฑู ู ฺฉูููพูุง",
        "ูุฑุงฺฉุฒ ฺุงุฏุฑุฒู ู ฺฉุงุฑูุงููฺฏ",
        "ูพุงุฑฺฉโูุง ูู ู ููุงุทู ฺฏุฑุฏุดฺฏุฑ",
        "ูุฑุงฺฉุฒ ุขููุฒุด ุทุจุนุชโฺฏุฑุฏ",
        "ูุฑุงฺฉุฒ ุฎุฏูุงุช ุชูุฑูุง ุทุจุนุช"
    ],
    "๐ผ ฺฉุณุจโูฺฉุงุฑ ู ุญุฑููโุง": [
        "ุฏูุชุฑ ฺฉุงุฑ ู ุดุฑฺฉุชโูุง (ุฏูุชุฑุ ุดุฑฺฉุช)",
        "ฺฉุงุฑุฎุงููโูุง ู ูุงุญุฏูุง ุชููุฏ (ฺฉุงุฑุฎุงููุ ุชููุฏ)",
        "ฺฉุงุฑฺฏุงูโูุง ุตูุนุช (ฺฉุงุฑฺฏุงูุ ุตูุนุช)",
        "ุฏูุงุชุฑ ุงููุงฺฉ ู ูุดุงูุฑู ุงููุงฺฉ (ุงููุงฺฉุ ูุดุงูุฑ ุงููุงฺฉ)",
        "ุฏูุงุชุฑ ุจูู (ุจููุ ุฎุฏูุงุช ุจููโุง)",
        "ุดุฑฺฉุชโูุง ุชุจูุบุงุช ู ุจุงุฒุงุฑุงุจ (ุชุจูุบุงุชุ ุจุงุฒุงุฑุงุจ)",
        "ูุฑุงฺฉุฒ ุทุฑุงุญ ู ฺุงูพ (ุทุฑุงุญุ ฺุงูพ)",
        "ุดุฑฺฉุชโูุง ูุนูุงุฑ ู ุนูุฑุงู (ูุนูุงุฑุ ุนูุฑุงู)",
        "ุฏูุงุชุฑ ุญููู ู ูฺฉุงูุช (ุญูููุ ูฺฉุงูุช)",
        "ุดุฑฺฉุชโูุง ูุดุงูุฑู ูุฏุฑุช (ูุดุงูุฑูุ ูุฏุฑุช)",
        "ูุฑุงฺฉุฒ ุฎุฏูุงุช ูุงู ู ุญุณุงุจุฏุงุฑ (ูุงูุ ุญุณุงุจุฏุงุฑ)",
        "ุดุฑฺฉุชโูุง ููุงูุฑ ุงุทูุงุนุงุช (ููุงูุฑ ุงุทูุงุนุงุชุ ูุฑูโุงูุฒุงุฑ)",
        "ุงุณุชูุฏููุง ุนฺฉุงุณ ู ูููุจุฑุฏุงุฑ (ุนฺฉุงุณุ ูููุจุฑุฏุงุฑ)",
        "ูุฑุงฺฉุฒ ุฎุฏูุงุช ุงุฏุงุฑ ู ฺฉูพ (ุฎุฏูุงุช ุงุฏุงุฑุ ฺฉูพ)",
        "ุดุฑฺฉุชโูุง ุญูู ู ููู ู ุจุงุฑุจุฑ (ุญูู ู ูููุ ุจุงุฑุจุฑ)",
        "ุฎุฏูุงุช ูุธุงูุช ู ูฺฏูุฏุงุฑ (ูุธุงูุชุ ูฺฏูุฏุงุฑ)",
        "ุดุฑฺฉุชโูุง ุฑุณุงููโุง ู ุงูุชุดุงุฑุงุช",
        "ูุฑุงฺฉุฒ ุชุญููุงุช ู ุชูุณุนู",
        "ุดุฑฺฉุชโูุง ูุดุงูุฑู ููุงุจุน ุงูุณุงู",
        "ูุฑุงฺฉุฒ ุฎุฏูุงุช ูุดุงูุฑู ฺฉุณุจโูฺฉุงุฑ",
        "ุดุฑฺฉุชโูุง ุทุฑุงุญ ุณุงุช ู ุจูููโุณุงุฒ ููุชูุฑ ุฌุณุชุฌู",
        "ูุฑุงฺฉุฒ ุฎุฏูุงุช ุชุฑุฌูู ู ูุชุฑุฌู",
        "ุดุฑฺฉุชโูุง ุฎุฏูุงุช ุงููุช",
        "ูุฑุงฺฉุฒ ุฎุฏูุงุช ูพุดุชุจุงู ููุงูุฑ ุงุทูุงุนุงุช",
        "ุดุฑฺฉุชโูุง ุฎุฏูุงุช ูุดุงูุฑู ูุงูุงุช",
        "ูุฑุงฺฉุฒ ุฎุฏูุงุช ุจุฑูุฏูฺฏ ู ููุชโุณุงุฒ",
        "ุฎุฏูุงุช ูุดุงูุฑู ุงูุฑฺ ู ุจูููโุณุงุฒ"
    ],
    "๐งฐ ุฎุฏูุงุช ุชุฎุตุต ู ูู": [
        "ุชุนูุฑฺฏุงู ููุงุฒู ุฎุงูฺฏ (ุชุนูุฑ ููุงุฒูุ ุณุฑูุณ)",
        "ุชุนูุฑฺฏุงู ููุจุงู ู ฺฉุงููพูุชุฑ (ุชุนูุฑ ููุจุงูุ ฺฉุงููพูุชุฑ)",
        "ุฎุฏูุงุช ุจุฑู ุณุงุฎุชูุงู (ุจุฑูโฺฉุงุฑุ ุณูโฺฉุด)",
        "ุฎุฏูุงุช ููููโฺฉุด ู ุชุงุณุณุงุช (ููููโฺฉุดุ ุชุงุณุณุงุช)",
        "ุฎุฏูุงุช ููุงุด ุณุงุฎุชูุงู (ููุงุด ุณุงุฎุชูุงูุ ุฑูฺฏโฺฉุงุฑ)",
        "ุฎุฏูุงุช ฺฉุงุจูุชโุณุงุฒ ู ูุฌุงุฑ (ฺฉุงุจูุชโุณุงุฒุ ูุฌุงุฑ)",
        "ุฎุฏูุงุช ุขููฺฏุฑ ู ุฌูุดฺฉุงุฑ (ุขููฺฏุฑุ ุฌูุดฺฉุงุฑ)",
        "ุฎุฏูุงุช ฺฉูุฏุณุงุฒ ู ูููโุณุงุฒ (ฺฉูุฏุณุงุฒุ ูููโุณุงุฒ)",
        "ุฎุฏูุงุช ุดุดูโุจุฑ ู ุขููโฺฉุงุฑ (ุดุดูโุจุฑุ ุขููโฺฉุงุฑ)",
        "ุฎุฏูุงุช ูุฑุดโุดู ู ูุจูโุดู (ูุฑุดโุดูุ ูุจูโุดู)",
        "ุฎุฏูุงุช ูุธุงูุช ููุฒู ู ุงุฏุงุฑู (ูุธุงูุชุ ุฎุฏูุงุช ูุธุงูุช)",
        "ุฎุฏูุงุช ุจุงุบุจุงู ู ูุถุง ุณุจุฒ (ุจุงุบุจุงูุ ูุถุง ุณุจุฒ)",
        "ุฎุฏูุงุช ุญุดุฑูโฺฉุด ู ุถุฏุนููู (ุถุฏุนูููุ ุณููพุงุด)",
        "ุฎุฏูุงุช ุงููุช ู ูฺฏูุจุงู (ุงููุชุ ูฺฏูุจุงู)",
        "ุฎุฏูุงุช ุชุนูุฑุงุช ููุงุฒู ุงูฺฉุชุฑููฺฉ",
        "ุฎุฏูุงุช ูุตุจ ู ุฑุงูโุงูุฏุงุฒ ุชุฌูุฒุงุช",
        "ุฎุฏูุงุช ุณูโฺฉุด ุดุจฺฉู ู ุงูุชุฑูุช",
        "ุฎุฏูุงุช ุชุนูุฑุงุช ุตูุนุช ู ูุงุดูโุขูุงุช",
        "ุฎุฏูุงุช ูุตุจ ุฏูุฑุจู ู ุณุณุชูโูุง ุญูุงุธุช",
        "ุฎุฏูุงุช ุชุนูุฑุงุช ููุงุฒู ุขุดูพุฒุฎุงูู",
        "ุฎุฏูุงุช ูุตุจ ฺฉููพูุด ู ุณูู ฺฉุงุฐุจ",
        "ุฎุฏูุงุช ุชุนูุฑุงุช ุงุจุฒุงุฑุขูุงุช ุฏูู",
        "ุฎุฏูุงุช ูุตุจ ุขุณุงูุณูุฑ ู ูพูู ุจุฑู",
        "ุฎุฏูุงุช ุชุนูุฑุงุช ุณุณุชูโูุง ุณุฑูุงุด ู ฺฏุฑูุงุด",
        "ุฎุฏูุงุช ูุตุจ ุณุณุชูโูุง ุงุนูุงู ุญุฑู",
        "ุฎุฏูุงุช ุชุนูุฑุงุช ุงุฏูุงุช ููุณู",
        "ุฎุฏูุงุช ูุตุจ ุฏุด ู ุณุณุชูโูุง ูุงููุงุฑูโุง",
        "ุฎุฏูุงุช ุชุนูุฑุงุช ููุงุฒู ูพุฒุดฺฉ",
        "ุฎุฏูุงุช ูุตุจ ุณุณุชูโูุง ููุดููุฏ ุณุงุฎุชูุงู",
        "ุฎุฏูุงุช ุจุงุฒุงูุช ู ูุญุท ุฒุณุช",
        "ุฎุฏูุงุช ุงุฌุงุฑู ุชุฌูุฒุงุช ู ููุงุฒู (ูุงููุฏ ุงุฌุงุฑู ฺุงุฏุฑุ ูุจุงุณ ูุฑุงุณูุ ุชุฌูุฒุงุช ูู)"
    ]
}

# Models
class User(UserMixin, db.Model):
    id = db.Column(db.Integer, primary_key=True)
    username = db.Column(db.String(80), unique=True, nullable=False)
    password = db.Column(db.String(120), nullable=False)
    city = db.Column(db.String(100), nullable=False)
    places = db.relationship('Place', backref='owner', lazy=True)

class Place(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    title = db.Column(db.String(200), nullable=False)
    description = db.Column(db.Text, nullable=False)
    address = db.Column(db.String(300), nullable=False)
    mobile = db.Column(db.String(20), nullable=True)
    morning_shift = db.Column(db.String(50), nullable=True)
    evening_shift = db.Column(db.String(50), nullable=True)
    category = db.Column(db.String(100), nullable=False)
    subcategory = db.Column(db.String(100), nullable=False)
    city = db.Column(db.String(100), nullable=False)
    owner_id = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=False)
    ratings = db.relationship('Rating', backref='place', lazy=True)

class Rating(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    place_id = db.Column(db.Integer, db.ForeignKey('place.id'), nullable=False)
    user_id = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=False)
    rating = db.Column(db.Integer, nullable=False)
    comment = db.Column(db.Text, nullable=True)
    timestamp = db.Column(db.DateTime, default=datetime.datetime.utcnow)

class Chat(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    sender_id = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=False)
    receiver_id = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=False)
    message = db.Column(db.Text, nullable=False)
    timestamp = db.Column(db.DateTime, default=datetime.datetime.utcnow)

@login_manager.user_loader
def load_user(user_id):
    return User.query.get(int(user_id))

# Templates
base_template = """
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ฺฏูู ููุง | GOYOM NAMA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --navy-blue: #0a192f;
            --light-navy: #112240;
            --white: #e6f1ff;
            --light-blue: #64ffda;
            --dark-blue: #022c43;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Vazirmatn', Tahoma, sans-serif;
            background: linear-gradient(135deg, #0a192f 0%, #112240 100%);
            color: #e6f1ff;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Navbar Styles */
        .navbar {
            background: rgba(10, 25, 47, 0.95) !important;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(100, 255, 218, 0.1);
            padding: 1rem 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            animation: slideDown 0.8s ease-out;
        }
        
        .navbar-brand {
            font-weight: 700;
            font-size: 1.8rem;
            background: linear-gradient(45deg, #64ffda, #022c43);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 20px rgba(100, 255, 218, 0.3);
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        .nav-link {
            color: #8892b0 !important;
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
            padding: 0.5rem 1rem;
        }
        
        .nav-link:hover {
            color: #64ffda !important;
            transform: translateY(-2px);
        }
        
        .nav-link::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 2px;
            background: linear-gradient(90deg, #64ffda, #022c43);
            transition: all 0.3s ease;
            transform: translateX(-50%);
        }
        
        .nav-link:hover::after {
            width: 80%;
        }
        
        /* Container and Cards */
        .container {
            padding: 2rem 1rem;
            animation: fadeIn 1s ease-out;
        }
        
        .card {
            background: rgba(17, 34, 64, 0.7) !important;
            border: 1px solid rgba(100, 255, 218, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            margin-bottom: 1.5rem;
            overflow: hidden;
        }
        
        .card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 15px 40px rgba(100, 255, 218, 0.2);
            border-color: rgba(100, 255, 218, 0.3);
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #64ffda, #022c43);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }
        
        .card:hover::before {
            transform: scaleX(1);
        }
        
        .card-body {
            padding: 1.5rem;
        }
        
        .card-title {
            color: #64ffda;
            font-weight: 600;
            margin-bottom: 1rem;
            font-size: 1.3rem;
            animation: slideInLeft 0.6s ease-out;
        }
        
        .card-text {
            color: #a8b2d1;
            line-height: 1.6;
            animation: slideInRight 0.6s ease-out;
        }
        
        /* Buttons */
        .btn {
            border-radius: 25px;
            padding: 0.7rem 1.5rem;
            font-weight: 500;
            transition: all 0.3s ease;
            border: none;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 100%;
            background: linear-gradient(45deg, #64ffda, #022c43);
            transition: all 0.5s ease;
            z-index: -1;
        }
        
        .btn:hover::before {
            width: 100%;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #022c43, #112240);
            color: #64ffda !important;
            border: 1px solid rgba(100, 255, 218, 0.3);
        }
        
        .btn-primary:hover {
            color: #0a192f !important;
            box-shadow: 0 5px 15px rgba(100, 255, 218, 0.4);
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: linear-gradient(45deg, #022c43, #112240);
            color: #64ffda !important;
            border: 1px solid rgba(100, 255, 218, 0.3);
        }
        
        .btn-success:hover {
            color: #0a192f !important;
            box-shadow: 0 5px 15px rgba(100, 255, 218, 0.4);
            transform: translateY(-2px);
        }
        
        .btn-outline-primary {
            border: 1px solid rgba(100, 255, 218, 0.5);
            color: #64ffda;
        }
        
        .btn-outline-primary:hover {
            background: linear-gradient(45deg, #64ffda, #022c43);
            color: #0a192f !important;
            border-color: transparent;
            transform: translateY(-2px);
        }
        
        /* Forms */
        .form-control, .form-select {
            background: rgba(10, 25, 47, 0.5) !important;
            border: 1px solid rgba(100, 255, 218, 0.2) !important;
            color: #e6f1ff !important;
            border-radius: 10px;
            padding: 0.75rem 1rem;
            transition: all 0.3s ease;
        }
        
        .form-control:focus, .form-select:focus {
            background: rgba(17, 34, 64, 0.7) !important;
            border-color: #64ffda !important;
            box-shadow: 0 0 0 0.25rem rgba(100, 255, 218, 0.25) !important;
            color: #64ffda !important;
        }
        
        .form-label {
            color: #8892b0;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }
        
        /* Alerts */
        .alert {
            border-radius: 10px;
            border: none;
            backdrop-filter: blur(10px);
            animation: slideInDown 0.5s ease-out;
        }
        
        .alert-success {
            background: rgba(100, 255, 218, 0.15) !important;
            border: 1px solid rgba(100, 255, 218, 0.3);
            color: #64ffda !important;
        }
        
        .alert-danger {
            background: rgba(255, 100, 100, 0.15) !important;
            border: 1px solid rgba(255, 100, 100, 0.3);
            color: #ff6464 !important;
        }
        
        /* Map Container */
        .map-container {
            height: 300px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            margin-bottom: 2rem;
            border: 1px solid rgba(100, 255, 218, 0.1);
            animation: fadeInUp 1s ease-out;
        }
        
        .map-container iframe {
            width: 100%;
            height: 100%;
            border: none;
            filter: grayscale(50%) brightness(0.8);
            transition: filter 0.3s ease;
        }
        
        .map-container:hover iframe {
            filter: grayscale(0%) brightness(1);
        }
        
        /* Sidebar */
        .sidebar {
            background: rgba(17, 34, 64, 0.7);
            border-radius: 15px;
            padding: 2rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(100, 255, 218, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            animation: slideInLeft 0.8s ease-out;
        }
        
        .sidebar h5 {
            color: #64ffda;
            font-weight: 600;
            margin-bottom: 1.5rem;
            text-align: center;
            position: relative;
            padding-bottom: 0.5rem;
        }
        
        .sidebar h5::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 3px;
            background: linear-gradient(90deg, #64ffda, #022c43);
            border-radius: 2px;
        }
        
        .sidebar ul li a {
            color: #8892b0;
            text-decoration: none;
            padding: 0.5rem 1rem;
            display: block;
            border-radius: 8px;
            transition: all 0.3s ease;
            margin-bottom: 0.3rem;
        }
        
        .sidebar ul li a:hover {
            background: rgba(100, 255, 218, 0.1);
            color: #64ffda;
            transform: translateX(5px);
        }
        
        /* Pagination */
        .pagination {
            justify-content: center;
            margin: 2rem 0;
        }
        
        .page-link {
            background: rgba(17, 34, 64, 0.7);
            border: 1px solid rgba(100, 255, 218, 0.2);
            color: #8892b0;
            transition: all 0.3s ease;
        }
        
        .page-link:hover {
            background: rgba(100, 255, 218, 0.1);
            color: #64ffda;
            border-color: rgba(100, 255, 218, 0.3);
        }
        
        .page-item.active .page-link {
            background: linear-gradient(45deg, #64ffda, #022c43);
            border-color: #64ffda;
            color: #0a192f;
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideDown {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        @keyframes slideInLeft {
            from {
                transform: translateX(-50px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(50px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideInDown {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        @keyframes fadeInUp {
            from {
                transform: translateY(30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        @keyframes glow {
            from {
                text-shadow: 0 0 5px rgba(100, 255, 218, 0.3);
            }
            to {
                text-shadow: 0 0 20px rgba(100, 255, 218, 0.6), 0 0 30px rgba(100, 255, 218, 0.4);
            }
        }
        
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        /* Floating animation for cards */
        .floating {
            animation: float 3s ease-in-out infinite;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .navbar-brand {
                font-size: 1.5rem;
            }
            
            .card {
                margin-bottom: 1rem;
            }
            
            .sidebar {
                margin-bottom: 2rem;
            }
        }
        
        /* Loading spinner */
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(100, 255, 218, 0.3);
            border-top: 4px solid #64ffda;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Modal styles */
        .modal-content {
            background: rgba(10, 25, 47, 0.95) !important;
            border: 1px solid rgba(100, 255, 218, 0.2);
            backdrop-filter: blur(10px);
        }
        
        .modal-header {
            border-bottom: 1px solid rgba(100, 255, 218, 0.1);
        }
        
        .modal-title {
            color: #64ffda;
            font-weight: 600;
        }
        
        .btn-close {
            filter: invert(1) grayscale(100%) brightness(200%);
        }
        
        /* Chat messages */
        #chatMessages {
            max-height: 300px;
            overflow-y: auto;
        }
        
        #chatMessages div {
            background: rgba(17, 34, 64, 0.5);
            border-radius: 10px;
            padding: 0.8rem;
            margin-bottom: 0.5rem;
            animation: fadeIn 0.3s ease-out;
        }
        
        /* Footer */
        .footer {
            text-align: center;
            padding: 2rem;
            color: #8892b0;
            font-size: 0.9rem;
            border-top: 1px solid rgba(100, 255, 218, 0.1);
            margin-top: 2rem;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('index') }}">ฺฏูู ููุง | GOYOM NAMA</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('index') }}">ุฎุงูู</a>
                    </li>
                    {% if current_user.is_authenticated %}
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('add_place') }}">ุงูุฒูุฏู ูฺฉุงู</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('profile') }}">ูพุฑููุงู</a>
                    </li>
                    {% endif %}
                </ul>
                <ul class="navbar-nav">
                    {% if current_user.is_authenticated %}
                    <li class="nav-item">
                        <span class="navbar-text">ุดูุฑ: {{ current_user.city }}</span>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('logout') }}">ุฎุฑูุฌ</a>
                    </li>
                    {% else %}
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('login') }}">ูุฑูุฏ</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('register') }}">ุซุจุชโูุงู</a>
                    </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ 'danger' if category == 'error' else 'success' }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </div>

    <div class="footer">
        <p>ยฉ 2024 ฺฏูู ููุง | GOYOM NAMA - ูพูุชูุฑู ุฌุงูุน ูฺฉุงูโูุง ูุญู</p>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    {% block scripts %}{% endblock %}
</body>
</html>
"""

index_template = """
<div class="row">
    <div class="col-md-3">
        <div class="sidebar">
            <h5>ุฏุณุชูโุจูุฏโูุง</h5>
            <ul class="list-unstyled">
                {% for category, subcategories in CATEGORIES.items() %}
                <li>
                    <a href="{{ url_for('index', category=category.split()[0]) }}">{{ category }}</a>
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>
    <div class="col-md-9">
        <div class="map-container">
            <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d103916.6998339214!2d51.3372975!3d35.694373!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3f8e00491ff3dcd9%3A0xf0b3697c521a41e4!2sTehran%2C%20Tehran%20Province%2C%20Iran!5e0!3m2!1sen!2s!4v1620000000000!5m2!1sen!2s" allowfullscreen="" loading="lazy"></iframe>
        </div>

        <form method="GET" class="mb-4">
            <div class="row">
                <div class="col-md-4">
                    <input type="text" name="search" class="form-control" placeholder="ุฌุณุชุฌู..." value="{{ request.args.get('search', '') }}">
                </div>
                <div class="col-md-3">
                    <select name="category" class="form-select">
                        <option value="">ููู ุฏุณุชูโุจูุฏโูุง</option>
                        {% for category, subcategories in CATEGORIES.items() %}
                        <option value="{{ category.split()[0] }}" {{ 'selected' if request.args.get('category') == category.split()[0] }}>{{ category }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-3">
                    <select name="city" class="form-select">
                        <option value="">ููู ุดูุฑูุง</option>
                        {% for city in CITIES %}
                        <option value="{{ city }}" {{ 'selected' if request.args.get('city') == city }}>{{ city }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-primary w-100">ุฌุณุชุฌู</button>
                </div>
            </div>
            {% if current_user.is_authenticated %}
            <div class="mt-2">
                <a href="{{ url_for('index', only_my_city='true') }}" class="btn btn-outline-primary">ููุท ุดูุฑฺฉููู</a>
            </div>
            {% endif %}
        </form>

        <div class="row">
            {% for place in places %}
            <div class="col-md-6 col-lg-4">
                <div class="card floating">
                    <div class="card-body">
                        <h5 class="card-title">{{ place.title }}</h5>
                        <p class="card-text">{{ place.description[:100] }}...</p>
                        <p class="text-muted">
                            <i class="fas fa-map-marker-alt"></i> {{ place.city }} - {{ place.address[:30] }}...
                        </p>
                        <p class="text-muted">
                            <i class="fas fa-clock"></i> 
                            {% if place.morning_shift %}ุตุจุญ: {{ place.morning_shift }}{% endif %}
                            {% if place.evening_shift %}ุนุตุฑ: {{ place.evening_shift }}{% endif %}
                        </p>
                        <a href="{{ url_for('place_detail', place_id=place.id) }}" class="btn btn-primary">ูุดุงูุฏู ุฌุฒุฆุงุช</a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Pagination -->
        <nav aria-label="Page navigation">
            <ul class="pagination justify-content-center">
                {% if places.has_prev %}
                <li class="page-item">
                    <a class="page-link" href="{{ url_for('index', page=places.prev_num, **request.args) }}">ูุจู</a>
                </li>
                {% endif %}
                {% for page_num in places.iter_pages() %}
                    {% if page_num %}
                        {% if page_num != places.page %}
                        <li class="page-item">
                            <a class="page-link" href="{{ url_for('index', page=page_num, **request.args) }}">{{ page_num }}</a>
                        </li>
                        {% else %}
                        <li class="page-item active">
                            <span class="page-link">{{ page_num }}</span>
                        </li>
                        {% endif %}
                    {% else %}
                    <li class="page-item disabled">
                        <span class="page-link">โฆ</span>
                    </li>
                    {% endif %}
                {% endfor %}
                {% if places.has_next %}
                <li class="page-item">
                    <a class="page-link" href="{{ url_for('index', page=places.next_num, **request.args) }}">ุจุนุฏ</a>
                </li>
                {% endif %}
            </ul>
        </nav>
    </div>
</div>
"""

register_template = """
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card floating">
            <div class="card-header">
                <h4 class="text-center">ุซุจุชโูุงู</h4>
            </div>
            <div class="card-body">
                <form method="POST">
                    <div class="mb-3">
                        <label for="username" class="form-label">ูุงู ฺฉุงุฑุจุฑ</label>
                        <input type="text" class="form-control" id="username" name="username" required>
                    </div>
                    <div class="mb-3">
                        <label for="password" class="form-label">ุฑูุฒ ุนุจูุฑ</label>
                        <input type="password" class="form-control" id="password" name="password" required>
                    </div>
                    <div class="mb-3">
                        <label for="city" class="form-label">ุดูุฑ</label>
                        <select class="form-select" id="city" name="city" required>
                            <option value="">ุงูุชุฎุงุจ ุดูุฑ</option>
                            {% for city in CITIES %}
                            <option value="{{ city }}">{{ city }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary w-100">ุซุจุชโูุงู</button>
                </form>
                <div class="text-center mt-3">
                    <a href="{{ url_for('login') }}">ูุจูุงู ุซุจุชโูุงู ฺฉุฑุฏูโุงุฏุ ูุฑูุฏ</a>
                </div>
            </div>
        </div>
    </div>
</div>
"""

login_template = """
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card floating">
            <div class="card-header">
                <h4 class="text-center">ูุฑูุฏ</h4>
            </div>
            <div class="card-body">
                <form method="POST">
                    <div class="mb-3">
                        <label for="username" class="form-label">ูุงู ฺฉุงุฑุจุฑ</label>
                        <input type="text" class="form-control" id="username" name="username" required>
                    </div>
                    <div class="mb-3">
                        <label for="password" class="form-label">ุฑูุฒ ุนุจูุฑ</label>
                        <input type="password" class="form-control" id="password" name="password" required>
                    </div>
                    <button type="submit" class="btn btn-primary w-100">ูุฑูุฏ</button>
                </form>
                <div class="text-center mt-3">
                    <a href="{{ url_for('register') }}">ุญุณุงุจ ฺฉุงุฑุจุฑ ูุฏุงุฑุฏุ ุซุจุชโูุงู</a>
                </div>
            </div>
        </div>
    </div>
</div>
"""

profile_template = """
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card floating">
            <div class="card-header">
                <h4 class="text-center">ูพุฑููุงู</h4>
            </div>
            <div class="card-body">
                <p><strong>ูุงู ฺฉุงุฑุจุฑ:</strong> {{ current_user.username }}</p>
                <p><strong>ุดูุฑ:</strong> {{ current_user.city }}</p>
                
                <h5 class="mt-4">ูฺฉุงูโูุง ูู</h5>
                {% if current_user.places %}
                <ul class="list-group">
                    {% for place in current_user.places %}
                    <li class="list-group-item" style="background: rgba(17, 34, 64, 0.5); border: 1px solid rgba(100, 255, 218, 0.1); color: #a8b2d1;">
                        <a href="{{ url_for('place_detail', place_id=place.id) }}" style="color: #64ffda; text-decoration: none;">{{ place.title }}</a>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p>ุดูุง ูููุฒ ูฺฉุงู ุงุถุงูู ูฺฉุฑุฏูโุงุฏ.</p>
                {% endif %}
                
                <h5 class="mt-4">ูุฑุงุด ุดูุฑ</h5>
                <form method="POST">
                    <div class="mb-3">
                        <select class="form-select" name="city" required>
                            {% for city in CITIES %}
                            <option value="{{ city }}" {{ 'selected' if city == current_user.city }}>{{ city }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">ุจูโุฑูุฒุฑุณุงู</button>
                </form>
            </div>
        </div>
    </div>
</div>
"""

add_place_template = """
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card floating">
            <div class="card-header">
                <h4 class="text-center">ุงูุฒูุฏู ูฺฉุงู</h4>
            </div>
            <div class="card-body">
                <form method="POST" enctype="multipart/form-data">
                    <div class="mb-3">
                        <label for="title" class="form-label">ุนููุงู</label>
                        <input type="text" class="form-control" id="title" name="title" required>
                    </div>
                    <div class="mb-3">
                        <label for="description" class="form-label">ุชูุถุญุงุช</label>
                        <textarea class="form-control" id="description" name="description" rows="4" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="address" class="form-label">ุขุฏุฑุณ</label>
                        <input type="text" class="form-control" id="address" name="address" required>
                    </div>
                    <div class="mb-3">
                        <label for="mobile" class="form-label">ุดูุงุฑู ููุจุงู (ุงุฎุชุงุฑ)</label>
                        <input type="text" class="form-control" id="mobile" name="mobile">
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="morning_shift" class="form-label">ุดูุช ุตุจุญ (ุงุฎุชุงุฑ)</label>
                                <input type="text" class="form-control" id="morning_shift" name="morning_shift" placeholder="8:00-12:00">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="evening_shift" class="form-label">ุดูุช ุนุตุฑ (ุงุฎุชุงุฑ)</label>
                                <input type="text" class="form-control" id="evening_shift" name="evening_shift" placeholder="16:00-20:00">
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="category" class="form-label">ุฏุณุชูโุจูุฏ</label>
                        <select class="form-select" id="category" name="category" required>
                            <option value="">ุงูุชุฎุงุจ ุฏุณุชูโุจูุฏ</option>
                            {% for category, subcategories in CATEGORIES.items() %}
                            <option value="{{ category }}">{{ category }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="subcategory" class="form-label">ุฒุฑูุฌููุนู</label>
                        <select class="form-select" id="subcategory" name="subcategory" required>
                            <option value="">ุงุจุชุฏุง ุฏุณุชูโุจูุฏ ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="city" class="form-label">ุดูุฑ</label>
                        <select class="form-select" id="city" name="city" required>
                            <option value="">ุงูุชุฎุงุจ ุดูุฑ</option>
                            {% for city in CITIES %}
                            <option value="{{ city }}">{{ city }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="image" class="form-label">ุนฺฉุณ (ุงุฎุชุงุฑ)</label>
                        <input type="file" class="form-control" id="image" name="image" accept="image/*">
                    </div>
                    <button type="submit" class="btn btn-primary w-100">ุงูุฒูุฏู ูฺฉุงู</button>
                </form>
            </div>
        </div>
    </div>
</div>
<script>
document.getElementById('category').addEventListener('change', function() {
    const category = this.value;
    const subcategorySelect = document.getElementById('subcategory');
    subcategorySelect.innerHTML = '<option value="">ุฏุฑ ุญุงู ุจุงุฑฺฏุฐุงุฑ...</option>';
    
    // Simulate loading subcategories from server
    setTimeout(() => {
        subcategorySelect.innerHTML = '<option value="">ุงูุชุฎุงุจ ุฒุฑูุฌููุนู</option>';
        if (category) {
            const subcategories = {{ CATEGORIES | tojson }};
            const categoryKey = Object.keys(subcategories).find(key => key.startsWith(category));
            if (categoryKey) {
                subcategories[categoryKey].forEach(sub => {
                    const option = document.createElement('option');
                    option.value = sub;
                    option.textContent = sub;
                    subcategorySelect.appendChild(option);
                });
            }
        }
    }, 500);
});
</script>
"""

place_detail_template = """
<div class="row">
    <div class="col-md-8">
        <div class="card floating">
            <div class="card-body">
                <h2>{{ place.title }}</h2>
                <p class="text-muted">
                    <i class="fas fa-map-marker-alt"></i> {{ place.city }} - {{ place.address }}
                </p>
                <p class="text-muted">
                    <i class="fas fa-user"></i> ุตุงุญุจ ูฺฉุงู: {{ place.owner.username }}
                </p>
                <p>
                    <i class="fas fa-list"></i> ุฏุณุชูโุจูุฏ: {{ place.category }} - {{ place.subcategory }}
                </p>
                {% if place.mobile %}
                <p>
                    <i class="fas fa-phone"></i> 
                    <a href="tel:{{ place.mobile }}" style="color: #64ffda;">{{ place.mobile }}</a>
                </p>
                {% endif %}
                {% if place.morning_shift or place.evening_shift %}
                <p>
                    <i class="fas fa-clock"></i> 
                    {% if place.morning_shift %}ุตุจุญ: {{ place.morning_shift }}{% endif %}
                    {% if place.evening_shift %}ุนุตุฑ: {{ place.evening_shift }}{% endif %}
                </p>
                {% endif %}
                <hr>
                <h5>ุชูุถุญุงุช</h5>
                <p>{{ place.description }}</p>
                
                {% if current_user.is_authenticated and current_user.id != place.owner_id %}
                <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#chatModal">
                    <i class="fas fa-comment"></i> ฺุช ุจุง ุตุงุญุจ ูฺฉุงู
                </button>
                {% endif %}
            </div>
        </div>
        
        <div class="card mt-4 floating">
            <div class="card-header">
                <h5>ุงูุชุงุฒุงุช ู ูุธุฑุงุช</h5>
            </div>
            <div class="card-body">
                {% if place.ratings %}
                <div class="mb-3">
                    <strong>ูุงูฺฏู ุงูุชุงุฒ:</strong> 
                    {% set avg_rating = place.ratings | sum(attribute='rating') / place.ratings | length %}
                    {% for i in range(1, 6) %}
                        {% if i <= avg_rating %}
                        <i class="fas fa-star text-warning"></i>
                        {% else %}
                        <i class="far fa-star text-warning"></i>
                        {% endif %}
                    {% endfor %}
                    ({{ "{:.1f}".format(avg_rating) }} ุงุฒ 5)
                </div>
                {% endif %}
                
                {% for rating in place.ratings %}
                <div class="border-bottom pb-3 mb-3" style="border-color: rgba(100, 255, 218, 0.1) !important;">
                    <div>
                        {% for i in range(1, 6) %}
                            {% if i <= rating.rating %}
                            <i class="fas fa-star text-warning"></i>
                            {% else %}
                            <i class="far fa-star text-warning"></i>
                            {% endif %}
                        {% endfor %}
                        <small class="text-muted">{{ rating.user.username }} - {{ rating.timestamp.strftime('%Y-%m-%d %H:%M') }}</small>
                    </div>
                    {% if rating.comment %}
                    <p class="mt-2">{{ rating.comment }}</p>
                    {% endif %}
                </div>
                {% endfor %}
                
                {% if current_user.is_authenticated %}
                <h5 class="mt-4">ุซุจุช ุงูุชุงุฒ ู ูุธุฑ</h5>
                <form method="POST">
                    <div class="mb-3">
                        <label class="form-label">ุงูุชุงุฒ</label>
                        <div>
                            {% for i in range(1, 6) %}
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="rating" id="rating{{ i }}" value="{{ i }}" required>
                                <label class="form-check-label" for="rating{{ i }}">{{ i }}</label>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="comment" class="form-label">ูุธุฑ (ุงุฎุชุงุฑ)</label>
                        <textarea class="form-control" id="comment" name="comment" rows="3"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">ุซุจุช</button>
                </form>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="map-container">
            <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d103916.6998339214!2d51.3372975!3d35.694373!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3f8e00491ff3dcd9%3A0xf0b3697c521a41e4!2sTehran%2C%20Tehran%20Province%2C%20Iran!5e0!3m2!1sen!2s!4v1620000000000!5m2!1sen!2s" allowfullscreen="" loading="lazy"></iframe>
        </div>
    </div>
</div>

<!-- Chat Modal -->
<div class="modal fade" id="chatModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">ฺุช ุจุง {{ place.owner.username }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="chatMessages">
                <!-- Messages will be loaded here -->
            </div>
            <div class="modal-footer">
                <input type="text" class="form-control" id="messageInput" placeholder="ูพุงู ุฎูุฏ ุฑุง ุจููุณุฏ...">
                <button class="btn btn-primary" id="sendMessageBtn">ุงุฑุณุงู</button>
            </div>
        </div>
    </div>
</div>
<script>
const socket = io();
const placeId = {{ place.id }};
const ownerId = {{ place.owner_id }};
const currentUserId = {{ current_user.id if current_user.is_authenticated else 'null' }};

// Join chat room
socket.emit('join', {place_id: placeId, owner_id: ownerId, user_id: currentUserId});

// Load chat history
socket.on('load_history', function(data) {
    const chatMessages = document.getElementById('chatMessages');
    chatMessages.innerHTML = '';
    data.messages.forEach(msg => {
        const messageDiv = document.createElement('div');
        messageDiv.className = 'mb-2';
        messageDiv.innerHTML = `<strong>${msg.sender}</strong>: ${msg.text} <small class="text-muted">(${msg.time})</small>`;
        chatMessages.appendChild(messageDiv);
    });
    chatMessages.scrollTop = chatMessages.scrollHeight;
});

// Receive new message
socket.on('receive_message', function(data) {
    const chatMessages = document.getElementById('chatMessages');
    const messageDiv = document.createElement('div');
    messageDiv.className = 'mb-2';
    messageDiv.innerHTML = `<strong>${data.sender}</strong>: ${data.text} <small class="text-muted">(${data.time})</small>`;
    chatMessages.appendChild(messageDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
});

// Send message
document.getElementById('sendMessageBtn').addEventListener('click', function() {
    const messageInput = document.getElementById('messageInput');
    const message = messageInput.value.trim();
    if (message) {
        socket.emit('send_message', {
            place_id: placeId,
            owner_id: ownerId,
            user_id: currentUserId,
            message: message
        });
        messageInput.value = '';
    }
});

// Send message on Enter key
document.getElementById('messageInput').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        document.getElementById('sendMessageBtn').click();
    }
});
</script>
"""

# Routes
@app.route('/')
def index():
    page = request.args.get('page', 1, type=int)
    search = request.args.get('search', '')
    category = request.args.get('category', '')
    city = request.args.get('city', '')
    only_my_city = request.args.get('only_my_city', '')
    
    query = Place.query
    
    if search:
        query = query.filter(Place.title.contains(search) | Place.address.contains(search))
    
    if category:
        query = query.filter(Place.category.startswith(category))
    
    if city:
        query = query.filter_by(city=city)
    
    if only_my_city and current_user.is_authenticated:
        query = query.filter_by(city=current_user.city)
    
    places = query.paginate(page=page, per_page=20)
    
    return render_template_string(
        base_template.replace('{% block content %}{% endblock %}', '{% block content %}' + index_template + '{% endblock %}'),
        places=places,
        CATEGORIES=CATEGORIES,
        CITIES=CITIES
    )

@app.route('/register', methods=['GET', 'POST'])
def register():
    if request.method == 'POST':
        username = request.form['username']
        password = request.form['password']
        city = request.form['city']
        
        if User.query.filter_by(username=username).first():
            flash('ูุงู ฺฉุงุฑุจุฑ ูุจูุงู ุงุณุชูุงุฏู ุดุฏู ุงุณุช', 'error')
            return redirect(url_for('register'))
        
        hashed_password = generate_password_hash(password)
        user = User(username=username, password=hashed_password, city=city)
        db.session.add(user)
        db.session.commit()
        
        flash('ุซุจุชโูุงู ูููู!', 'success')
        return redirect(url_for('login'))
    
    return render_template_string(
        base_template.replace('{% block content %}{% endblock %}', '{% block content %}' + register_template + '{% endblock %}'),
        CITIES=CITIES
    )

@app.route('/login', methods=['GET', 'POST'])
def login():
    if request.method == 'POST':
        username = request.form['username']
        password = request.form['password']
        
        user = User.query.filter_by(username=username).first()
        
        if user and check_password_hash(user.password, password):
            login_user(user)
            flash('ูุฑูุฏ ูููู!', 'success')
            return redirect(url_for('index'))
        else:
            flash('ูุงู ฺฉุงุฑุจุฑ ุง ุฑูุฒ ุงุดุชุจุงู ุงุณุช', 'error')
    
    return render_template_string(
        base_template.replace('{% block content %}{% endblock %}', '{% block content %}' + login_template + '{% endblock %}')
    )

@app.route('/logout')
@login_required
def logout():
    logout_user()
    flash('ุฎุฑูุฌ ูููู!', 'success')
    return redirect(url_for('index'))

@app.route('/profile', methods=['GET', 'POST'])
@login_required
def profile():
    if request.method == 'POST':
        city = request.form['city']
        current_user.city = city
        db.session.commit()
        flash('ูพุฑููุงู ุจูโุฑูุฒุฑุณุงู ุดุฏ', 'success')
        return redirect(url_for('profile'))
    
    return render_template_string(
        base_template.replace('{% block content %}{% endblock %}', '{% block content %}' + profile_template + '{% endblock %}'),
        CITIES=CITIES
    )

@app.route('/add_place', methods=['GET', 'POST'])
@login_required
def add_place():
    if request.method == 'POST':
        title = request.form['title']
        description = request.form['description']
        address = request.form['address']
        mobile = request.form.get('mobile', '')
        morning_shift = request.form.get('morning_shift', '')
        evening_shift = request.form.get('evening_shift', '')
        category = request.form['category']
        subcategory = request.form['subcategory']
        city = request.form['city']
        
        # Handle image upload
        image_data = None
        if 'image' in request.files:
            image = request.files['image']
            if image.filename != '':
                image_data = base64.b64encode(image.read()).decode('utf-8')
        
        place = Place(
            title=title,
            description=description,
            address=address,
            mobile=mobile,
            morning_shift=morning_shift,
            evening_shift=evening_shift,
            category=category,
            subcategory=subcategory,
            city=city,
            owner_id=current_user.id
        )
        
        db.session.add(place)
        db.session.commit()
        
        flash('ูฺฉุงู ุงุถุงูู ุดุฏ!', 'success')
        return redirect(url_for('index'))
    
    return render_template_string(
        base_template.replace('{% block content %}{% endblock %}', '{% block content %}' + add_place_template + '{% endblock %}'),
        CATEGORIES=CATEGORIES,
        CITIES=CITIES
    )

@app.route('/place/<int:place_id>', methods=['GET', 'POST'])
def place_detail(place_id):
    place = Place.query.get_or_404(place_id)
    
    if request.method == 'POST' and current_user.is_authenticated:
        rating_value = int(request.form['rating'])
        comment = request.form.get('comment', '')
        
        # Prevent owner from rating their own place
        if current_user.id == place.owner_id:
            flash('ุดูุง ููโุชูุงูุฏ ุจู ูฺฉุงู ุฎูุฏุชุงู ุงูุชุงุฒ ุฏูุฏ', 'error')
            return redirect(url_for('place_detail', place_id=place_id))
        
        rating = Rating(
            place_id=place_id,
            user_id=current_user.id,
            rating=rating_value,
            comment=comment
        )
        
        db.session.add(rating)
        db.session.commit()
        
        flash('ูุธุฑ ุซุจุช ุดุฏ', 'success')
        return redirect(url_for('place_detail', place_id=place_id))
    
    return render_template_string(
        base_template.replace('{% block content %}{% endblock %}', '{% block content %}' + place_detail_template + '{% endblock %}'),
        place=place
    )

# SocketIO events
@socketio.on('join')
def handle_join(data):
    place_id = data['place_id']
    owner_id = data['owner_id']
    user_id = data['user_id']
    
    # Create a unique room name
    room = f"place_{place_id}_owner_{owner_id}"
    join_room(room)
    
    # Load chat history
    chats = Chat.query.filter(
        ((Chat.sender_id == user_id) & (Chat.receiver_id == owner_id)) |
        ((Chat.sender_id == owner_id) & (Chat.receiver_id == user_id))
    ).order_by(Chat.timestamp).all()
    
    messages = []
    for chat in chats:
        sender = User.query.get(chat.sender_id)
        messages.append({
            'sender': sender.username,
            'text': chat.message,
            'time': chat.timestamp.strftime('%H:%M')
        })
    
    emit('load_history', {'messages': messages})

@socketio.on('send_message')
def handle_send_message(data):
    place_id = data['place_id']
    owner_id = data['owner_id']
    user_id = data['user_id']
    message_text = data['message']
    
    # Save message to database
    chat = Chat(
        sender_id=user_id,
        receiver_id=owner_id,
        message=message_text
    )
    db.session.add(chat)
    db.session.commit()
    
    # Create room name
    room = f"place_{place_id}_owner_{owner_id}"
    
    # Get sender username
    sender = User.query.get(user_id)
    
    # Emit message to room
    emit('receive_message', {
        'sender': sender.username,
        'text': message_text,
        'time': chat.timestamp.strftime('%H:%M')
    }, room=room)

if __name__ == '__main__':
    with app.app_context():
        db.create_all()
    socketio.run(app, debug=True, host='0.0.0.0', port=5000)