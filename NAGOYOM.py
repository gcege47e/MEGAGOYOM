import telebot
from telebot import types
import sqlite3
import random
import re
import threading
import time
import os
from flask import Flask, request

# ุชูุธูุงุช
API_TOKEN = "8158514610:AAG6QYu1tlOuh6BkbjhojAkjRl3cCAP31Ao"
ADMIN_ID = 7385601641
DB_NAME = "goyim.db"
WEBHOOK_URL = "https://goyomnama.onrender.com"
PORT = 5000

# ุชูุธู ุฑุจุงุช
bot = telebot.TeleBot(API_TOKEN, threaded=True)
app = Flask(__name__)

# ุงุณุชฺฉุฑูุง ูุฎุตูุต
EMOJIS = {
    "profile": "๐ค",
    "places": "๐",
    "back": "๐",
    "home": "๐",
    "edit": "โ๏ธ",
    "delete": "๐๏ธ",
    "add": "โ",
    "view": "๐๏ธ",
    "success": "โ",
    "error": "โ",
    "info": "โน๏ธ",
    "star": "โญ",
    "admin": "๐ง",
    "news": "๐ฐ",
    "help": "โ",
    "link": "๐",
    "document": "๐",
    "warning": "โ๏ธ",
    "rating": "๐",
    "group": "๐ฅ",
    "user": "๐ค",
    "score": "๐",
    "add_score": "โฌ๏ธ",
    "remove_score": "โฌ๏ธ",
    "report": "๐",
    "message": "๐ฌ",
    "comment": "๐ญ",
    "feedback": "๐",
    "buy": "๐ฐ",
    "top_place": "๐",
    "vote": "๐ณ๏ธ",
    "block": "๐ซ",
    "unblock": "๐",
    "reply": "โฉ๏ธ",
    "next": "โก๏ธ",
    "previous": "โฌ๏ธ",
    "confirm": "โ๏ธ",
    "cancel": "โ",
    "location": "๐บ๏ธ",
    "phone": "๐",
    "time": "โฐ"
}

# ูพุงู ุฎูุดโุขูุฏฺฏู ู ููุงูู
WELCOME_MESSAGE = f"""
{EMOJIS['home']} ุจู ุฑุจุงุช ฺฏููโููุง ุฎูุด ุขูุฏุฏ! {EMOJIS['success']}

ุจุฑุง ุงุณุชูุงุฏู ุงุฒ ุงู ุฑุจุงุชุ ูุทูุงู ููุงูู ุฒุฑ ุฑุง ูุทุงูุนู ู ุชุฃุฏ ฺฉูุฏ:

{EMOJIS['info']} ููุงูู ุงุณุชูุงุฏู ุงุฒ ุฑุจุงุช:
1. ุฏุฑ ุตูุฑุช ฺฉู ุตุงุญุจ ฺฉ ูฺฉุงู ูุณุชุฏุ ูุณุฆููุช ูุฑฺฏููู ูุดฺฉู ุง ุงุชูุงู ูุฑุชุจุท ุจุง ูฺฉุงู ุซุจุชโุดุฏู ุจุฑ ุนูุฏู ุดูุงุณุช.
2. ุงุฒ ุงุฑุณุงู ูุญุชูุง ุบุฑุงุฎูุงูุ ุชูููโุขูุฒ ุง ููุถโฺฉููุฏู ููุงูู ุฑุจุงุช ุฌุฏุงู ุฎูุฏุฏุงุฑ ฺฉูุฏ.
3. ุงุทูุงุนุงุช ูฺฉุงูโูุง ุฑุง ุจุง ุฏูุช ู ุตุญุช ูุงุฑุฏ ฺฉูุฏ.
4. ูุฑฺฏููู ุณูุกุงุณุชูุงุฏู ุงุฒ ุงุทูุงุนุงุช ูฺฉุงูโูุง ููููุน ุจูุฏู ู ููุฌุฑ ุจู ูุณุฏูุฏ ุดุฏู ุญุณุงุจ ฺฉุงุฑุจุฑ ุดูุง ุฎูุงูุฏ ุดุฏ.
5. ุฏุฑ ุตูุฑุช ููุถ ููุงููุ ุญุณุงุจ ุดูุง ูุณุฏูุฏ ุดุฏู ู ุจุฑุง ุฑูุน ูุณุฏูุฏุช ูุงุฒ ุจู ูพุฑุฏุงุฎุช ูุฒููโุง ุงูุฏฺฉ ุฎูุงูุฏ ุจูุฏ.

{EMOJIS['warning']} ุชูุฌู: ูุฑฺฏููู ุงุณุชูุงุฏู ุบุฑูุฌุงุฒ ุงุฒ ุงุทูุงุนุงุช ูฺฉุงูโูุง ูพฺฏุฑุฏ ูุงููู ุฏุงุฑุฏ.

ูุทูุงู ุจุง ุฏูุช ููุงูู ุฑุง ูุทุงูุนู ฺฉุฑุฏู ู ฺฏุฒูู ููุงุณุจ ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ:
"""

# ูุชุบุฑูุง ุญุงูุช ฺฉุงุฑุจุฑ
user_states = {}
user_data = {}
blocked_users = set()
user_comments = {}
user_messages = {}
user_blocked_contacts = {}  # ุจุฑุง ุฐุฎุฑู ฺฉุงุฑุจุฑุงู ฺฉู ุจูุงฺฉ ุดุฏูโุงูุฏ

# ุชูุธู ูพุงฺฏุงู ุฏุงุฏู
def init_db():
    conn = sqlite3.connect(DB_NAME)
    c = conn.cursor()
    c.execute('''CREATE TABLE IF NOT EXISTS users (
                 user_id INTEGER PRIMARY KEY,
                 name TEXT,
                 age INTEGER,
                 gender TEXT,
                 score INTEGER DEFAULT 0,
                 numeric_id INTEGER UNIQUE)''')
    c.execute('''CREATE TABLE IF NOT EXISTS places (
                 place_id INTEGER PRIMARY KEY AUTOINCREMENT,
                 user_id INTEGER,
                 category TEXT,
                 subcategory TEXT,
                 title TEXT,
                 description TEXT,
                 address TEXT,
                 phone TEXT,
                 photo TEXT,
                 morning_shift TEXT,
                 afternoon_shift TEXT,
                 rating_sum INTEGER DEFAULT 0,
                 rating_count INTEGER DEFAULT 0)''')
    c.execute('''CREATE TABLE IF NOT EXISTS place_ratings (
                 place_id INTEGER,
                 user_id INTEGER,
                 rating INTEGER,
                 PRIMARY KEY (place_id, user_id))''')
    c.execute('''CREATE TABLE IF NOT EXISTS news (
                 news_id INTEGER PRIMARY KEY AUTOINCREMENT,
                 content TEXT)''')
    c.execute('''CREATE TABLE IF NOT EXISTS comments (
                 comment_id INTEGER PRIMARY KEY AUTOINCREMENT,
                 place_id INTEGER,
                 user_id INTEGER,
                 comment_text TEXT,
                 timestamp DATETIME DEFAULT CURRENT_TIMESTAMP)''')
    c.execute('''CREATE TABLE IF NOT EXISTS reports (
                 report_id INTEGER PRIMARY KEY AUTOINCREMENT,
                 user_id INTEGER,
                 report_text TEXT,
                 timestamp DATETIME DEFAULT CURRENT_TIMESTAMP)''')
    c.execute('''CREATE TABLE IF NOT EXISTS top_place_requests (
                 request_id INTEGER PRIMARY KEY AUTOINCREMENT,
                 user_id INTEGER,
                 place_title TEXT,
                 status TEXT DEFAULT 'pending',
                 timestamp DATETIME DEFAULT CURRENT_TIMESTAMP)''')
    c.execute('''CREATE TABLE IF NOT EXISTS blocked_contacts (
                 block_id INTEGER PRIMARY KEY AUTOINCREMENT,
                 blocker_id INTEGER,
                 blocked_id INTEGER,
                 place_id INTEGER,
                 timestamp DATETIME DEFAULT CURRENT_TIMESTAMP)''')
    try:
        c.execute("ALTER TABLE places ADD COLUMN subcategory TEXT")
    except sqlite3.OperationalError:
        pass
    conn.commit()
    conn.close()

init_db()

# ุฏุณุชูโุจูุฏ ูฺฉุงูโูุง
PLACE_CATEGORIES = {
    "๐ฝ๏ธ ุฎูุฑุงฺฉ ู ููุดุฏู": [
        "ุฑุณุชูุฑุงูโูุง (ุณูุชุ ูุณุช ููุฏุ ุจูโุงููููุ ุฏุฑุงุ ฺฏุงูุฎูุงุฑ)",
        "ฺฉุงูู ู ฺฉุงูโุดุงูพ (ฺฉุงููโุฑุณุชูุฑุงูุ ูููู ุชุฎุตุต)",
        "ุจุณุชูโูุฑูุด ู ุขุจูููโูุฑูุด (ุจุณุชู ุณูุชุ ุจุณุชู ุงุชุงูุง)",
        "ุดุฑูโูพุฒ ู ูุงููุง (ูุงููุง ุณูุชุ ุดุฑูโูพุฒ ููุงุฏ)",
        "ุณูุฑูโุฎุงูู ู ฺุงุฎุงูู (ูููู ุฎุงูู ุณูุชุ ฺุงุฎุงูู ูุฏุฑู)",
        "ููุฏฺฉูุฑุช ู ูุฑุงฺฉุฒ ุบุฐุงุฎูุฑ",
        "ฺฉุจุงุจ ู ุฌฺฏุฑฺฉ (ฺฉุจุงุจโูุฑูุดุ ุฌฺฏุฑฺฉุ ุฏุฒโุณุฑุง)",
        "ุณุงูุฏูฺโูุฑูุด ู ูพุชุฒุงูุฑูุด (ูพุชุฒุงูุฑูุดุ ุณุงูุฏูฺโูุฑูุด ูุญู)",
        "ููุงุฏ ู ุดฺฉูุงุชโูุฑูุด (ุดฺฉูุงุชโูุฑูุด ุชุฎุตุตุ ุขุจูุจุงุชโูุฑูุด)",
        "ุขุฌูโูุฑูุด ู ุฎุดฺฉุจุงุฑ (ุขุฌูโูุฑูุดุ ุฎุดฺฉุจุงุฑูุฑูุด)",
        "ุณููพุฑูุงุฑฺฉุช ูุญู ู ูุงูพุฑ",
        "ูุตุงุจ ู ูุฑุบ ูุฑูุด (ูุตุงุจุ ูุฑุบโูุฑูุดุ ูุงูโูุฑูุด)",
        "ูููโูุฑูุด ู ุชุฑูโุจุงุฑ (ูููโูุฑูุดุ ุณุจุฒโูุฑูุด)",
        "ูุงูโูุฑูุด ู ุบุฐุงูุง ุฏุฑุง",
        "ูุฑูุดฺฏุงู ููุงุฏ ุบุฐุง ูุญู",
        "ุนุณูโูุฑูุด ู ูุญุตููุงุช ุฒูุจูุฑุฏุงุฑ",
        "ูุญุตููุงุช ูุญู ู ููุทููโุง",
        "ูุฑูุดฺฏุงู ูุญุตููุงุช ุงุฑฺฏุงูฺฉ",
        "ูุฑูุดฺฏุงู ููุงุฏ ุบุฐุง ููุฌูุฏ",
        "ูุฑูุดฺฏุงู ูุญุตููุงุช ูุจู ู ูพูุฑ",
        "ูุงูโูุฑูุด ุชุฎุตุต (ูุงู ุจุงฺฏุชุ ูุงู ุณูฺฏฺฉ)",
        "ุบุฐุงูุง ูุญู ู ุบุฐุงูุง ููู"
    ],
    "๐๏ธ ุฎุฑุฏ ู ูุฑูุด": [
        "ูพุงุณุงฺูุง ู ูุฑุงฺฉุฒ ุฎุฑุฏ (ูุงูุ ูุฑฺฉุฒ ุฎุฑุฏุ ุจุงุฒุงุฑฺู)",
        "ุณููพุฑูุงุฑฺฉุช ู ูุงูพุฑูุงุฑฺฉุช (ุฒูุฌุฑูโุงุ ูุญู)",
        "ูุฑูุดฺฏุงู ุฒูุฌุฑูโุง",
        "ุจุงุฒุงุฑ ุณูุช ู ุจุงุฒุงุฑฺูโูุง ูุญู (ุจุงุฒุงุฑ ุฑูุฒุ ุจุงุฒุงุฑ ููุชฺฏ)",
        "ูุฑูุดฺฏุงู ูพูุดุงฺฉ ู ฺฉู ู ฺฉูุด (ูุจุงุณ ูุฑุฏุงููุ ุฒูุงููุ ุจฺฺฏุงูู)",
        "ูุฑูุดฺฏุงู ููุงุฒู ุฎุงูฺฏ ู ุงูฺฉุชุฑููฺฉ (ููุงุฒู ุจุฑูุ ุฏุฌital)",
        "ูุฑูุดฺฏุงู ููุงุฒู ูุฑุฒุด (ูุฑุฒุดุ ฺฉููููุฑุฏุ ุดูุง)",
        "ฺฉุชุงุจโูุฑูุด ู ููุงุฒู ุงูุชุญุฑุฑ (ฺฉุชุงุจโูุฑูุด ุนูููุ ุชุฎุตุต)",
        "ูุบุงุฒู ููุจุงู ู ููพโุชุงูพ (ูุฑูุดุ ุชุนูุฑุ ููุงุฒู ุฌุงูุจ)",
        "ฺฏูโูุฑูุด ู ฺฏุงูุงู ุขูพุงุฑุชูุงู (ฺฏูโูุฑูุดุ ฺฏูโุขุฑุง)",
        "ุนูฺฉโูุฑูุด ู ุงูพุชฺฉ (ุนูฺฉโูุฑูุดุ ุนูฺฉโุณุงุฒ)",
        "ุนุทุฑ ู ุงุฏฺฉูู ูุฑูุด (ุนุทุฑ ูุฑูุดุ ูุญุตููุงุช ุขุฑุงุด)",
        "ุทูุง ู ุฌูุงูุฑ ูุฑูุด (ุทูุงูุฑูุดุ ุฌูุงูุฑูุฑูุด)",
        "ุณุงุนุชโูุฑูุด (ุณุงุนุช ูฺุ ุฏูุงุฑ)",
        "ููุงุฒู ุขุฑุงุด ู ุจูุฏุงุดุช (ุขุฑุงุดุ ุจูุฏุงุดุชุ ูุฑุงูุจุช ูพูุณุช)",
        "ุงุณุจุงุจโุจุงุฒโูุฑูุด (ุงุณุจุงุจโุจุงุฒุ ุจุงุฒ ูฺฉุฑ)",
        "ุตูุงุนโุฏุณุช ู ุณูุบุงุชโูุฑูุด (ุตูุงุน ุฏุณุชุ ุณูุบุงุช)",
        "ุฏฺฉูุฑุงุณูู ู ููุงุฒู ููุฒู (ุฏฺฉูุฑุงุณููุ ููุงุฒู ุชุฒุฆู)",
        "ูุฑุด ู ฺฏูู ูุฑูุด (ูุฑุดโูุฑูุดุ ฺฏููโูุฑูุด)",
        "ูพุงุฑฺูโูุฑูุด ู ุฎุงุท (ูพุงุฑฺูโูุฑูุดุ ุฎุงุท)",
        "ฺุฑูโูุฑูุด ู ฺฉูโุณุงุฒ (ฺุฑูโูุฑูุดุ ฺฉูโุฏูุฒ)",
        "ูุฑูุดฺฏุงู ููุงุฒู ุขุดูพุฒุฎุงูู (ุธุฑููุ ููุงุฒู ุขุดูพุฒ)",
        "ูุฑูุดฺฏุงู ููุงุฒู ุจุงุบุจุงู (ููุงุฒู ุจุงุบุจุงูุ ููุงู)",
        "ูุฑูุดฺฏุงู ุญูุงูุงุช ุฎุงูฺฏ (ุญูุงูุงุชุ ุบุฐุง ุญูุงูุงุช)",
        "ูุฑูุดฺฏุงู ุฏูฺุฑุฎู ู ุงุณฺฉูุชุฑ (ุฏูฺุฑุฎูุ ุงุณฺฉูุชุฑุ ููุงุฒู)",
        "ูุฑูุดฺฏุงู ุงุจุฒุงุฑุขูุงุช (ุงุจุฒุงุฑ ุตูุนุชุ ุฏุณุช)",
        "ูุฑูุดฺฏุงู ฺฉุงููพูุชุฑ ู ฺฏู (ฺฉุงููพูุชุฑุ ฺฉูุณูู ุจุงุฒ)",
        "ูุฑูุดฺฏุงู ูุจุงุณ ุนุฑูุณ ู ูุฑุงุณู",
        "ูุฑูุดฺฏุงู ฺฉุงุฏู ู ูุฏู",
        "ูุฑูุดฺฏุงู ูุญุตููุงุช ูุฑููฺฏ (ุณ ุฏุ ุฏ ู ุฏุ ุขุซุงุฑ ููุฑ)",
        "ูุฑูุดฺฏุงู ูุญุตููุงุช ุฏุณุชโุฏูู",
        "ูุฑูุดฺฏุงู ูุญุตููุงุช ุณูุงูุช ู ุชูุฏุฑุณุช",
        "ูุฑูุดฺฏุงู ูุญุตููุงุช ุฑูุณุชุง ู ูุญู"
    ],
    "โ๏ธ ุฒุจุง ู ุขุฑุงุด": [
        "ุขุฑุงุดฺฏุงู ูุฑุฏุงูู (ุขุฑุงุดฺฏุงูุ ุงุตูุงุญ)",
        "ุขุฑุงุดฺฏุงู ุฒูุงูู (ุขุฑุงุดุ ุฑูฺฏ ูู)",
        "ุณุงููโูุง ุฒุจุง ู ุงุณูพุง (ุงุณูพุงุ ูุงุณุงฺ)",
        "ูฺู ู ุงุจุฑู (ุงฺฉุณุชูุดู ูฺูุ ูฺฉุฑูุจูุฏูฺฏ)",
        "ูุงุฎูโฺฉุงุฑ (ูุงูฺฉูุฑุ ูพุฏฺฉูุฑุ ูุงุฎู ูุตููุน)",
        "ุชุชู ู ะผะธะบัะพะฟฺฏููุชุดู (ุชุงุชูุ ูฺฉุฑููพฺฏููุชุดู)",
        "ุณุงููโูุง ุชุงุชู ู ูพุฑุณูฺฏ (ูพุฑุณูฺฏุ ุชุงุชู ุญูุง)",
        "ูุฑุงฺฉุฒ ุฎุฏูุงุช ูพูุณุช ู ูู (ูพุงฺฉุณุงุฒ ูพูุณุชุ ูุฒุฑ)",
        "ูุฑูุดฺฏุงู ููุงุฒู ุขุฑุงุด ุญุฑููโุง",
        "ูุฑุงฺฉุฒ ูุงุณุงฺ ู ุฑูฺฉุณุดู (ูุงุณุงฺ ุฏุฑูุงูุ ุฑูฺฉุณุดู)",
        "ูุฑุงฺฉุฒ ุงูพูุงุณูู ู ูุฒุฑ",
        "ุณุงููโูุง ุจุฑูุฒู ฺฉุฑุฏู",
        "ูุฑุงฺฉุฒ ูุดุงูุฑู ุฒุจุง",
        "ุขููุฒุดฺฏุงูโูุง ุขุฑุงุดฺฏุฑ",
        "ูุฑุงฺฉุฒ ุฎุฏูุงุช ุจูุฏุงุดุช ูุฑุฏุงูู"
    ],
    "๐ฅ ุฏุฑูุงู ู ุณูุงูุช": [
        "ุจูุงุฑุณุชุงู ู ูุฑุงฺฉุฒ ุฏุฑูุงู (ุนูููุ ุชุฎุตุตุ ุฎุตูุต)",
        "ุฏุฑูุงูฺฏุงู ู ฺฉููฺฉโูุง ุชุฎุตุต (ุฎุงููุงุฏูุ ุฒูุงูุ ููุจ)",
        "ุฏุงุฑูุฎุงูู (ุดุจุงููโุฑูุฒุ ฺฏุงู)",
        "ุฏูุฏุงูโูพุฒุดฺฉ ู ุงุฑุชูุฏูุณ (ุนูููุ ุชุฎุตุตุ ุฒุจุง)",
        "ุขุฒูุงุดฺฏุงู ูพุฒุดฺฉ ู ุฑุงุฏูููฺ (ุขุฒูุงุดฺฏุงูุ ุณูููฺฏุฑุงู)",
        "ฺฉููฺฉ ุฒุจุง ู ูุฒุฑ (ูุฒุฑุ ุจูุชุงฺฉุณุ ฺู)",
        "ูุฑุงฺฉุฒ ูุฒูุชุฑุงูพ ู ฺฉุงุฑุฏุฑูุงู (ูุฒูุชุฑุงูพุ ฺฉุงุฑุฏุฑูุงู)",
        "ุฏุงููพุฒุดฺฉ ู ฺฉููฺฉ ุญูุงูุงุช (ุฏุงููพุฒุดฺฉุ ุญูุงูุงุช ุฎุงูฺฏ)",
        "ูุฑุงฺฉุฒ ุชูุงูุจุฎุด (ุชูุงูุจุฎุดุ ฺฏูุชุงุฑุฏุฑูุงู)",
        "ูุฑุงฺฉุฒ ูุดุงูุฑู ู ุฑูุงูุดูุงุณ (ูุดุงูุฑูุ ุฑูุงูุดูุงุณ)",
        "ุดููุงโุณูุฌ ู ุณูุนฺฉ (ุณูุนฺฉุ ุดููุงโุณูุฌ)",
        "ุจูุงโุณูุฌ ู ุนูฺฉโุณุงุฒ (ุจูุงโุณูุฌุ ุนูฺฉโุณุงุฒ)",
        "ูพุฑุณุชุงุฑ ุฏุฑ ููุฒู (ูพุฑุณุชุงุฑุ ูพุฒุดฺฉ ุฏุฑ ููุฒู)",
        "ุชุฌูุฒุงุช ูพุฒุดฺฉ (ูุฑูุดุ ุงุฌุงุฑู)",
        "ูุฑุงฺฉุฒ ุงูุฏุง ุฎูู",
        "ูุฑุงฺฉุฒ ุทุจ ุณูุช ู ฺฏุงูุงู ุฏุงุฑู",
        "ูุฑุงฺฉุฒ ูุงุณุงฺ ุฏุฑูุงู",
        "ูุฑุงฺฉุฒ ุชุฑฺฉ ุงุนุชุงุฏ",
        "ูุฑุงฺฉุฒ ุฎุฏูุงุช ูพุฑุณุชุงุฑ",
        "ูุฑุงฺฉุฒ ุฎุฏูุงุช ูพุฒุดฺฉ ุณุงุฑ",
        "ูุฑุงฺฉุฒ ุชุตูุฑุจุฑุฏุงุฑ ูพุฒุดฺฉ",
        "ูุฑุงฺฉุฒ ุฎุฏูุงุช ูพุฒุดฺฉ ูุฑุฒุด"
    ],
    "โฝ ูุฑุฒุด ู ุณุฑฺฏุฑู": [
        "ุจุงุดฺฏุงู ูุฑุฒุด ู ุจุฏูุณุงุฒ (ุจุฏูุณุงุฒุ ฺฉุฑุงุณูุช)",
        "ุงุณุชุฎุฑ ู ูุฌููุนู ูุฑุฒุด (ุงุณุชุฎุฑุ ุณููุงุ ุฌฺฉูุฒ)",
        "ุณุงูู ููุชุณุงู ู ุจุณฺฉุชุจุงู (ููุชุณุงูุ ุจุณฺฉุชุจุงูุ ูุงูุจุงู)",
        "ุณููุง ู ุชุฆุงุชุฑ (ุณููุงุ ุชุฆุงุชุฑุ ููุงุด)",
        "ุดูุฑุจุงุฒ ู ูพุงุฑฺฉ ุจุงุฒ (ุดูุฑุจุงุฒุ ูพุงุฑฺฉ ุจุงุฒ)",
        "ุจูุงุฑุฏ ู ุจูููฺฏ (ุจูุงุฑุฏุ ุจูููฺฏุ ุฏุงุฑุช)",
        "ูุฑุงฺฉุฒ ุชูุฑุญ ุฎุงููุงุฏฺฏ (ุชูุฑุญุ ุจุงุฒ)",
        "ูุฑุงฺฉุฒ ูุฑููฺฏ ู ููุฑ (ูุฑููฺฏุ ููุฑ)",
        "ุณุงููโูุง ฺฉูุณุฑุช ู ููุงุด (ฺฉูุณุฑุชุ ููุงุด)",
        "ฺฏูโูุช ู ูุฑุงฺฉุฒ ุจุงุฒ (ฺฏูโูุชุ ุจุงุฒ ฺฉุงููพูุชุฑ)",
        "ุจุงุดฺฏุงู ุชุฑุงูุฏุงุฒ (ุชุฑุงูุฏุงุฒุ ฺฉูุงูโุงูุฏุงุฒ)",
        "ุจุงุดฺฏุงู ุณููุง ู ุฎุงูู ููู",
        "ูุฑุงฺฉุฒ ุขููุฒุด ููุณู (ุขููุฒุด ููุณูุ ููุงุฒูุฏฺฏ)",
        "ฺฉุชุงุจุฎุงูู ุนููู (ุนูููุ ุชุฎุตุต)",
        "ูฺฏุงุฑุฎุงูู ู ููุงุดฺฏุงู ููุฑ (ูฺฏุงุฑุฎุงููุ ููุงุดฺฏุงู)",
        "ูุฑุงฺฉุฒ ุจุงุฒ ุงุชุงู ูุฑุงุฑ",
        "ูุฑุงฺฉุฒ ูพูุช ุจุงู ู ูุฒุฑุชฺฏ",
        "ุจุงุดฺฏุงูโูุง ุฑูุต ู ุจุงูู",
        "ูุฑุงฺฉุฒ ูฺฏุง ู ูุฏุชุดู",
        "ุจุงุดฺฏุงูโูุง ูุฑุฒุดโูุง ุฑุฒู",
        "ูุฑุงฺฉุฒ ุงุณฺฉุช ู ุฑููุฑ",
        "ุจุงุดฺฏุงูโูุง ุจูฺฉุณ ู ููุฑูุง ุฑุฒู ุชุฑฺฉุจ",
        "ูุฑุงฺฉุฒ ูุฑุฒุดโูุง ุขุจ",
        "ุจุงุดฺฏุงูโูุง ฺฏolf ู ุชูุณ",
        "ูุฑุงฺฉุฒ ูุงูฺฏุฑ ู ุดฺฉุงุฑ",
        "ุจุงุดฺฏุงูโูุง ุณูุงุฑฺฉุงุฑ"
    ],
    "๐จ ุงูุงูุช ู ุณูุฑ": [
        "ูุชู ู ูุชู ุขูพุงุฑุชูุงู (ูุชูุ ูุชู ุขูพุงุฑุชูุงู)",
        "ูุณุงูุฑุฎุงูู ู ูููุงููพุฐุฑ (ูุณุงูุฑุฎุงููุ ูููุงููพุฐุฑ)",
        "ุงูุงูุชฺฏุงู ุจููโฺฏุฑุฏ (ุจููโฺฏุฑุฏุ ุงูุงูุชฺฏุงู ูุญู)",
        "ููุง ู ุณูุฆุช ุงุฌุงุฑูโุง (ููุงุ ุณูุฆุช)",
        "ฺฉููพูฺฏ ู ุงุฑุฏูฺฏุงู (ฺฉููพูฺฏุ ุงุฑุฏูฺฏุงู)",
        "ุขฺุงูุณ ูุณุงูุฑุช ู ฺฏุฑุฏุดฺฏุฑ (ูุณุงูุฑุชุ ฺฏุฑุฏุดฺฏุฑ)",
        "ุงุณุชฺฏุงู ูุทุงุฑ ู ุงุชูุจูุณ (ูุทุงุฑุ ุงุชูุจูุณ)",
        "ูุฑูุฏฺฏุงู ู ูพุงุงูู ูุณุงูุฑ (ูุฑูุฏฺฏุงูุ ูพุงุงูู)",
        "ูุฑุงฺฉุฒ ุฑุฒุฑูุงุณูู (ุฑุฒุฑู ูotelุ ุจูุท)",
        "ุฎุฏูุงุช ูุฒุง ู ูพุงุณูพูุฑุช (ูุฒุงุ ูพุงุณูพูุฑุช)",
        "ุงุฌุงุฑู ุฎูุฏุฑู ู ุฏูฺุฑุฎู (ุงุฌุงุฑู ูุงุดูุ ุฏูฺุฑุฎู)",
        "ุฑุงูููุงุงู ฺฏุฑุฏุดฺฏุฑ (ุชูุฑูุฏุฑุ ุฑุงูููุง)",
        "ูุฑุงฺฉุฒ ุงุทูุงุนุงุช ฺฏุฑุฏุดฺฏุฑ",
        "ุฎุฏูุงุช ุชุฑุฌูู ู ุฑุงูููุง ูุญู",
        "ูุฑุงฺฉุฒ ฺฉุฑุงู ุงุชููุจู",
        "ุฎุฏูุงุช ุงูุชูุงู ูุณุงูุฑ (ุญูู ู ูููุ ุชุฑุงูุณูุฑ)",
        "ูุฑุงฺฉุฒ ุฑุฒุฑูุงุณูู ุขููุงู",
        "ุฎุฏูุงุช ุจูู ูุณุงูุฑุช",
        "ูุฑุงฺฉุฒ ุฎุฏูุงุช ุฌูุงูฺฏุฑุฏ"
    ],
    "๐๏ธ ุฎุฏูุงุช ุนููู ู ุงุฏุงุฑ": [
        "ุจุงูฺฉ ู ุฎูุฏูพุฑุฏุงุฒ (ุจุงูฺฉุ ุตุฑุงู)",
        "ุงุฏุงุฑู ูพost (ูพุณุชุ ูพฺฉ ููุชูุฑ)",
        "ุฏูุงุชุฑ ูพุดุฎูุงู ุฎุฏูุงุช ุฏููุช (ูพุดุฎูุงูุ ุฎุฏูุงุช ุงูฺฉุชุฑููฺฉ)",
        "ุดูุฑุฏุงุฑ ู ูุฑุงฺฉุฒ ุฎุฏูุงุช ุดูุฑ (ุดูุฑุฏุงุฑุ ุฎุฏูุงุช ุดูุฑ)",
        "ุงุฏุงุฑู ุจุฑูุ ุขุจุ ฺฏุงุฒ (ุจุฑูุ ุขุจุ ฺฏุงุฒ)",
        "ูพูุณ +ฑฐ ู ูุฑุงฺฉุฒ ุงูุชุธุงู (ูพูุณุ ุงูุชุธุงู)",
        "ุฏุงุฏฺฏุงู ู ูุฑุงุฌุน ูุถุง (ุฏุงุฏฺฏุงูุ ูุถุง)",
        "ฺฉูุงูุชุฑ ู ูพุงุณฺฏุงู (ฺฉูุงูุชุฑุ ูพุงุณฺฏุงู)",
        "ุฏูุงุชุฑ ุงุณูุงุฏ ุฑุณู (ุงุณูุงุฏ ุฑุณูุ ุฏูุชุฑุฎุงูู)",
        "ูุฑุงฺฉุฒ ุตุฏูุฑ ฺฏูุงููุงูู (ฺฏูุงููุงููุ ูุฏุงุฑฺฉ)",
        "ุงุฏุงุฑุงุช ุฏููุช ู ูุฒุงุฑุชุฎุงููโูุง (ุฏููุชุ ูุฒุงุฑุชุฎุงูู)",
        "ฺฉูุณููฺฏุฑ ู ุณูุงุฑุชุฎุงููโูุง (ุณูุงุฑุชุ ฺฉูุณููฺฏุฑ)",
        "ูุฑุงฺฉุฒ ุฎุฏูุงุช ุงูฺฉุชุฑููฺฉ (ุฎุฏูุงุช ุขููุงูุ ุฏููุช ุงูฺฉุชุฑููฺฉ)",
        "ูุฑุงฺฉุฒ ุฎุฏูุงุช ูุดุงูุฑู ุดุบู",
        "ุฏูุงุชุฑ ุฎุฏูุงุช ูุณฺฉู ู ุงููุงฺฉ",
        "ูุฑุงฺฉุฒ ุฎุฏูุงุช ุญููู ู ูุถุง",
        "ุฏูุงุชุฑ ุฎุฏูุงุช ููุงุฌุฑุช",
        "ูุฑุงฺฉุฒ ุฎุฏูุงุช ูุงู ู ุญุณุงุจุฏุงุฑ",
        "ุฏูุงุชุฑ ุฎุฏูุงุช ุจููโุง",
        "ูุฑุงฺฉุฒ ุฎุฏูุงุช ุชุนูุฑุงุช ุดูุฑ",
        "ุฏูุงุชุฑ ุฎุฏูุงุช ูพูุงูฺฉุงุฑ"
    ],
    "๐ ุฎุฏูุงุช ุดูุฑ ู ุญููโูููู": [
        "ูพููพ ุจูุฒู ู CNG (ุจูุฒูุ ฺฏุงุฒ)",
        "ฺฉุงุฑูุงุด ู ุฎุฏูุงุช ุฎูุฏุฑู (ฺฉุงุฑูุงุดุ ุจุฑุงูโุณุงุฒ)",
        "ุชุนูุฑฺฏุงู ุฎูุฏุฑู ู ููุชูุฑุณฺฉูุช (ุชุนูุฑฺฏุงูุ ูฺฉุงูฺฉ)",
        "ุชุงฺฉุณโุณุฑูุณ ู ุชุงฺฉุณ ุงูุชุฑูุช (ุชุงฺฉุณุ ุงุณููพ)",
        "ูพุงุฑฺฉูฺฏ ุนููู (ูพุงุฑฺฉูฺฏุ ุฌุง ูพุงุฑฺฉ)",
        "ูฺฉุงูฺฉ ู ุจุฑู ุฎูุฏุฑู (ูฺฉุงูฺฉุ ุจุฑู ุฎูุฏุฑู)",
        "ูุงุณุชฺฉโูุฑูุด ู ูุฑูุด ููุงุฒู ุฏฺฉ (ูุงุณุชฺฉุ ููุงุฒู ุฏฺฉ)",
        "ุฎุฏูุงุช ููุงุด ู ุชุฑูู ุฎูุฏุฑู (ููุงุดุ ุชุฑูู)",
        "ูุฑุงฺฉุฒ ูุนุงูู ูู (ูุนุงูู ููุ ุชุณุช ุฎูุฏุฑู)",
        "ุฎุฏูุงุช ุงูุฏุงุฏ ุฎูุฏุฑู (ุฎุฏูุงุช ุงูุฏุงุฏุ ุฏฺฉโฺฉุด)",
        "ููุงูุฏฺฏ ุฎูุฏุฑู (ููุงูุฏฺฏุ ูุฑูุด ุฎูุฏุฑู)",
        "ูุฑูุดฺฏุงู ููุงุฒู ุฌุงูุจ ุฎูุฏุฑู (ููุงุฒู ุฌุงูุจุ ุชุฒุฆูุงุช)",
        "ุฎุฏูุงุช ุชูุธู ููุชูุฑ ู ุงูฺฺฉุชูุฑ",
        "ุฎุฏูุงุช ุตุงูฺฉุงุฑ ู ุฌููุจูุฏ",
        "ุฎุฏูุงุช ุชุนูุถ ุฑูุบู ู ููุชุฑ",
        "ุฎุฏูุงุช ุณุณุชู ุชููู ู ฺฉููุฑ",
        "ุฎุฏูุงุช ุชุนูุฑุงุช ุชุฎุตุต ุฎูุฏุฑู",
        "ุฎุฏูุงุช ฺฉุงุฑุชโุฎูุงู ู ูพุฑุฏุงุฎุช",
        "ุฎุฏูุงุช ูพุฎุด ูุญุตููุงุช ุฎูุฏุฑู",
        "ุฎุฏูุงุช ุญูู ู ููู ูุนูููู ู ุณุงูููุฏุงู"
    ],
    "๐ ุขููุฒุด ู ูุฑููฺฏ": [
        "ูุฏุฑุณู ู ุขููุฒุดฺฏุงู (ุฏุจุณุชุงูุ ุฏุจุฑุณุชุงู)",
        "ุฏุงูุดฺฏุงู ู ูุฑุงฺฉุฒ ุขููุฒุด ุนุงู (ุฏุงูุดฺฏุงูุ ููุณุณู ุขููุฒุด ุนุงู)",
        "ุขููุฒุดฺฏุงู ุฒุจุงู (ุฒุจุงู ุงูฺฏูุณุ ุณุงุฑ ุฒุจุงูโูุง)",
        "ุขููุฒุดฺฏุงู ููโูุญุฑููโุง (ููุ ุญุฑููโุง)",
        "ฺฉุชุงุจุฎุงูู ุนููู (ุนูููุ ุชุฎุตุต)",
        "ูุฑููฺฏุณุฑุง ู ุฎุงูู ูุฑููฺฏ (ูุฑููฺฏุณุฑุงุ ุฎุงูู ูุฑููฺฏ)",
        "ููุฒู ู ฺฏุงูุฑ (ููุฒูุ ฺฏุงูุฑ ููุฑ)",
        "ูุฑุงฺฉุฒ ุขููุฒุด ฺฉุงููพูุชุฑ (ฺฉุงููพูุชุฑุ ุจุฑูุงููโููุณ)",
        "ูุฑุงฺฉุฒ ูุดุงูุฑู ุชุญุตู (ูุดุงูุฑูุ ุงูุชุฎุงุจ ุฑุดุชู)",
        "ุขููุฒุดฺฏุงูโูุง ููุฑ (ููุงุดุ ูุฌุณููโุณุงุฒ)",
        "ูุฑุงฺฉุฒ ุขููุฒุด ุฑุงููุฏฺฏ (ุขููุฒุด ุฑุงููุฏฺฏุ ุขูโูุงูู)",
        "ููุฏฺฉูุฏฺฉ ู ูพุดโุฏุจุณุชุงู (ููุฏฺฉูุฏฺฉุ ูพุดโุฏุจุณุชุงู)",
        "ูุฑุงฺฉุฒ ุขููุฒุด ุนููู ูุฎุชูู (ุฑุงุถุ ูุฒikuุ ุดู)",
        "ูุฑุงฺฉุฒ ุขููุฒุด ููุงุฑุชโูุง ุฒูุฏฺฏ",
        "ุขููุฒุดฺฏุงูโูุง ุขุดูพุฒ ู ุดุฑูโูพุฒ",
        "ูุฑุงฺฉุฒ ุขููุฒุด ุฎูุงูุช ฺฉูุฏฺฉุงู",
        "ุขููุฒุดฺฏุงูโูุง ฺฉูฺฉูุฑ ู ุขุฒููู",
        "ูุฑุงฺฉุฒ ุขููุฒุด ุงุฒ ุฑุงู ุฏูุฑ",
        "ุขููุฒุดฺฏุงูโูุง ููุงุฑุชโุขููุฒ",
        "ูุฑุงฺฉุฒ ุขููุฒุด ุตูุงุน ุฏุณุช",
        "ุขููุฒุดฺฏุงูโูุง ุฎุงุท ู ุทุฑุงุญ ูุจุงุณ",
        "ูุฑุงฺฉุฒ ุขููุฒุด ุนฺฉุงุณ ู ูููุจุฑุฏุงุฑ",
        "ุขููุฒุดฺฏุงูโูุง ูุฑุฒุด ุชุฎุตุต",
        "ูุฑุงฺฉุฒ ุขููุฒุด ููุณู ูุญู",
        "ุขููุฒุดฺฏุงูโูุง ุฒุจุงู ุงุดุงุฑู",
        "ุฎุฏูุงุช ุขููุฒุด ูุฌุงุฒ ู ุขููุงู"
    ],
    "๐ ูุฐูุจ ู ูุนูู": [
        "ูุณุฌุฏ ู ูุตู (ูุณุฌุฏุ ูุตู)",
        "ุญุณูู ู ูุฆุช (ุญุณููุ ูุฆุช)",
        "ฺฉูุณุง ู ูุฑุงฺฉุฒ ูุณุญ (ฺฉูุณุงุ ูุฑุงฺฉุฒ ูุณุญ)",
        "ฺฉูุณู ู ูุฑุงฺฉุฒ ููุฏ (ฺฉูุณูุ ูุฑุงฺฉุฒ ููุฏ)",
        "ูุนุงุจุฏ ู ูพุฑุณุชุดฺฏุงูโูุง (ูุนุจุฏุ ูพุฑุณุชุดฺฏุงู)",
        "ูุฑุงฺฉุฒ ุนุฑูุงู ู ูุนูู (ุนุฑูุงูุ ูุนูู)",
        "ฺฉุชุงุจูุฑูุดโูุง ูุฐูุจ (ฺฉุชุงุจ ูุฐูุจุ ูุฑู ุงูุฒุงุฑ ูุฐูุจ)",
        "ูุฑุงฺฉุฒ ุฎุฑู ู ูฺฉูฺฉุงุฑ (ุฎุฑูุ ูฺฉูฺฉุงุฑ)",
        "ุงูุชุดุงุฑุงุช ูุฐูุจ (ุงูุชุดุงุฑุงุชุ ฺุงูพ ูุฐูุจ)",
        "ูุฑุงฺฉุฒ ุญูุธ ูุฑุขู ู ูุนุงุฑู ุงุณูุงู",
        "ูุฑุงฺฉุฒ ุฎุฏูุงุช ุญุฌ ู ุฒุงุฑุช",
        "ูุฑุงฺฉุฒ ูุดุงูุฑู ูุฐูุจ ู ุฏู",
        "ูุฑุงฺฉุฒ ุขููุฒุด ุงุญฺฉุงู ู ูุนุงุฑู",
        "ูุฑุงฺฉุฒ ุฎุฏูุงุช ุงููุงู ู ุงููุฑ ุฎุฑู",
        "ูุฑุงฺฉุฒ ุฎุฏูุงุช ูุฐูุจ ุณุงุฑ",
        "ูุฑุงฺฉุฒ ุจุฑฺฏุฒุงุฑ ูุฑุงุณู ูุฐูุจ"
    ],
    "๐ณ ุทุจุนุช ู ุชูุฑุญ ุขุฒุงุฏ": [
        "ูพุงุฑฺฉ ู ุจูุณุชุงู (ูพุงุฑฺฉ ุนูููุ ุจูุณุชุงู)",
        "ุจุงุบ ูุญุด ู ุขฺฉูุงุฑูู (ุจุงุบ ูุญุดุ ุขฺฉูุงุฑูู)",
        "ุจุงุบ ฺฏุงูโุดูุงุณ (ฺฏุงูโุดูุงุณุ ฺฏูุฎุงูู)",
        "ูพุณุช ุฏูฺุฑุฎูโุณูุงุฑ (ุฏูฺุฑุฎูโุณูุงุฑุ ุฏูฺุฑุฎู ุณูุงุฑ ุขูุฑูุฏ)",
        "ฺฉููุณุชุงู ู ูุณุฑูุง ุทุจุนุชโฺฏุฑุฏ (ฺฉููููุฑุฏุ ุทุจุนุชโฺฏุฑุฏ)",
        "ุณุงุญู ู ุฏุฑุงฺู (ุณุงุญูุ ุฏุฑุงฺู)",
        "ุขุจุดุงุฑ ู ฺุดูู (ุขุจุดุงุฑุ ฺุดูู)",
        "ุฌูฺฏู ู ููุทูู ุญูุงุธุช ุดุฏู (ุฌูฺฏูุ ููุทูู ุญูุงุธุช ุดุฏู)",
        "ฺฉููพูฺฏ ู ูพฺฉูฺฉ (ฺฉููพูฺฏุ ูพฺฉูฺฉ)",
        "ูุฑุงฺฉุฒ ุงฺฉูุชูุฑism (ุงฺฉูุชูุฑุณูุ ฺฏุฑุฏุดฺฏุฑ ุทุจุนุช)",
        "ูพุณุช ุงุณฺฉ ู ูุฑุฒุดโูุง ุฒูุณุชุงู (ุงุณฺฉุ ูุฑุฒุด ุฒูุณุชุงู)",
        "ุณุงููโูุง ุจููุฏุฑูฺฏ ู ุตุฎุฑูโููุฑุฏ (ุตุฎุฑูโููุฑุฏุ ุจููุฏุฑูฺฏ)",
        "ูุฑุงฺฉุฒ ูุงูฺฏุฑ ู ูุงูโุฑุงู",
        "ูพุงุฑฺฉโูุง ุขุจ ู ุงุณุชุฎุฑูุง ุฑูุจุงุฒ",
        "ูุฑุงฺฉุฒ ูพุฑูุฏูโูฺฏุฑ ู ุญุงุช ูุญุด",
        "ูุณุฑูุง ูพุงุฏูโุฑู ู ฺฉูููพูุง",
        "ูุฑุงฺฉุฒ ฺุงุฏุฑุฒู ู ฺฉุงุฑูุงููฺฏ",
        "ูพุงุฑฺฉโูุง ูู ู ููุงุทู ฺฏุฑุฏุดฺฏุฑ",
        "ูุฑุงฺฉุฒ ุขููุฒุด ุทุจุนุชโฺฏุฑุฏ",
        "ูุฑุงฺฉุฒ ุฎุฏูุงุช ุชูุฑูุง ุทุจุนุช"
    ],
    "๐ผ ฺฉุณุจโูฺฉุงุฑ ู ุญุฑููโุง": [
        "ุฏูุชุฑ ฺฉุงุฑ ู ุดุฑฺฉุชโูุง (ุฏูุชุฑุ ุดุฑฺฉุช)",
        "ฺฉุงุฑุฎุงููโูุง ู ูุงุญุฏูุง ุชููุฏ (ฺฉุงุฑุฎุงููุ ุชููุฏ)",
        "ฺฉุงุฑฺฏุงูโูุง ุตูุนุช (ฺฉุงุฑฺฏุงูุ ุตูุนุช)",
        "ุฏูุงุชุฑ ุงููุงฺฉ ู ูุดุงูุฑู ุงููุงฺฉ (ุงููุงฺฉุ ูุดุงูุฑ ุงููุงฺฉ)",
        "ุฏูุงุชุฑ ุจูู (ุจููุ ุฎุฏูุงุช ุจููโุง)",
        "ุดุฑฺฉุชโูุง ุชุจูุบุงุช ู ุจุงุฒุงุฑุงุจ (ุชุจูุบุงุชุ ุจุงุฒุงุฑุงุจ)",
        "ูุฑุงฺฉุฒ ุทุฑุงุญ ู ฺุงูพ (ุทุฑุงุญุ ฺุงูพ)",
        "ุดุฑฺฉุชโูุง ูุนูุงุฑ ู ุนูุฑุงู (ูุนูุงุฑุ ุนูุฑุงู)",
        "ุฏูุงุชุฑ ุญููู ู ูฺฉุงูุช (ุญูููุ ูฺฉุงูุช)",
        "ุดุฑฺฉุชโูุง ูุดุงูุฑู ูุฏุฑุช (ูุดุงูุฑูุ ูุฏุฑุช)",
        "ูุฑุงฺฉุฒ ุฎุฏูุงุช ูุงู ู ุญุณุงุจุฏุงุฑ (ูุงูุ ุญุณุงุจุฏุงุฑ)",
        "ุดุฑฺฉุชโูุง ููุงูุฑ ุงุทูุงุนุงุช (ููุงูุฑ ุงุทูุงุนุงุชุ ูุฑูโุงูุฒุงุฑ)",
        "ุงุณุชูุฏููุง ุนฺฉุงุณ ู ูููุจุฑุฏุงุฑ (ุนฺฉุงุณุ ูููุจุฑุฏุงุฑ)",
        "ูุฑุงฺฉุฒ ุฎุฏูุงุช ุงุฏุงุฑ ู ฺฉูพ (ุฎุฏูุงุช ุงุฏุงุฑุ ฺฉูพ)",
        "ุดุฑฺฉุชโูุง ุญูู ู ููู ู ุจุงุฑุจุฑ (ุญูู ูููุ ุจุงุฑุจุฑ)",
        "ุฎุฏูุงุช ูุธุงูุช ู ูฺฏูุฏุงุฑ (ูุธุงูุชุ ูฺฏูุฏุงุฑ)",
        "ุดุฑฺฉุชโูุง ุฑุณุงููโุง ู ุงูุชุดุงุฑุงุช",
        "ูุฑุงฺฉุฒ ุชุญููุงุช ู ุชูุณุนู",
        "ุดุฑฺฉุชโูุง ูุดุงูุฑู ููุงุจุน ุงูุณุงู",
        "ูุฑุงฺฉุฒ ุฎุฏูุงุช ูุดุงูุฑู ฺฉุณุจโูฺฉุงุฑ",
        "ุดุฑฺฉุชโูุง ุทุฑุงุญ ุณุงุช ู ุจูููโุณุงุฒ ููุชูุฑ ุฌุณุชุฌู",
        "ูุฑุงฺฉุฒ ุฎุฏูุงุช ุชุฑุฌูู ู ูุชุฑุฌู",
        "ุดุฑฺฉุชโูุง ุฎุฏูุงุช ุงููุช",
        "ูุฑุงฺฉุฒ ุฎุฏูุงุช ูพุดุชุจุงู ููุงูุฑ ุงุทูุงุนุงุช",
        "ุดุฑฺฉุชโูุง ุฎุฏูุงุช ูุดุงูุฑู ูุงูุงุช",
        "ูุฑุงฺฉุฒ ุฎุฏูุงุช ุจุฑูุฏูฺฏ ู ููุช ุณุงุฒ",
        "ุฎุฏูุงุช ูุดุงูุฑู ุงูุฑฺ ู ุจูููโุณุงุฒ"
    ],
    "๐งฐ ุฎุฏูุงุช ุชุฎุตุต ู ูู": [
        "ุชุนูุฑฺฏุงู ููุงุฒู ุฎุงูฺฏ (ุชุนูุฑ ููุงุฒูุ ุณุฑูุณ)",
        "ุชุนูุฑฺฏุงู ููุจุงู ู ฺฉุงููพูุชุฑ (ุชุนูุฑ ููุจุงูุ ฺฉุงููพูุชุฑ)",
        "ุฎุฏูุงุช ุจุฑู ุณุงุฎุชูุงู (ุจุฑูโฺฉุงุฑุ ุณูโฺฉุด)",
        "ุฎุฏูุงุช ููููโฺฉุด ู ุชุงุณุณุงุช (ููููโฺฉุดุ ุชุงุณุณุงุช)",
        "ุฎุฏูุงุช ููุงุด ุณุงุฎุชูุงู (ููุงุด ุณุงุฎุชูุงูุ ุฑูฺฏโฺฉุงุฑ)",
        "ุฎุฏูุงุช ฺฉุงุจูุช ุณุงุฒ ู ูุฌุงุฑ (ฺฉุงุจูุชโุณุงุฒุ ูุฌุงุฑ)",
        "ุฎุฏูุงุช ุขููฺฏุฑ ู ุฌูุดฺฉุงุฑ (ุขููฺฏุฑุ ุฌูุดฺฉุงุฑ)",
        "ุฎุฏูุงุช ฺฉูุฏุณุงุฒ ู ูููโุณุงุฒ (ฺฉูุฏุณุงุฒุ ูููโุณุงุฒ)",
        "ุฎุฏูุงุช ุดุดูโุจุฑ ู ุขููโฺฉุงุฑ (ุดุดูโุจุฑุ ุขููโฺฉุงุฑ)",
        "ุฎุฏูุงุช ูุฑุด ุดู ู ูุจู ุดู (ูุฑุดโุดูุ ูุจูโุดู)",
        "ุฎุฏูุงุช ูุธุงูุช ููุฒู ู ุงุฏุงุฑู (ูุธุงูุชุ ุฎุฏูุงุช ูุธุงูุช)",
        "ุฎุฏูุงุช ุจุงุบุจุงู ู ูุถุง ุณุจุฒ (ุจุงุบุจุงูุ ูุถุง ุณุจุฒ)",
        "ุฎุฏูุงุช ุญุดุฑูโฺฉุด ู ุถุฏุนููู (ุถุฏุนูููุ ุณููพุงุด)",
        "ุฎุฏูุงุช ุงููุช ู ูฺฏูุจุงู (ุงููุชุ ูฺฏูุจุงู)",
        "ุฎุฏูุงุช ุชุนูุฑุงุช ููุงุฒู ุงูฺฉุชุฑููฺฉ",
        "ุฎุฏูุงุช ูุตุจ ู ุฑุงูโุงูุฏุงุฒ ุชุฌูุฒุงุช",
        "ุฎุฏูุงุช ุณูโฺฉุด ุดุจฺฉู ู ุงูุชุฑูุช",
        "ุฎุฏูุงุช ุชุนูุฑุงุช ุตูุนุช ู ูุงุดูโุขูุงุช",
        "ุฎุฏูุงุช ูุตุจ ุฏูุฑุจู ู ุณุณุชูโูุง ุญูุงุธุช",
        "ุฎุฏูุงุช ุชุนูุฑุงุช ููุงุฒู ุขุดูพุฒุฎุงูู",
        "ุฎุฏูุงุช ูุตุจ ฺฉููพูุด ู ุณูู ฺฉุงุฐุจ",
        "ุฎุฏูุงุช ุชุนูุฑุงุช ุงุจุฒุงุฑุขูุงุช ุฏูู",
        "ุฎุฏูุงุช ูุตุจ ุขุณุงูุณูุฑ ู ูพูู ุจุฑู",
        "ุฎุฏูุงุช ุชุนูุฑุงุช ุณุณุชูโูุง ุณุฑูุงุด ู ฺฏุฑูุงุด",
        "ุฎุฏูุงุช ูุตุจ ุณุณุชูโูุง ุงุนูุงู ุญุฑู",
        "ุฎุฏูุงุช ุชุนูุฑุงุช ุงุฏูุงุช ููุณู",
        "ุฎุฏูุงุช ูุตุจ ุฏุด ู ุณุณุชูโูุง ูุงููุงุฑูโุง",
        "ุฎุฏูุงุช ุชุนูุฑุงุช ููุงุฒู ูพุฒุดฺฉ",
        "ุฎุฏูุงุช ูุตุจ ุณุณุชูโูุง ููุดููุฏ ุณุงุฎุชูุงู",
        "ุฎุฏูุงุช ุจุงุฒุงูุช ู ูุญุท ุฒุณุช",
        "ุฎุฏูุงุช ุงุฌุงุฑู ุชุฌูุฒุงุช ู ููุงุฒู (ูุงููุฏ ุงุฌุงุฑู ฺุงุฏุฑุ ูุจุงุณ ูุฑุงุณูุ ุชุฌูุฒุงุช ูู)"
    ]
}

# ูุชุบุฑูุง ฺฉูฺฉ
def generate_numeric_id():
    while True:
        num_id = random.randint(100000000, 999999999)  # 9 ุฑูู
        conn = sqlite3.connect(DB_NAME)
        c = conn.cursor()
        c.execute("SELECT numeric_id FROM users WHERE numeric_id = ?", (num_id,))
        if not c.fetchone():
            conn.close()
            return num_id
        conn.close()

def save_user(user_id, name, age, gender):
    numeric_id = generate_numeric_id()
    conn = sqlite3.connect(DB_NAME)
    c = conn.cursor()
    c.execute("INSERT OR REPLACE INTO users (user_id, name, age, gender, score, numeric_id) VALUES (?, ?, ?, ?, ?, ?)",
              (user_id, name, age, gender, 0, numeric_id))
    conn.commit()
    conn.close()

def get_user(user_id):
    conn = sqlite3.connect(DB_NAME)
    c = conn.cursor()
    c.execute("SELECT * FROM users WHERE user_id = ?", (user_id,))
    user = c.fetchone()
    conn.close()
    return user

def get_user_by_numeric_id(numeric_id):
    conn = sqlite3.connect(DB_NAME)
    c = conn.cursor()
    c.execute("SELECT * FROM users WHERE numeric_id = ?", (numeric_id,))
    user = c.fetchone()
    conn.close()
    return user

def is_user_blocked(user_id):
    return user_id in blocked_users

def block_user(user_id):
    blocked_users.add(user_id)

def unblock_user(user_id):
    blocked_users.discard(user_id)

def is_contact_blocked(blocker_id, blocked_id, place_id):
    conn = sqlite3.connect(DB_NAME)
    c = conn.cursor()
    c.execute("SELECT * FROM blocked_contacts WHERE blocker_id = ? AND blocked_id = ? AND place_id = ?", 
              (blocker_id, blocked_id, place_id))
    result = c.fetchone()
    conn.close()
    return result is not None

def block_contact(blocker_id, blocked_id, place_id):
    conn = sqlite3.connect(DB_NAME)
    c = conn.cursor()
    c.execute("INSERT INTO blocked_contacts (blocker_id, blocked_id, place_id) VALUES (?, ?, ?)",
              (blocker_id, blocked_id, place_id))
    conn.commit()
    conn.close()

def unblock_contact(blocker_id, blocked_id, place_id):
    conn = sqlite3.connect(DB_NAME)
    c = conn.cursor()
    c.execute("DELETE FROM blocked_contacts WHERE blocker_id = ? AND blocked_id = ? AND place_id = ?",
              (blocker_id, blocked_id, place_id))
    conn.commit()
    conn.close()

# ููููุง
def main_menu(user_id):
    keyboard = types.ReplyKeyboardMarkup(resize_keyboard=True)
    keyboard.row(f"{EMOJIS['profile']} ูพุฑููุงู")
    keyboard.row(f"{EMOJIS['places']} ูฺฉุงูโูุง", f"{EMOJIS['rating']} ูฺฉุงูโูุง ุจุฑุชุฑ")
    keyboard.row(f"{EMOJIS['star']} ฺฉุงุฑุจุฑุงู ุจุฑุชุฑ")
    keyboard.row(f"{EMOJIS['link']} ููฺฉโูุง", f"{EMOJIS['help']} ุฑุงูููุง")
    keyboard.row(f"{EMOJIS['report']} ฺฏุฒุงุฑุด", f"{EMOJIS['buy']} ุฎุฑุฏ ูฺฉุงู ุจุฑุชุฑ")
    
    # ููุท ุงุฏูู ูโุชูุงูุฏ ุฏฺฉูู ุงุฏูู ุฑุง ุจุจูุฏ
    if user_id == ADMIN_ID:
        keyboard.row(f"{EMOJIS['admin']} ุจุฎุด ุงุฏูู")
    
    return keyboard

def profile_menu():
    keyboard = types.ReplyKeyboardMarkup(resize_keyboard=True)
    keyboard.row(f"{EMOJIS['edit']} ูุฑุงุด ูพุฑููุงู", f"{EMOJIS['view']} ูุดุงูุฏู ูพุฑููุงู")
    keyboard.row(f"{EMOJIS['back']} ุจุฑฺฏุดุช")
    return keyboard

def places_menu():
    keyboard = types.ReplyKeyboardMarkup(resize_keyboard=True)
    keyboard.row(f"{EMOJIS['add']} ุงูุฒูุฏู ูฺฉุงู", f"{EMOJIS['view']} ูุดุงูุฏู ูฺฉุงูโูุง")
    keyboard.row(f"{EMOJIS['location']} ุฌุณุชุฌู ูฺฉุงูโูุง")
    keyboard.row(f"{EMOJIS['back']} ุจุฑฺฏุดุช")
    return keyboard

def admin_menu():
    keyboard = types.ReplyKeyboardMarkup(resize_keyboard=True)
    keyboard.row(f"{EMOJIS['add']} ุงุถุงูู ฺฉุฑุฏู ุฑุง", f"{EMOJIS['remove_score']} ฺฉู ฺฉุฑุฏู ุฑุง")
    keyboard.row(f"{EMOJIS['document']} ูุฏุฑุช ูุธุฑุงุช")
    keyboard.row(f"{EMOJIS['news']} ูุฏุฑุช ุงุฎุจุงุฑ", f"{EMOJIS['view']} ูุดุงูุฏู ฺฏุฒุงุฑุดโูุง")
    keyboard.row(f"{EMOJIS['view']} ูุดุงูุฏู ุฏุฑุฎูุงุณุชโูุง ูฺฉุงู ุจุฑุชุฑ")
    keyboard.row(f"{EMOJIS['back']} ุจุฑฺฏุดุช")
    return keyboard

def back_menu():
    keyboard = types.ReplyKeyboardMarkup(resize_keyboard=True)
    keyboard.row(f"{EMOJIS['back']} ุจุฑฺฏุดุช")
    return keyboard

def back_home_menu():
    keyboard = types.ReplyKeyboardMarkup(resize_keyboard=True)
    keyboard.row(f"{EMOJIS['home']} ุตูุญู ุงุตู")
    return keyboard

def confirm_menu():
    keyboard = types.ReplyKeyboardMarkup(resize_keyboard=True)
    keyboard.row(f"{EMOJIS['confirm']} ุชุฃุฏ", f"{EMOJIS['cancel']} ุงูุตุฑุงู")
    return keyboard

def comment_menu(has_comment=False):
    keyboard = types.ReplyKeyboardMarkup(resize_keyboard=True)
    if has_comment:
        keyboard.row(f"{EMOJIS['delete']} ุญุฐู ูุธุฑ")
    keyboard.row(f"{EMOJIS['back']} ุจุฑฺฏุดุช")
    return keyboard

def message_menu():
    keyboard = types.ReplyKeyboardMarkup(resize_keyboard=True)
    keyboard.row(f"{EMOJIS['reply']} ุฌูุงุจ ุฏุงุฏู", f"{EMOJIS['block']} ุจูุงฺฉ ฺฉุฑุฏู")
    keyboard.row(f"{EMOJIS['unblock']} ุฑูุน ุจูุงฺฉ", f"{EMOJIS['back']} ุจุฑฺฏุดุช")
    return keyboard

def help_menu(page=1):
    keyboard = types.ReplyKeyboardMarkup(resize_keyboard=True)
    if page == 1:
        keyboard.row(f"{EMOJIS['next']} ุตูุญู ุจุนุฏ")
    elif page == 2:
        keyboard.row(f"{EMOJIS['previous']} ุตูุญู ูุจู", f"{EMOJIS['next']} ุตูุญู ุจุนุฏ")
    elif page == 3:
        keyboard.row(f"{EMOJIS['previous']} ุตูุญู ูุจู")
    keyboard.row(f"{EMOJIS['home']} ุตูุญู ุงุตู")
    return keyboard

# ุฑุงูููุง ุชุนุงูู
HELP_PAGES = [
    f"""
{EMOJIS['help']} ุฑุงูููุง ุจุฎุดโูุง ุงุตู {EMOJIS['help']}

{EMOJIS['profile']} ุจุฎุด ูพุฑููุงู:
- ูุดุงูุฏู ู ูุฑุงุด ุงุทูุงุนุงุช ุดุฎุต
- ุดูุงุณู ุนุฏุฏ ฺฉุชุง ุจุฑุง ูุฑ ฺฉุงุฑุจุฑ
- ุงูุชุงุฒ ฺฉุงุฑุจุฑ ุจุฑ ุงุณุงุณ ูุนุงูุชโูุง

{EMOJIS['places']} ุจุฎุด ูฺฉุงูโูุง:
- ุงูุฒูุฏู ูฺฉุงู ุฌุฏุฏ ุจุง ุฌุฒุฆุงุช ฺฉุงูู
- ูุดุงูุฏู ู ุฌุณุชุฌู ูฺฉุงูโูุง
- ูุฏุฑุช ูฺฉุงูโูุง ุงุถุงูู ุดุฏู

{EMOJIS['rating']} ุจุฎุด ูฺฉุงูโูุง ุจุฑุชุฑ:
- ูุดุงูุฏู ูฺฉุงูโูุง ุฏุงุฑุง ุงูุชุงุฒ ุจุฑุชุฑ
- ุฏุฑุฎูุงุณุช ูุฑุงุฑฺฏุฑ ูฺฉุงู ุฏุฑ ุจุฎุด ุจุฑุชุฑูุง
    """,
    
    f"""
{EMOJIS['help']} ุฑุงูููุง ุจุฎุดโูุง ูฺู {EMOJIS['help']}

{EMOJIS['star']} ุจุฎุด ฺฉุงุฑุจุฑุงู ุจุฑุชุฑ:
- ูุดุงูุฏู ฺฉุงุฑุจุฑุงู ูุนุงู ู ูพุฑุงูุชุงุฒ
- ุฑูุงุจุช ุจุฑุง ฺฉุณุจ ุงูุชุงุฒ ุจุดุชุฑ

{EMOJIS['link']} ุจุฎุด ููฺฉโูุง:
- ุฏุณุชุฑุณ ุณุฑุน ุจู ููฺฉโูุง ููู
- ุงุดุชุฑุงฺฉโฺฏุฐุงุฑ ููฺฉ ุฑุจุงุช

{EMOJIS['report']} ุจุฎุด ฺฏุฒุงุฑุด:
- ุงุฑุณุงู ฺฏุฒุงุฑุด ู ูุดฺฉูุงุช ุจู ุงุฏูู
- ูพฺฏุฑ ฺฏุฒุงุฑุดโูุง ุงุฑุณุงู

{EMOJIS['buy']} ุจุฎุด ุฎุฑุฏ ูฺฉุงู ุจุฑุชุฑ:
- ุฏุฑุฎูุงุณุช ูุฑุงุฑฺฏุฑ ูฺฉุงู ุฏุฑ ุจุฎุด ุจุฑุชุฑูุง
- ูพุฑุฏุงุฎุช ูุฒูู ู ุจุฑุฑุณ ุชูุณุท ุงุฏูู
    """,
    
    f"""
{EMOJIS['help']} ุฑุงูููุง ุชุนุงูู ุจุง ูฺฉุงูโูุง {EMOJIS['help']}

{EMOJIS['comment']} ุจุฎุด ูุธุฑุงุช:
- ุซุจุช ูุธุฑ ุจุฑุง ูฺฉุงูโูุง ูุฎุชูู
- ูุดุงูุฏู ูุธุฑุงุช ุฏฺฏุฑ ฺฉุงุฑุจุฑุงู
- ูุฏุฑุช ูุธุฑุงุช ุงุฑุณุงู

{EMOJIS['message']} ุจุฎุด ูพุงู ุจู ุตุงุญุจ ูฺฉุงู:
- ุงุฑุณุงู ูพุงู ูุณุชูู ุจู ุตุงุญุจ ูฺฉุงู
- ุงูฺฉุงู ูพุงุณุฎฺฏู ู ุงุฑุชุจุงุท
- ูุฏุฑุช ุจูุงฺฉ ู ุขูุจูุงฺฉ ฺฉุงุฑุจุฑุงู

{EMOJIS['admin']} ุจุฎุด ุงุฏูู (ููุท ุจุฑุง ูุฏุฑุงู):
- ูุฏุฑุช ฺฉุงุฑุจุฑุงู ู ูฺฉุงูโูุง
- ุจุฑุฑุณ ฺฏุฒุงุฑุดโูุง ู ุฏุฑุฎูุงุณุชโูุง
- ุงุนุทุง ู ฺฉุงูุด ุงูุชุงุฒ
    """
]

# ููุฏูุฑูุง
@app.route('/' + API_TOKEN, methods=['POST'])
def get_message():
    json_update = request.stream.read().decode('utf-8')
    update = types.Update.de_json(json_update)
    bot.process_new_updates([update])
    return 'ok', 200

@app.route('/')
def webhook():
    bot.remove_webhook()
    bot.set_webhook(url=WEBHOOK_URL + '/' + API_TOKEN)
    return 'Hello from GoyimNama!', 200

@bot.message_handler(commands=['start'])
def send_welcome(message):
    user_id = message.from_user.id
    user_name = message.from_user.first_name
    
    # ุฐุฎุฑู ฺฉุงุฑุจุฑ ุฏุฑ ุฏุชุงุจุณ
    save_user(user_id, user_name, None, None)
    
    # ููุงุด ูพุงู ุฎูุดโุขูุฏฺฏู
    bot.send_message(user_id, WELCOME_MESSAGE, reply_markup=types.ReplyKeyboardRemove())
    
    # ุงุฌุงุฏ ุฏฺฉููโูุง ุชุฃุฏ ููุงูู
    keyboard = types.ReplyKeyboardMarkup(resize_keyboard=True)
    keyboard.row(f"{EMOJIS['confirm']} ููุงูู ุฑุง ูโูพุฐุฑู", f"{EMOJIS['cancel']} ููโูพุฐุฑู")
    
    bot.send_message(user_id, "ูุทูุงู ฺฏุฒูู ููุฑุฏ ูุธุฑ ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ:", reply_markup=keyboard)
    
    # ุชูุธู ุญุงูุช ฺฉุงุฑุจุฑ
    user_states[user_id] = "waiting_for_rules_acceptance"

@bot.message_handler(func=lambda message: user_states.get(message.from_user.id) == "waiting_for_rules_acceptance")
def handle_rules_acceptance(message):
    user_id = message.from_user.id
    
    if message.text == f"{EMOJIS['confirm']} ููุงูู ุฑุง ูโูพุฐุฑู":
        bot.send_message(user_id, f"{EMOJIS['success']} ููุงูู ุจุง ููููุช ุชุฃุฏ ุดุฏ! ุงฺฉููู ูโุชูุงูุฏ ุงุฒ ุงูฺฉุงูุงุช ุฑุจุงุช ุงุณุชูุงุฏู ฺฉูุฏ.")
        user_states[user_id] = None
        show_main_menu(user_id)
    elif message.text == f"{EMOJIS['cancel']} ููโูพุฐุฑู":
        bot.send_message(user_id, f"{EMOJIS['error']} ูุชุฃุณูู ฺฉู ููุงูู ุฑุง ููโูพุฐุฑุฏ. ุจุฏูู ูพุฐุฑุด ููุงูู ููโุชูุงูุฏ ุงุฒ ุฑุจุงุช ุงุณุชูุงุฏู ฺฉูุฏ.")
    else:
        bot.send_message(user_id, "ูุทูุงู ฺฉ ุงุฒ ฺฏุฒููโูุง ุจุงูุง ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ.")

def show_main_menu(user_id):
    bot.send_message(user_id, "ููู ุงุตู:", reply_markup=main_menu(user_id))

@bot.message_handler(func=lambda message: message.text == f"{EMOJIS['profile']} ูพุฑููุงู")
def handle_profile(message):
    user_id = message.from_user.id
    bot.send_message(user_id, "ุจุฎุด ูพุฑููุงู:", reply_markup=profile_menu())

@bot.message_handler(func=lambda message: message.text == f"{EMOJIS['places']} ูฺฉุงูโูุง")
def handle_places(message):
    user_id = message.from_user.id
    bot.send_message(user_id, "ุจุฎุด ูฺฉุงูโูุง:", reply_markup=places_menu())

@bot.message_handler(func=lambda message: message.text == f"{EMOJIS['back']} ุจุฑฺฏุดุช")
def handle_back(message):
    user_id = message.from_user.id
    show_main_menu(user_id)

@bot.message_handler(func=lambda message: message.text == f"{EMOJIS['home']} ุตูุญู ุงุตู")
def handle_home(message):
    user_id = message.from_user.id
    show_main_menu(user_id)

@bot.message_handler(func=lambda message: message.text == f"{EMOJIS['edit']} ูุฑุงุด ูพุฑููุงู")
def handle_edit_profile(message):
    user_id = message.from_user.id
    bot.send_message(user_id, "ูุทูุงู ูุงู ุฎูุฏ ุฑุง ูุงุฑุฏ ฺฉูุฏ:", reply_markup=back_menu())
    user_states[user_id] = "waiting_for_name"

@bot.message_handler(func=lambda message: user_states.get(message.from_user.id) == "waiting_for_name")
def handle_name_input(message):
    user_id = message.from_user.id
    
    if message.text == f"{EMOJIS['back']} ุจุฑฺฏุดุช":
        bot.send_message(user_id, "ูุฑุงุด ูพุฑููุงู ูุบู ุดุฏ.", reply_markup=profile_menu())
        user_states[user_id] = None
        return
    
    user_data[user_id] = {"name": message.text}
    bot.send_message(user_id, "ูุทูุงู ุณู ุฎูุฏ ุฑุง ูุงุฑุฏ ฺฉูุฏ (ุนุฏุฏ ุงูฺฏูุณ):", reply_markup=back_menu())
    user_states[user_id] = "waiting_for_age"

@bot.message_handler(func=lambda message: user_states.get(message.from_user.id) == "waiting_for_age")
def handle_age_input(message):
    user_id = message.from_user.id
    
    if message.text == f"{EMOJIS['back']} ุจุฑฺฏุดุช":
        bot.send_message(user_id, "ูุฑุงุด ูพุฑููุงู ูุบู ุดุฏ.", reply_markup=profile_menu())
        user_states[user_id] = None
        return
    
    try:
        age = int(message.text)
        if age < 1 or age > 120:
            bot.send_message(user_id, "ูุทูุงู ุณู ูุนุชุจุฑ ูุงุฑุฏ ฺฉูุฏ (ุจู 1 ุชุง 120):", reply_markup=back_menu())
            return
        
        user_data[user_id]["age"] = age
        keyboard = types.ReplyKeyboardMarkup(resize_keyboard=True)
        keyboard.row("ูุฑุฏ", "ุฒู")
        keyboard.row(f"{EMOJIS['back']} ุจุฑฺฏุดุช")
        
        bot.send_message(user_id, "ูุทูุงู ุฌูุณุช ุฎูุฏ ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ:", reply_markup=keyboard)
        user_states[user_id] = "waiting_for_gender"
    except ValueError:
        bot.send_message(user_id, "ูุทูุงู ฺฉ ุนุฏุฏ ูุนุชุจุฑ ูุงุฑุฏ ฺฉูุฏ:", reply_markup=back_menu())

@bot.message_handler(func=lambda message: user_states.get(message.from_user.id) == "waiting_for_gender")
def handle_gender_input(message):
    user_id = message.from_user.id
    
    if message.text == f"{EMOJIS['back']} ุจุฑฺฏุดุช":
        bot.send_message(user_id, "ูุฑุงุด ูพุฑููุงู ูุบู ุดุฏ.", reply_markup=profile_menu())
        user_states[user_id] = None
        return
    
    if message.text not in ["ูุฑุฏ", "ุฒู"]:
        bot.send_message(user_id, "ูุทูุงู ุฌูุณุช ูุนุชุจุฑ ุงูุชุฎุงุจ ฺฉูุฏ:", reply_markup=back_menu())
        return
    
    user_data[user_id]["gender"] = message.text
    
    # ุฐุฎุฑู ุงุทูุงุนุงุช ฺฉุงุฑุจุฑ
    save_user(user_id, user_data[user_id]["name"], user_data[user_id]["age"], user_data[user_id]["gender"])
    
    bot.send_message(user_id, f"{EMOJIS['success']} ูพุฑููุงู ุดูุง ุจุง ููููุช ุจูโุฑูุฒุฑุณุงู ุดุฏ!", reply_markup=profile_menu())
    user_states[user_id] = None

@bot.message_handler(func=lambda message: message.text == f"{EMOJIS['view']} ูุดุงูุฏู ูพุฑููุงู")
def handle_view_profile(message):
    user_id = message.from_user.id
    user = get_user(user_id)
    
    if user:
        profile_text = f"""
{EMOJIS['profile']} ุงุทูุงุนุงุช ูพุฑููุงู:

{EMOJIS['user']} ูุงู: {user[1]}
{EMOJIS['time']} ุณู: {user[2] if user[2] else 'ุชุนู ูุดุฏู'}
{EMOJIS['info']} ุฌูุณุช: {user[3] if user[3] else 'ุชุนู ูุดุฏู'}
{EMOJIS['score']} ุงูุชุงุฒ: {user[4]}
{EMOJIS['document']} ุดูุงุณู ุนุฏุฏ: {user[5]}
        """
        bot.send_message(user_id, profile_text, reply_markup=profile_menu())
    else:
        bot.send_message(user_id, f"{EMOJIS['error']} ุงุทูุงุนุงุช ูพุฑููุงู ุงูุช ูุดุฏ. ูุทูุงู ุงุจุชุฏุง ูพุฑููุงู ุฎูุฏ ุฑุง ุชฺฉูู ฺฉูุฏ.", reply_markup=profile_menu())

@bot.message_handler(func=lambda message: message.text == f"{EMOJIS['add']} ุงูุฒูุฏู ูฺฉุงู")
def handle_add_place(message):
    user_id = message.from_user.id
    
    # ุงุฌุงุฏ ฺฉุจูุฑุฏ ุจุฑุง ุงูุชุฎุงุจ ุฏุณุชูโุจูุฏ
    keyboard = types.ReplyKeyboardMarkup(resize_keyboard=True)
    categories = list(PLACE_CATEGORIES.keys())
    
    # ุชูุณู ุฏุณุชูโุจูุฏโูุง ุจู ุฑุฏูโูุง 2 ุชุง
    for i in range(0, len(categories), 2):
        if i + 1 < len(categories):
            keyboard.row(categories[i], categories[i + 1])
        else:
            keyboard.row(categories[i])
    
    keyboard.row(f"{EMOJIS['back']} ุจุฑฺฏุดุช")
    
    bot.send_message(user_id, "ูุทูุงู ุฏุณุชูโุจูุฏ ูฺฉุงู ุฎูุฏ ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ:", reply_markup=keyboard)
    user_states[user_id] = "waiting_for_category"

@bot.message_handler(func=lambda message: user_states.get(message.from_user.id) == "waiting_for_category")
def handle_category_input(message):
    user_id = message.from_user.id
    
    if message.text == f"{EMOJIS['back']} ุจุฑฺฏุดุช":
        bot.send_message(user_id, "ุงูุฒูุฏู ูฺฉุงู ูุบู ุดุฏ.", reply_markup=places_menu())
        user_states[user_id] = None
        return
    
    if message.text not in PLACE_CATEGORIES:
        bot.send_message(user_id, "ูุทูุงู ฺฉ ุฏุณุชูโุจูุฏ ูุนุชุจุฑ ุงูุชุฎุงุจ ฺฉูุฏ:", reply_markup=back_menu())
        return
    
    user_data[user_id] = {"category": message.text}
    
    # ุงุฌุงุฏ ฺฉุจูุฑุฏ ุจุฑุง ุงูุชุฎุงุจ ุฒุฑุฏุณุชู
    keyboard = types.ReplyKeyboardMarkup(resize_keyboard=True)
    subcategories = PLACE_CATEGORIES[message.text]
    
    for subcat in subcategories:
        keyboard.row(subcat)
    
    keyboard.row(f"{EMOJIS['back']} ุจุฑฺฏุดุช")
    
    bot.send_message(user_id, "ูุทูุงู ุฒุฑุฏุณุชู ูฺฉุงู ุฎูุฏ ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ:", reply_markup=keyboard)
    user_states[user_id] = "waiting_for_subcategory"

@bot.message_handler(func=lambda message: user_states.get(message.from_user.id) == "waiting_for_subcategory")
def handle_subcategory_input(message):
    user_id = message.from_user.id
    
    if message.text == f"{EMOJIS['back']} ุจุฑฺฏุดุช":
        bot.send_message(user_id, "ุงูุฒูุฏู ูฺฉุงู ูุบู ุดุฏ.", reply_markup=places_menu())
        user_states[user_id] = None
        return
    
    user_data[user_id]["subcategory"] = message.text
    bot.send_message(user_id, "ูุทูุงู ุนููุงู ูฺฉุงู ุฑุง ูุงุฑุฏ ฺฉูุฏ:", reply_markup=back_menu())
    user_states[user_id] = "waiting_for_title"

@bot.message_handler(func=lambda message: user_states.get(message.from_user.id) == "waiting_for_title")
def handle_title_input(message):
    user_id = message.from_user.id
    
    if message.text == f"{EMOJIS['back']} ุจุฑฺฏุดุช":
        bot.send_message(user_id, "ุงูุฒูุฏู ูฺฉุงู ูุบู ุดุฏ.", reply_markup=places_menu())
        user_states[user_id] = None
        return
    
    user_data[user_id]["title"] = message.text
    bot.send_message(user_id, "ูุทูุงู ุชูุถุญุงุช ูฺฉุงู ุฑุง ูุงุฑุฏ ฺฉูุฏ:", reply_markup=back_menu())
    user_states[user_id] = "waiting_for_description"

@bot.message_handler(func=lambda message: user_states.get(message.from_user.id) == "waiting_for_description")
def handle_description_input(message):
    user_id = message.from_user.id
    
    if message.text == f"{EMOJIS['back']} ุจุฑฺฏุดุช":
        bot.send_message(user_id, "ุงูุฒูุฏู ูฺฉุงู ูุบู ุดุฏ.", reply_markup=places_menu())
        user_states[user_id] = None
        return
    
    user_data[user_id]["description"] = message.text
    bot.send_message(user_id, "ูุทูุงู ุขุฏุฑุณ ูฺฉุงู ุฑุง ูุงุฑุฏ ฺฉูุฏ:", reply_markup=back_menu())
    user_states[user_id] = "waiting_for_address"

@bot.message_handler(func=lambda message: user_states.get(message.from_user.id) == "waiting_for_address")
def handle_address_input(message):
    user_id = message.from_user.id
    
    if message.text == f"{EMOJIS['back']} ุจุฑฺฏุดุช":
        bot.send_message(user_id, "ุงูุฒูุฏู ูฺฉุงู ูุบู ุดุฏ.", reply_markup=places_menu())
        user_states[user_id] = None
        return
    
    user_data[user_id]["address"] = message.text
    bot.send_message(user_id, "ูุทูุงู ุดูุงุฑู ุชููู ูฺฉุงู ุฑุง ูุงุฑุฏ ฺฉูุฏ:", reply_markup=back_menu())
    user_states[user_id] = "waiting_for_phone"

@bot.message_handler(func=lambda message: user_states.get(message.from_user.id) == "waiting_for_phone")
def handle_phone_input(message):
    user_id = message.from_user.id
    
    if message.text == f"{EMOJIS['back']} ุจุฑฺฏุดุช":
        bot.send_message(user_id, "ุงูุฒูุฏู ูฺฉุงู ูุบู ุดุฏ.", reply_markup=places_menu())
        user_states[user_id] = None
        return
    
    user_data[user_id]["phone"] = message.text
    bot.send_message(user_id, "ูุทูุงู ุณุงุนุช ฺฉุงุฑ ุตุจุญ ูฺฉุงู ุฑุง ูุงุฑุฏ ฺฉูุฏ (ูุซุงู: 8:00-12:00):", reply_markup=back_menu())
    user_states[user_id] = "waiting_for_morning_shift"

@bot.message_handler(func=lambda message: user_states.get(message.from_user.id) == "waiting_for_morning_shift")
def handle_morning_shift_input(message):
    user_id = message.from_user.id
    
    if message.text == f"{EMOJIS['back']} ุจุฑฺฏุดุช":
        bot.send_message(user_id, "ุงูุฒูุฏู ูฺฉุงู ูุบู ุดุฏ.", reply_markup=places_menu())
        user_states[user_id] = None
        return
    
    user_data[user_id]["morning_shift"] = message.text
    bot.send_message(user_id, "ูุทูุงู ุณุงุนุช ฺฉุงุฑ ุนุตุฑ ูฺฉุงู ุฑุง ูุงุฑุฏ ฺฉูุฏ (ูุซุงู: 16:00-20:00):", reply_markup=back_menu())
    user_states[user_id] = "waiting_for_afternoon_shift"

@bot.message_handler(func=lambda message: user_states.get(message.from_user.id) == "waiting_for_afternoon_shift")
def handle_afternoon_shift_input(message):
    user_id = message.from_user.id
    
    if message.text == f"{EMOJIS['back']} ุจุฑฺฏุดุช":
        bot.send_message(user_id, "ุงูุฒูุฏู ูฺฉุงู ูุบู ุดุฏ.", reply_markup=places_menu())
        user_states[user_id] = None
        return
    
    user_data[user_id]["afternoon_shift"] = message.text
    bot.send_message(user_id, "ูุทูุงู ุนฺฉุณ ูฺฉุงู ุฑุง ุงุฑุณุงู ฺฉูุฏ (ุญุฏุงฺฉุซุฑ 8 ุนฺฉุณ):", reply_markup=back_menu())
    user_states[user_id] = "waiting_for_photo"

@bot.message_handler(func=lambda message: user_states.get(message.from_user.id) == "waiting_for_photo", content_types=['photo'])
def handle_photo_input(message):
    user_id = message.from_user.id
    
    if 'photo' not in user_data[user_id]:
        user_data[user_id]['photo'] = []
    
    # ุฐุฎุฑู file_id ุนฺฉุณ
    user_data[user_id]['photo'].append(message.photo[-1].file_id)
    
    if len(user_data[user_id]['photo']) >= 8:
        # ฺฉุงุฑุจุฑ ุญุฏุงฺฉุซุฑ ุนฺฉุณ ุฑุง ุงุฑุณุงู ฺฉุฑุฏู
        keyboard = types.ReplyKeyboardMarkup(resize_keyboard=True)
        keyboard.row(f"{EMOJIS['confirm']} ุชุฃุฏ ู ุซุจุช ูฺฉุงู")
        keyboard.row(f"{EMOJIS['cancel']} ุงูุตุฑุงู")
        
        bot.send_message(user_id, f"{EMOJIS['success']} ุญุฏุงฺฉุซุฑ ุนฺฉุณ ุฏุฑุงูุช ุดุฏ. ุจุฑุง ุซุจุช ูฺฉุงู ุชุฃุฏ ฺฉูุฏ.", reply_markup=keyboard)
        user_states[user_id] = "waiting_for_place_confirmation"
    else:
        bot.send_message(user_id, f"{EMOJIS['success']} ุนฺฉุณ ุฏุฑุงูุช ุดุฏ. ูโุชูุงูุฏ ุชุง 8 ุนฺฉุณ ุงุฑุณุงู ฺฉูุฏ ุง ุจุฑุง ุซุจุช ูฺฉุงู ุชุฃุฏ ฺฉูุฏ.", reply_markup=confirm_menu())

@bot.message_handler(func=lambda message: user_states.get(message.from_user.id) == "waiting_for_photo")
def handle_photo_text_input(message):
    user_id = message.from_user.id
    
    if message.text == f"{EMOJIS['confirm']} ุชุฃุฏ":
        if 'photo' not in user_data[user_id] or not user_data[user_id]['photo']:
            bot.send_message(user_id, "ูุทูุงู ุญุฏุงูู ฺฉ ุนฺฉุณ ุงุฑุณุงู ฺฉูุฏ.", reply_markup=back_menu())
            return
        
        keyboard = types.ReplyKeyboardMarkup(resize_keyboard=True)
        keyboard.row(f"{EMOJIS['confirm']} ุชุฃุฏ ู ุซุจุช ูฺฉุงู")
        keyboard.row(f"{EMOJIS['cancel']} ุงูุตุฑุงู")
        
        bot.send_message(user_id, "ุจุฑุง ุซุจุช ูฺฉุงู ุชุฃุฏ ฺฉูุฏ:", reply_markup=keyboard)
        user_states[user_id] = "waiting_for_place_confirmation"
    elif message.text == f"{EMOJIS['cancel']} ุงูุตุฑุงู":
        bot.send_message(user_id, "ุงูุฒูุฏู ูฺฉุงู ูุบู ุดุฏ.", reply_markup=places_menu())
        user_states[user_id] = None
    else:
        bot.send_message(user_id, "ูุทูุงู ุนฺฉุณ ูฺฉุงู ุฑุง ุงุฑุณุงู ฺฉูุฏ ุง ุจุฑุง ุซุจุช ูฺฉุงู ุชุฃุฏ ฺฉูุฏ:", reply_markup=confirm_menu())

@bot.message_handler(func=lambda message: user_states.get(message.from_user.id) == "waiting_for_place_confirmation")
def handle_place_confirmation(message):
    user_id = message.from_user.id
    
    if message.text == f"{EMOJIS['confirm']} ุชุฃุฏ ู ุซุจุช ูฺฉุงู":
        # ุฐุฎุฑู ูฺฉุงู ุฏุฑ ุฏุชุงุจุณ
        conn = sqlite3.connect(DB_NAME)
        c = conn.cursor()
        
        # ุชุจุฏู ูุณุช ุนฺฉุณโูุง ุจู ุฑุดุชู ุฌุฏุง ุดุฏู ุจุง ฺฉุงูุง
        photos_str = ",".join(user_data[user_id]['photo'])
        
        c.execute('''INSERT INTO places 
                    (user_id, category, subcategory, title, description, address, phone, photo, morning_shift, afternoon_shift) 
                    VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)''',
                 (user_id, user_data[user_id]['category'], user_data[user_id]['subcategory'],
                  user_data[user_id]['title'], user_data[user_id]['description'],
                  user_data[user_id]['address'], user_data[user_id]['phone'],
                  photos_str, user_data[user_id]['morning_shift'],
                  user_data[user_id]['afternoon_shift']))
        
        conn.commit()
        place_id = c.lastrowid
        conn.close()
        
        # ุงุฑุณุงู ุชุฃุฏู
        bot.send_message(user_id, f"{EMOJIS['success']} ูฺฉุงู ุดูุง ุจุง ููููุช ุซุจุช ุดุฏ!", reply_markup=places_menu())
        
        # ุงุฑุณุงู ุงุทูุงุนุงุช ูฺฉุงู
        place_info = f"""
{EMOJIS['places']} ูฺฉุงู ุซุจุช ุดุฏู:

{EMOJIS['info']} ุฏุณุชูโุจูุฏ: {user_data[user_id]['category']}
{EMOJIS['info']} ุฒุฑุฏุณุชู: {user_data[user_id]['subcategory']}
{EMOJIS['document']} ุนููุงู: {user_data[user_id]['title']}
{EMOJIS['info']} ุชูุถุญุงุช: {user_data[user_id]['description']}
{EMOJIS['location']} ุขุฏุฑุณ: {user_data[user_id]['address']}
{EMOJIS['phone']} ุชููู: {user_data[user_id]['phone']}
{EMOJIS['time']} ุณุงุนุช ฺฉุงุฑ ุตุจุญ: {user_data[user_id]['morning_shift']}
{EMOJIS['time']} ุณุงุนุช ฺฉุงุฑ ุนุตุฑ: {user_data[user_id]['afternoon_shift']}
        """
        
        # ุงุฑุณุงู ุนฺฉุณโูุง ุจู ุตูุฑุช ฺฏุฑูู
        if len(user_data[user_id]['photo']) > 0:
            media = [types.InputMediaPhoto(photo) for photo in user_data[user_id]['photo']]
            bot.send_media_group(user_id, media)
        
        bot.send_message(user_id, place_info, reply_markup=places_menu())
        
        # ูพุงฺฉ ฺฉุฑุฏู ุฏุงุฏูโูุง ูููุช
        if user_id in user_data:
            del user_data[user_id]
        user_states[user_id] = None
        
    elif message.text == f"{EMOJIS['cancel']} ุงูุตุฑุงู":
        bot.send_message(user_id, "ุงูุฒูุฏู ูฺฉุงู ูุบู ุดุฏ.", reply_markup=places_menu())
        
        # ูพุงฺฉ ฺฉุฑุฏู ุฏุงุฏูโูุง ูููุช
        if user_id in user_data:
            del user_data[user_id]
        user_states[user_id] = None
    else:
        bot.send_message(user_id, "ูุทูุงู ฺฉ ุงุฒ ฺฏุฒููโูุง ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ:", reply_markup=confirm_menu())

@bot.message_handler(func=lambda message: message.text == f"{EMOJIS['view']} ูุดุงูุฏู ูฺฉุงูโูุง")
def handle_view_places(message):
    user_id = message.from_user.id
    
    conn = sqlite3.connect(DB_NAME)
    c = conn.cursor()
    c.execute("SELECT * FROM places WHERE user_id = ?", (user_id,))
    places = c.fetchall()
    conn.close()
    
    if not places:
        bot.send_message(user_id, f"{EMOJIS['error']} ุดูุง ูฺ ูฺฉุงู ุซุจุช ูฺฉุฑุฏูโุงุฏ.", reply_markup=places_menu())
        return
    
    for place in places:
        place_info = f"""
{EMOJIS['places']} ูฺฉุงู ุดูุง:

{EMOJIS['info']} ุฏุณุชูโุจูุฏ: {place[2]}
{EMOJIS['info']} ุฒุฑุฏุณุชู: {place[3]}
{EMOJIS['document']} ุนููุงู: {place[4]}
{EMOJIS['info']} ุชูุถุญุงุช: {place[5]}
{EMOJIS['location']} ุขุฏุฑุณ: {place[6]}
{EMOJIS['phone']} ุชููู: {place[7]}
{EMOJIS['time']} ุณุงุนุช ฺฉุงุฑ ุตุจุญ: {place[9]}
{EMOJIS['time']} ุณุงุนุช ฺฉุงุฑ ุนุตุฑ: {place[10]}
{EMOJIS['score']} ุงูุชุงุฒ: {place[11] / place[12] if place[12] > 0 else 0:.1f} ({place[12]} ุฑุฃ)
        """
        
        # ุงุฑุณุงู ุนฺฉุณโูุง ุงฺฏุฑ ูุฌูุฏ ุฏุงุฑูุฏ
        if place[8]:
            photo_ids = place[8].split(',')
            if len(photo_ids) > 0:
                media = [types.InputMediaPhoto(photo_id) for photo_id in photo_ids]
                bot.send_media_group(user_id, media)
        
        bot.send_message(user_id, place_info, reply_markup=places_menu())

@bot.message_handler(func=lambda message: message.text == f"{EMOJIS['location']} ุฌุณุชุฌู ูฺฉุงูโูุง")
def handle_search_places(message):
    user_id = message.from_user.id
    bot.send_message(user_id, "ูุทูุงู ุขุฏุฑุณ ุง ูุงู ูฺฉุงู ููุฑุฏ ูุธุฑ ุฑุง ุจุฑุง ุฌุณุชุฌู ูุงุฑุฏ ฺฉูุฏ:", reply_markup=back_menu())
    user_states[user_id] = "waiting_for_search_query"

@bot.message_handler(func=lambda message: user_states.get(message.from_user.id) == "waiting_for_search_query")
def handle_search_query(message):
    user_id = message.from_user.id
    
    if message.text == f"{EMOJIS['back']} ุจุฑฺฏุดุช":
        bot.send_message(user_id, "ุฌุณุชุฌู ูุบู ุดุฏ.", reply_markup=places_menu())
        user_states[user_id] = None
        return
    
    search_query = message.text.lower()
    
    conn = sqlite3.connect(DB_NAME)
    c = conn.cursor()
    c.execute("SELECT * FROM places")
    all_places = c.fetchall()
    conn.close()
    
    found_places = []
    
    for place in all_places:
        # ุฌุณุชุฌู ุฏุฑ ุนููุงูุ ุชูุถุญุงุช ู ุขุฏุฑุณ
        title = place[4].lower() if place[4] else ""
        description = place[5].lower() if place[5] else ""
        address = place[6].lower() if place[6] else ""
        
        # ุฌุณุชุฌู ูพุดุฑูุชู ุจุง ุชูุณู ฺฉููุงุช
        query_words = search_query.split()
        title_words = title.split()
        address_words = address.split()
        
        # ุจุฑุฑุณ ุชุทุงุจู ฺฉููุงุช
        title_match = any(word in title for word in query_words) or any(title_word in search_query for title_word in title_words)
        address_match = any(word in address for word in query_words) or any(address_word in search_query for address_word in address_words)
        description_match = any(word in description for word in query_words)
        
        if title_match or address_match or description_match:
            found_places.append(place)
    
    if not found_places:
        bot.send_message(user_id, f"{EMOJIS['error']} ูฺ ูฺฉุงู ุจุง ูุดุฎุตุงุช ูุงุฑุฏ ุดุฏู ุงูุช ูุดุฏ.", reply_markup=places_menu())
        user_states[user_id] = None
        return
    
    # ููุงุด ูฺฉุงูโูุง ุงูุช ุดุฏู
    for place in found_places:
        place_info = f"""
{EMOJIS['places']} ูฺฉุงู ุงูุช ุดุฏู:

{EMOJIS['info']} ุฏุณุชูโุจูุฏ: {place[2]}
{EMOJIS['info']} ุฒุฑุฏุณุชู: {place[3]}
{EMOJIS['document']} ุนููุงู: {place[4]}
{EMOJIS['info']} ุชูุถุญุงุช: {place[5]}
{EMOJIS['location']} ุขุฏุฑุณ: {place[6]}
{EMOJIS['phone']} ุชููู: {place[7]}
{EMOJIS['time']} ุณุงุนุช ฺฉุงุฑ ุตุจุญ: {place[9]}
{EMOJIS['time']} ุณุงุนุช ฺฉุงุฑ ุนุตุฑ: {place[10]}
{EMOJIS['score']} ุงูุชุงุฒ: {place[11] / place[12] if place[12] > 0 else 0:.1f} ({place[12]} ุฑุฃ)
        """
        
        # ุงุฑุณุงู ุนฺฉุณโูุง ุงฺฏุฑ ูุฌูุฏ ุฏุงุฑูุฏ
        if place[8]:
            photo_ids = place[8].split(',')
            if len(photo_ids) > 0:
                media = [types.InputMediaPhoto(photo_id) for photo_id in photo_ids]
                bot.send_media_group(user_id, media)
        
        # ุงุฌุงุฏ ุฏฺฉููโูุง ุชุนุงูู ุจุง ูฺฉุงู
        keyboard = types.InlineKeyboardMarkup()
        keyboard.row(
            types.InlineKeyboardButton(f"{EMOJIS['comment']} ูุธุฑ ุฏุงุฏู", callback_data=f"comment_{place[0]}"),
            types.InlineKeyboardButton(f"{EMOJIS['message']} ุงุฑุณุงู ูพุงู", callback_data=f"message_{place[0]}")
        )
        keyboard.row(
            types.InlineKeyboardButton(f"{EMOJIS['view']} ูุดุงูุฏู ูุธุฑุงุช", callback_data=f"view_comments_{place[0]}")
        )
        
        bot.send_message(user_id, place_info, reply_markup=keyboard)
    
    user_states[user_id] = None

@bot.callback_query_handler(func=lambda call: call.data.startswith('comment_'))
def handle_comment_callback(call):
    user_id = call.from_user.id
    place_id = int(call.data.split('_')[1])
    
    bot.send_message(user_id, "ูุทูุงู ูุธุฑ ุฎูุฏ ุฑุง ุจุฑุง ุงู ูฺฉุงู ูุงุฑุฏ ฺฉูุฏ:", reply_markup=back_menu())
    user_states[user_id] = f"waiting_for_comment_{place_id}"

@bot.message_handler(func=lambda message: user_states.get(message.from_user.id, '').startswith('waiting_for_comment_'))
def handle_comment_input(message):
    user_id = message.from_user.id
    state = user_states[user_id]
    place_id = int(state.split('_')[-1])
    
    if message.text == f"{EMOJIS['back']} ุจุฑฺฏุดุช":
        bot.send_message(user_id, "ุซุจุช ูุธุฑ ูุบู ุดุฏ.", reply_markup=places_menu())
        user_states[user_id] = None
        return
    
    comment_text = message.text
    
    # ุฐุฎุฑู ูุธุฑ ุฏุฑ ุฏุชุงุจุณ
    conn = sqlite3.connect(DB_NAME)
    c = conn.cursor()
    c.execute("INSERT INTO comments (place_id, user_id, comment_text) VALUES (?, ?, ?)",
              (place_id, user_id, comment_text))
    conn.commit()
    
    # ุฏุฑุงูุช ุงุทูุงุนุงุช ูฺฉุงู
    c.execute("SELECT title, user_id FROM places WHERE place_id = ?", (place_id,))
    place = c.fetchone()
    conn.close()
    
    if place:
        place_title = place[0]
        place_owner_id = place[1]
        
        # ุงุฑุณุงู ุชุฃุฏู ุจู ฺฉุงุฑุจุฑ
        bot.send_message(user_id, f"{EMOJIS['success']} ูุธุฑ ุดูุง ุจุง ููููุช ุซุจุช ุดุฏ!", reply_markup=places_menu())
        
        # ุงุฑุณุงู ุงุทูุงุนู ุจู ุตุงุญุจ ูฺฉุงู (ุงฺฏุฑ ุจุง ฺฉุงุฑุจุฑ ูุนู ูุชูุงูุช ุงุณุช)
        if place_owner_id != user_id:
            owner_user = get_user(place_owner_id)
            if owner_user:
                owner_name = owner_user[1]
                commenter_user = get_user(user_id)
                commenter_name = commenter_user[1] if commenter_user else "ูุงุดูุงุณ"
                commenter_age = commenter_user[2] if commenter_user and commenter_user[2] else "ูุงูุดุฎุต"
                commenter_gender = commenter_user[3] if commenter_user and commenter_user[3] else "ูุงูุดุฎุต"
                commenter_numeric_id = commenter_user[5] if commenter_user else "ูุงูุดุฎุต"
                
                notification_text = f"""
{EMOJIS['comment']} ุงุทูุงุนู ูุธุฑ ุฌุฏุฏ:

ฺฉุงุฑุจุฑ {commenter_name} ({commenter_age} ุณุงูุ {commenter_gender}) ูุธุฑ ุฌุฏุฏ ุจุฑุง ูฺฉุงู ุดูุง "{place_title}" ุซุจุช ฺฉุฑุฏู ุงุณุช.

ูุชู ูุธุฑ:
{comment_text}

ุดูุงุณู ุนุฏุฏ ฺฉุงุฑุจุฑ: {commenter_numeric_id}
                """
                
                bot.send_message(place_owner_id, notification_text)
    
    user_states[user_id] = None

@bot.callback_query_handler(func=lambda call: call.data.startswith('view_comments_'))
def handle_view_comments_callback(call):
    user_id = call.from_user.id
    place_id = int(call.data.split('_')[2])
    
    conn = sqlite3.connect(DB_NAME)
    c = conn.cursor()
    c.execute("SELECT c.comment_text, u.name, u.age, u.gender, u.numeric_id FROM comments c JOIN users u ON c.user_id = u.user_id WHERE c.place_id = ?", (place_id,))
    comments = c.fetchall()
    conn.close()
    
    if not comments:
        bot.send_message(user_id, f"{EMOJIS['error']} ูฺ ูุธุฑ ุจุฑุง ุงู ูฺฉุงู ุซุจุช ูุดุฏู ุงุณุช.")
        return
    
    comments_text = f"{EMOJIS['comment']} ูุธุฑุงุช ูฺฉุงู:\n\n"
    
    for i, comment in enumerate(comments, 1):
        comment_text, commenter_name, commenter_age, commenter_gender, commenter_numeric_id = comment
        comments_text += f"{i}. {commenter_name} ({commenter_age} ุณุงูุ {commenter_gender}):\n{comment_text}\n"
        comments_text += f"ุดูุงุณู ุนุฏุฏ: {commenter_numeric_id}\n"
        comments_text += "โ" * 20 + "\n"
    
    bot.send_message(user_id, comments_text)

@bot.callback_query_handler(func=lambda call: call.data.startswith('message_'))
def handle_message_callback(call):
    user_id = call.from_user.id
    place_id = int(call.data.split('_')[1])
    
    conn = sqlite3.connect(DB_NAME)
    c = conn.cursor()
    c.execute("SELECT user_id, title FROM places WHERE place_id = ?", (place_id,))
    place = c.fetchone()
    conn.close()
    
    if not place:
        bot.send_message(user_id, f"{EMOJIS['error']} ูฺฉุงู ููุฑุฏ ูุธุฑ ุงูุช ูุดุฏ.")
        return
    
    place_owner_id = place[0]
    place_title = place[1]
    
    # ุจุฑุฑุณ ุขุง ฺฉุงุฑุจุฑ ุจูุงฺฉ ุดุฏู ุงุณุช
    if is_contact_blocked(place_owner_id, user_id, place_id):
        bot.send_message(user_id, f"{EMOJIS['error']} ุดูุง ุชูุณุท ุตุงุญุจ ุงู ูฺฉุงู ุจูุงฺฉ ุดุฏูโุงุฏ ู ููโุชูุงูุฏ ูพุงู ุงุฑุณุงู ฺฉูุฏ.")
        return
    
    user_data[user_id] = {
        "message_place_id": place_id,
        "message_owner_id": place_owner_id,
        "message_place_title": place_title
    }
    
    bot.send_message(user_id, "ูุทูุงู ูพุงู ฺฉู ูโุฎูุงูุฏ ุจุฑุง ุตุงุญุจ ูฺฉุงู ุงุฑุณุงู ฺฉูุฏ ุฑุง ูุงุฑุฏ ฺฉูุฏ:", reply_markup=back_menu())
    user_states[user_id] = "waiting_for_message_text"

@bot.message_handler(func=lambda message: user_states.get(message.from_user.id) == "waiting_for_message_text")
def handle_message_text_input(message):
    user_id = message.from_user.id
    
    if message.text == f"{EMOJIS['back']} ุจุฑฺฏุดุช":
        bot.send_message(user_id, "ุงุฑุณุงู ูพุงู ูุบู ุดุฏ.", reply_markup=places_menu())
        user_states[user_id] = None
        return
    
    message_text = message.text
    place_id = user_data[user_id]["message_place_id"]
    place_owner_id = user_data[user_id]["message_owner_id"]
    place_title = user_data[user_id]["message_place_title"]
    
    # ุงุฑุณุงู ูพุงู ุจู ุตุงุญุจ ูฺฉุงู
    sender_user = get_user(user_id)
    sender_name = sender_user[1] if sender_user else "ูุงุดูุงุณ"
    sender_age = sender_user[2] if sender_user and sender_user[2] else "ูุงูุดุฎุต"
    sender_gender = sender_user[3] if sender_user and sender_user[3] else "ูุงูุดุฎุต"
    sender_numeric_id = sender_user[5] if sender_user else "ูุงูุดุฎุต"
    
    message_to_owner = f"""
{EMOJIS['message']} ูพุงู ุฌุฏุฏ ุงุฒ ฺฉุงุฑุจุฑ:

ุงุฒ: {sender_name} ({sender_age} ุณุงูุ {sender_gender})
ุจุฑุง ูฺฉุงู: {place_title}

ูุชู ูพุงู:
{message_text}

ุดูุงุณู ุนุฏุฏ ฺฉุงุฑุจุฑ: {sender_numeric_id}
    """
    
    # ุงุฌุงุฏ ุฏฺฉููโูุง ูพุงุณุฎุ ุจูุงฺฉ ู ุขูุจูุงฺฉ
    keyboard = types.InlineKeyboardMarkup()
    keyboard.row(
        types.InlineKeyboardButton(f"{EMOJIS['reply']} ูพุงุณุฎ", callback_data=f"reply_{user_id}_{place_id}"),
        types.InlineKeyboardButton(f"{EMOJIS['block']} ุจูุงฺฉ", callback_data=f"block_{user_id}_{place_id}")
    )
    keyboard.row(
        types.InlineKeyboardButton(f"{EMOJIS['unblock']} ุขูุจูุงฺฉ", callback_data=f"unblock_{user_id}_{place_id}")
    )
    
    bot.send_message(place_owner_id, message_to_owner, reply_markup=keyboard)
    
    # ุชุฃุฏ ุจู ฺฉุงุฑุจุฑ
    bot.send_message(user_id, f"{EMOJIS['success']} ูพุงู ุดูุง ุจุง ููููุช ุงุฑุณุงู ุดุฏ!", reply_markup=places_menu())
    
    user_states[user_id] = None

@bot.callback_query_handler(func=lambda call: call.data.startswith('reply_'))
def handle_reply_callback(call):
    user_id = call.from_user.id
    data_parts = call.data.split('_')
    target_user_id = int(data_parts[1])
    place_id = int(data_parts[2])
    
    conn = sqlite3.connect(DB_NAME)
    c = conn.cursor()
    c.execute("SELECT title FROM places WHERE place_id = ?", (place_id,))
    place = c.fetchone()
    conn.close()
    
    if place:
        place_title = place[0]
        
        user_data[user_id] = {
            "reply_target_id": target_user_id,
            "reply_place_id": place_id,
            "reply_place_title": place_title
        }
        
        bot.send_message(user_id, "ูุทูุงู ูพุงุณุฎ ุฎูุฏ ุฑุง ูุงุฑุฏ ฺฉูุฏ:", reply_markup=back_menu())
        user_states[user_id] = "waiting_for_reply_text"

@bot.message_handler(func=lambda message: user_states.get(message.from_user.id) == "waiting_for_reply_text")
def handle_reply_text_input(message):
    user_id = message.from_user.id
    
    if message.text == f"{EMOJIS['back']} ุจุฑฺฏุดุช":
        bot.send_message(user_id, "ุงุฑุณุงู ูพุงุณุฎ ูุบู ุดุฏ.")
        user_states[user_id] = None
        return
    
    reply_text = message.text
    target_user_id = user_data[user_id]["reply_target_id"]
    place_id = user_data[user_id]["reply_place_id"]
    place_title = user_data[user_id]["reply_place_title"]
    
    # ุงุฑุณุงู ูพุงุณุฎ ุจู ฺฉุงุฑุจุฑ
    replier_user = get_user(user_id)
    replier_name = replier_user[1] if replier_user else "ูุงุดูุงุณ"
    replier_age = replier_user[2] if replier_user and replier_user[2] else "ูุงูุดุฎุต"
    replier_gender = replier_user[3] if replier_user and replier_user[3] else "ูุงูุดุฎุต"
    
    reply_message = f"""
{EMOJIS['message']} ูพุงุณุฎ ุงุฒ ุตุงุญุจ ูฺฉุงู:

ุงุฒ: {replier_name} ({replier_age} ุณุงูุ {replier_gender})
ุจุฑุง ูฺฉุงู: {place_title}

ูุชู ูพุงุณุฎ:
{reply_text}
    """
    
    bot.send_message(target_user_id, reply_message)
    
    # ุชุฃุฏ ุจู ุตุงุญุจ ูฺฉุงู
    bot.send_message(user_id, f"{EMOJIS['success']} ูพุงุณุฎ ุดูุง ุจุง ููููุช ุงุฑุณุงู ุดุฏ!")
    
    user_states[user_id] = None

@bot.callback_query_handler(func=lambda call: call.data.startswith('block_'))
def handle_block_callback(call):
    user_id = call.from_user.id
    data_parts = call.data.split('_')
    target_user_id = int(data_parts[1])
    place_id = int(data_parts[2])
    
    conn = sqlite3.connect(DB_NAME)
    c = conn.cursor()
    c.execute("SELECT title FROM places WHERE place_id = ?", (place_id,))
    place = c.fetchone()
    conn.close()
    
    if place:
        place_title = place[0]
        
        # ุจูุงฺฉ ฺฉุฑุฏู ฺฉุงุฑุจุฑ
        block_contact(user_id, target_user_id, place_id)
        
        # ุงุทูุงุน ุจู ุตุงุญุจ ูฺฉุงู
        bot.send_message(user_id, f"{EMOJIS['success']} ฺฉุงุฑุจุฑ ุจุง ููููุช ุจูุงฺฉ ุดุฏ. ุงู ฺฉุงุฑุจุฑ ุฏฺฏุฑ ููโุชูุงูุฏ ุจุฑุง ูฺฉุงู '{place_title}' ูพุงู ุงุฑุณุงู ฺฉูุฏ.")
        
        # ุงุทูุงุน ุจู ฺฉุงุฑุจุฑ ุจูุงฺฉ ุดุฏู
        blocked_user = get_user(target_user_id)
        if blocked_user:
            blocked_name = blocked_user[1]
            bot.send_message(target_user_id, f"{EMOJIS['warning']} ุดูุง ุชูุณุท ุตุงุญุจ ูฺฉุงู '{place_title}' ุจูุงฺฉ ุดุฏูโุงุฏ ู ุฏฺฏุฑ ููโุชูุงูุฏ ุจุฑุง ุงู ูฺฉุงู ูพุงู ุงุฑุณุงู ฺฉูุฏ.")

@bot.callback_query_handler(func=lambda call: call.data.startswith('unblock_'))
def handle_unblock_callback(call):
    user_id = call.from_user.id
    data_parts = call.data.split('_')
    target_user_id = int(data_parts[1])
    place_id = int(data_parts[2])
    
    conn = sqlite3.connect(DB_NAME)
    c = conn.cursor()
    c.execute("SELECT title FROM places WHERE place_id = ?", (place_id,))
    place = c.fetchone()
    conn.close()
    
    if place:
        place_title = place[0]
        
        # ุขูุจูุงฺฉ ฺฉุฑุฏู ฺฉุงุฑุจุฑ
        unblock_contact(user_id, target_user_id, place_id)
        
        # ุงุทูุงุน ุจู ุตุงุญุจ ูฺฉุงู
        bot.send_message(user_id, f"{EMOJIS['success']} ฺฉุงุฑุจุฑ ุจุง ููููุช ุขูุจูุงฺฉ ุดุฏ. ุงู ฺฉุงุฑุจุฑ ุงฺฉููู ูโุชูุงูุฏ ุจุฑุง ูฺฉุงู '{place_title}' ูพุงู ุงุฑุณุงู ฺฉูุฏ.")
        
        # ุงุทูุงุน ุจู ฺฉุงุฑุจุฑ ุขูุจูุงฺฉ ุดุฏู
        unblocked_user = get_user(target_user_id)
        if unblocked_user:
            unblocked_name = unblocked_user[1]
            bot.send_message(target_user_id, f"{EMOJIS['success']} ุดูุง ุชูุณุท ุตุงุญุจ ูฺฉุงู '{place_title}' ุขูุจูุงฺฉ ุดุฏูโุงุฏ ู ุงฺฉููู ูโุชูุงูุฏ ุจุฑุง ุงู ูฺฉุงู ูพุงู ุงุฑุณุงู ฺฉูุฏ.")

@bot.message_handler(func=lambda message: message.text == f"{EMOJIS['report']} ฺฏุฒุงุฑุด")
def handle_report(message):
    user_id = message.from_user.id
    bot.send_message(user_id, "ูุทูุงู ุงฺฏุฑ ฺฏุฒุงุฑุด ุฏุงุฑุฏ ุจููุณุฏ ุชุง ุจู ุงุฏูู ุงุฑุณุงู ุดูุฏ:", reply_markup=back_menu())
    user_states[user_id] = "waiting_for_report"

@bot.message_handler(func=lambda message: user_states.get(message.from_user.id) == "waiting_for_report")
def handle_report_input(message):
    user_id = message.from_user.id
    
    if message.text == f"{EMOJIS['back']} ุจุฑฺฏุดุช":
        bot.send_message(user_id, "ุงุฑุณุงู ฺฏุฒุงุฑุด ูุบู ุดุฏ.", reply_markup=main_menu(user_id))
        user_states[user_id] = None
        return
    
    report_text = message.text
    
    # ุฐุฎุฑู ฺฏุฒุงุฑุด ุฏุฑ ุฏุชุงุจุณ
    conn = sqlite3.connect(DB_NAME)
    c = conn.cursor()
    c.execute("INSERT INTO reports (user_id, report_text) VALUES (?, ?)", (user_id, report_text))
    conn.commit()
    conn.close()
    
    # ุงุฑุณุงู ฺฏุฒุงุฑุด ุจู ุงุฏูู
    reporter_user = get_user(user_id)
    reporter_name = reporter_user[1] if reporter_user else "ูุงุดูุงุณ"
    reporter_age = reporter_user[2] if reporter_user and reporter_user[2] else "ูุงูุดุฎุต"
    reporter_gender = reporter_user[3] if reporter_user and reporter_user[3] else "ูุงูุดุฎุต"
    reporter_numeric_id = reporter_user[5] if reporter_user else "ูุงูุดุฎุต"
    
    report_message = f"""
{EMOJIS['report']} ฺฏุฒุงุฑุด ุฌุฏุฏ:

ุงุฒ: {reporter_name} ({reporter_age} ุณุงูุ {reporter_gender})
ุดูุงุณู ุนุฏุฏ: {reporter_numeric_id}

ูุชู ฺฏุฒุงุฑุด:
{report_text}
    """
    
    bot.send_message(ADMIN_ID, report_message)
    
    # ุชุฃุฏ ุจู ฺฉุงุฑุจุฑ
    bot.send_message(user_id, f"{EMOJIS['success']} ฺฏุฒุงุฑุด ุดูุง ุจุง ููููุช ุงุฑุณุงู ุดุฏ ู ูพฺฏุฑ ุฎูุงูุฏ ุดุฏ!", reply_markup=main_menu(user_id))
    
    user_states[user_id] = None

@bot.message_handler(func=lambda message: message.text == f"{EMOJIS['buy']} ุฎุฑุฏ ูฺฉุงู ุจุฑุชุฑ")
def handle_buy_top_place(message):
    user_id = message.from_user.id
    
    # ุฏุฑุงูุช ูฺฉุงูโูุง ฺฉุงุฑุจุฑ
    conn = sqlite3.connect(DB_NAME)
    c = conn.cursor()
    c.execute("SELECT place_id, title FROM places WHERE user_id = ?", (user_id,))
    user_places = c.fetchall()
    conn.close()
    
    if not user_places:
        bot.send_message(user_id, f"{EMOJIS['error']} ุดูุง ูฺ ูฺฉุงู ุจุฑุง ุฏุฑุฎูุงุณุช ูุฑุงุฑฺฏุฑ ุฏุฑ ุจุฎุด ุจุฑุชุฑูุง ูุฏุงุฑุฏ.", reply_markup=main_menu(user_id))
        return
    
    # ุงุฌุงุฏ ฺฉุจูุฑุฏ ุจุง ูฺฉุงูโูุง ฺฉุงุฑุจุฑ
    keyboard = types.ReplyKeyboardMarkup(resize_keyboard=True)
    for place in user_places:
        keyboard.row(place[1])
    keyboard.row(f"{EMOJIS['back']} ุจุฑฺฏุดุช")
    
    bot.send_message(user_id, "ูุทูุงู ุงุณู ูฺฉุงู ฺฉู ูโุฎูุงูุฏ ุฏุฑ ุจุฎุด ูฺฉุงูโูุง ุจุฑุชุฑ ูุฑุงุฑ ฺฏุฑุฏ ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ:", reply_markup=keyboard)
    user_states[user_id] = "waiting_for_top_place_selection"

@bot.message_handler(func=lambda message: user_states.get(message.from_user.id) == "waiting_for_top_place_selection")
def handle_top_place_selection(message):
    user_id = message.from_user.id
    
    if message.text == f"{EMOJIS['back']} ุจุฑฺฏุดุช":
        bot.send_message(user_id, "ุฏุฑุฎูุงุณุช ูฺฉุงู ุจุฑุชุฑ ูุบู ุดุฏ.", reply_markup=main_menu(user_id))
        user_states[user_id] = None
        return
    
    place_title = message.text
    
    # ุจุฑุฑุณ ูุฌูุฏ ูฺฉุงู
    conn = sqlite3.connect(DB_NAME)
    c = conn.cursor()
    c.execute("SELECT place_id FROM places WHERE user_id = ? AND title = ?", (user_id, place_title))
    place = c.fetchone()
    conn.close()
    
    if not place:
        bot.send_message(user_id, f"{EMOJIS['error']} ูฺฉุงู ููุฑุฏ ูุธุฑ ุงูุช ูุดุฏ. ูุทูุงู ุงุฒ ุจู ูฺฉุงูโูุง ุฎูุฏ ุงูุชุฎุงุจ ฺฉูุฏ.")
        return
    
    # ุฐุฎุฑู ุฏุฑุฎูุงุณุช
    conn = sqlite3.connect(DB_NAME)
    c = conn.cursor()
    c.execute("INSERT INTO top_place_requests (user_id, place_title) VALUES (?, ?)", (user_id, place_title))
    conn.commit()
    conn.close()
    
    # ุงุฑุณุงู ุฏุฑุฎูุงุณุช ุจู ุงุฏูู
    requester_user = get_user(user_id)
    requester_name = requester_user[1] if requester_user else "ูุงุดูุงุณ"
    requester_age = requester_user[2] if requester_user and requester_user[2] else "ูุงูุดุฎุต"
    requester_gender = requester_user[3] if requester_user and requester_user[3] else "ูุงูุดุฎุต"
    requester_numeric_id = requester_user[5] if requester_user else "ูุงูุดุฎุต"
    
    request_message = f"""
{EMOJIS['buy']} ุฏุฑุฎูุงุณุช ุฌุฏุฏ ุจุฑุง ูฺฉุงู ุจุฑุชุฑ:

ุงุฒ: {requester_name} ({requester_age} ุณุงูุ {requester_gender})
ุดูุงุณู ุนุฏุฏ: {requester_numeric_id}

ุฏุฑุฎูุงุณุช ูุฑุงุฑฺฏุฑ ูฺฉุงู "{place_title}" ุฏุฑ ุจุฎุด ูฺฉุงูโูุง ุจุฑุชุฑ
    """
    
    bot.send_message(ADMIN_ID, request_message)
    
    # ุชุฃุฏ ุจู ฺฉุงุฑุจุฑ
    bot.send_message(user_id, f"{EMOJIS['success']} ุฏุฑุฎูุงุณุช ุดูุง ุจุง ููููุช ุงุฑุณุงู ุดุฏ!", reply_markup=main_menu(user_id))
    
    user_states[user_id] = None

@bot.message_handler(func=lambda message: message.text == f"{EMOJIS['admin']} ุจุฎุด ุงุฏูู")
def handle_admin(message):
    user_id = message.from_user.id
    
    if user_id != ADMIN_ID:
        bot.send_message(user_id, f"{EMOJIS['error']} ุดูุง ุฏุณุชุฑุณ ุจู ุจุฎุด ุงุฏูู ูุฏุงุฑุฏ.", reply_markup=main_menu(user_id))
        return
    
    bot.send_message(user_id, "ุจุฎุด ุงุฏูู:", reply_markup=admin_menu())

@bot.message_handler(func=lambda message: message.text == f"{EMOJIS['add']} ุงุถุงูู ฺฉุฑุฏู ุฑุง")
def handle_add_vote(message):
    user_id = message.from_user.id
    
    if user_id != ADMIN_ID:
        bot.send_message(user_id, f"{EMOJIS['error']} ุดูุง ุฏุณุชุฑุณ ุจู ุงู ุจุฎุด ูุฏุงุฑุฏ.", reply_markup=main_menu(user_id))
        return
    
    bot.send_message(user_id, "ูุทูุงู ุนููุงู ูฺฉุงู ููุฑุฏ ูุธุฑ ุฑุง ูุงุฑุฏ ฺฉูุฏ:", reply_markup=back_menu())
    user_states[user_id] = "waiting_for_vote_place_title"

@bot.message_handler(func=lambda message: user_states.get(message.from_user.id) == "waiting_for_vote_place_title")
def handle_vote_place_title(message):
    user_id = message.from_user.id
    
    if message.text == f"{EMOJIS['back']} ุจุฑฺฏุดุช":
        bot.send_message(user_id, "ุงูุฒูุฏู ุฑุฃ ูุบู ุดุฏ.", reply_markup=admin_menu())
        user_states[user_id] = None
        return
    
    user_data[user_id] = {"vote_place_title": message.text}
    bot.send_message(user_id, "ูุทูุงู ุดูุงุณู ุนุฏุฏ ฺฉุงุฑุจุฑ ุตุงุญุจ ูฺฉุงู ุฑุง ูุงุฑุฏ ฺฉูุฏ (ุนุฏุฏ ุงูฺฏูุณ):", reply_markup=back_menu())
    user_states[user_id] = "waiting_for_vote_user_id"

@bot.message_handler(func=lambda message: user_states.get(message.from_user.id) == "waiting_for_vote_user_id")
def handle_vote_user_id(message):
    user_id = message.from_user.id
    
    if message.text == f"{EMOJIS['back']} ุจุฑฺฏุดุช":
        bot.send_message(user_id, "ุงูุฒูุฏู ุฑุฃ ูุบู ุดุฏ.", reply_markup=admin_menu())
        user_states[user_id] = None
        return
    
    try:
        numeric_id = int(message.text)
        user_data[user_id]["vote_numeric_id"] = numeric_id
        bot.send_message(user_id, "ูุทูุงู ุชุนุฏุงุฏ ุฑุฃโูุง ุฑุง ูุงุฑุฏ ฺฉูุฏ (ุนุฏุฏ ุงูฺฏูุณ):", reply_markup=back_menu())
        user_states[user_id] = "waiting_for_vote_count"
    except ValueError:
        bot.send_message(user_id, "ูุทูุงู ฺฉ ุนุฏุฏ ูุนุชุจุฑ ูุงุฑุฏ ฺฉูุฏ:", reply_markup=back_menu())

@bot.message_handler(func=lambda message: user_states.get(message.from_user.id) == "waiting_for_vote_count")
def handle_vote_count(message):
    user_id = message.from_user.id
    
    if message.text == f"{EMOJIS['back']} ุจุฑฺฏุดุช":
        bot.send_message(user_id, "ุงูุฒูุฏู ุฑุฃ ูุบู ุดุฏ.", reply_markup=admin_menu())
        user_states[user_id] = None
        return
    
    try:
        vote_count = int(message.text)
        if vote_count <= 0:
            bot.send_message(user_id, "ูุทูุงู ุนุฏุฏ ุจุฒุฑฺฏุชุฑ ุงุฒ ุตูุฑ ูุงุฑุฏ ฺฉูุฏ:", reply_markup=back_menu())
            return
        
        user_data[user_id]["vote_count"] = vote_count
        bot.send_message(user_id, "ูุทูุงู ุงูุชุงุฒ ุฑุฃ ุฑุง ูุงุฑุฏ ฺฉูุฏ (ุนุฏุฏ ุจู 0 ุชุง 10ุ ุงูฺฏูุณ):", reply_markup=back_menu())
        user_states[user_id] = "waiting_for_vote_score"
    except ValueError:
        bot.send_message(user_id, "ูุทูุงู ฺฉ ุนุฏุฏ ูุนุชุจุฑ ูุงุฑุฏ ฺฉูุฏ:", reply_markup=back_menu())

@bot.message_handler(func=lambda message: user_states.get(message.from_user.id) == "waiting_for_vote_score")
def handle_vote_score(message):
    user_id = message.from_user.id
    
    if message.text == f"{EMOJIS['back']} ุจุฑฺฏุดุช":
        bot.send_message(user_id, "ุงูุฒูุฏู ุฑุฃ ูุบู ุดุฏ.", reply_markup=admin_menu())
        user_states[user_id] = None
        return
    
    try:
        vote_score = float(message.text)
        if vote_score < 0 or vote_score > 10:
            bot.send_message(user_id, "ูุทูุงู ุนุฏุฏ ุจู 0 ุชุง 10 ูุงุฑุฏ ฺฉูุฏ:", reply_markup=back_menu())
            return
        
        user_data[user_id]["vote_score"] = vote_score
        
        # ููุงุด ุงุทูุงุนุงุช ู ุฏุฑุฎูุงุณุช ุชุฃุฏ
        place_title = user_data[user_id]["vote_place_title"]
        numeric_id = user_data[user_id]["vote_numeric_id"]
        vote_count = user_data[user_id]["vote_count"]
        vote_score = user_data[user_id]["vote_score"]
        
        confirmation_text = f"""
{EMOJIS['info']} ุงุทูุงุนุงุช ุฑุฃ:

ุนููุงู ูฺฉุงู: {place_title}
ุดูุงุณู ุนุฏุฏ ฺฉุงุฑุจุฑ: {numeric_id}
ุชุนุฏุงุฏ ุฑุฃ: {vote_count}
ุงูุชุงุฒ ุฑุฃ: {vote_score}

ุขุง ุงุฒ ุงูุฒูุฏู ุงู ุฑุฃ ุงุทููุงู ุฏุงุฑุฏุ
        """
        
        bot.send_message(user_id, confirmation_text, reply_markup=confirm_menu())
        user_states[user_id] = "waiting_for_vote_confirmation"
    except ValueError:
        bot.send_message(user_id, "ูุทูุงู ฺฉ ุนุฏุฏ ูุนุชุจุฑ ูุงุฑุฏ ฺฉูุฏ:", reply_markup=back_menu())

@bot.message_handler(func=lambda message: user_states.get(message.from_user.id) == "waiting_for_vote_confirmation")
def handle_vote_confirmation(message):
    user_id = message.from_user.id
    
    if message.text == f"{EMOJIS['confirm']} ุชุฃุฏ":
        place_title = user_data[user_id]["vote_place_title"]
        numeric_id = user_data[user_id]["vote_numeric_id"]
        vote_count = user_data[user_id]["vote_count"]
        vote_score = user_data[user_id]["vote_score"]
        
        # ุงูุชู ฺฉุงุฑุจุฑ ุจุฑ ุงุณุงุณ ุดูุงุณู ุนุฏุฏ
        target_user = get_user_by_numeric_id(numeric_id)
        if not target_user:
            bot.send_message(user_id, f"{EMOJIS['error']} ฺฉุงุฑุจุฑ ุจุง ุดูุงุณู ุนุฏุฏ {numeric_id} ุงูุช ูุดุฏ.", reply_markup=admin_menu())
            user_states[user_id] = None
            return
        
        target_user_id = target_user[0]
        
        # ุงูุชู ูฺฉุงู ุจุฑ ุงุณุงุณ ุนููุงู ู ฺฉุงุฑุจุฑ
        conn = sqlite3.connect(DB_NAME)
        c = conn.cursor()
        c.execute("SELECT place_id, rating_sum, rating_count FROM places WHERE user_id = ? AND title = ?", 
                 (target_user_id, place_title))
        place = c.fetchone()
        
        if not place:
            bot.send_message(user_id, f"{EMOJIS['error']} ูฺฉุงู ุจุง ุนููุงู '{place_title}' ุจุฑุง ฺฉุงุฑุจุฑ ุงูุช ูุดุฏ.", reply_markup=admin_menu())
            conn.close()
            user_states[user_id] = None
            return
        
        place_id, current_rating_sum, current_rating_count = place
        
        # ูุญุงุณุจู ุงูุชุงุฒ ุฌุฏุฏ
        new_rating_sum = current_rating_sum + (vote_count * vote_score)
        new_rating_count = current_rating_count + vote_count
        
        # ุจูโุฑูุฒุฑุณุงู ุงูุชุงุฒ ูฺฉุงู
        c.execute("UPDATE places SET rating_sum = ?, rating_count = ? WHERE place_id = ?",
                 (new_rating_sum, new_rating_count, place_id))
        conn.commit()
        conn.close()
        
        # ุงุทูุงุน ุจู ุตุงุญุจ ูฺฉุงู
        new_rating = new_rating_sum / new_rating_count if new_rating_count > 0 else 0
        notification_text = f"""
{EMOJIS['success']} ูฺฉุงู ุดูุง ุจุฑูุฒุฑุณุงู ุดุฏ!

ูฺฉุงู: {place_title}
ุชุนุฏุงุฏ ุฑุฃ ุงุถุงูู ุดุฏู: {vote_count}
ุงูุชุงุฒ ุงุถุงูู ุดุฏู: {vote_score}
ุงูุชุงุฒ ุฌุฏุฏ: {new_rating:.1f} ({new_rating_count} ุฑุฃ)
        """
        
        bot.send_message(target_user_id, notification_text)
        
        # ุชุฃุฏ ุจู ุงุฏูู
        bot.send_message(user_id, f"{EMOJIS['success']} ุฑุฃ ุจุง ููููุช ุงุถุงูู ุดุฏ!", reply_markup=admin_menu())
        
    elif message.text == f"{EMOJIS['cancel']} ุงูุตุฑุงู":
        bot.send_message(user_id, "ุงูุฒูุฏู ุฑุฃ ูุบู ุดุฏ.", reply_markup=admin_menu())
    else:
        bot.send_message(user_id, "ูุทูุงู ฺฉ ุงุฒ ฺฏุฒููโูุง ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ:", reply_markup=confirm_menu())
        return
    
    user_states[user_id] = None

@bot.message_handler(func=lambda message: message.text == f"{EMOJIS['remove_score']} ฺฉู ฺฉุฑุฏู ุฑุง")
def handle_remove_vote(message):
    user_id = message.from_user.id
    
    if user_id != ADMIN_ID:
        bot.send_message(user_id, f"{EMOJIS['error']} ุดูุง ุฏุณุชุฑุณ ุจู ุงู ุจุฎุด ูุฏุงุฑุฏ.", reply_markup=main_menu(user_id))
        return
    
    bot.send_message(user_id, "ูุทูุงู ุนููุงู ูฺฉุงู ููุฑุฏ ูุธุฑ ุฑุง ูุงุฑุฏ ฺฉูุฏ:", reply_markup=back_menu())
    user_states[user_id] = "waiting_for_remove_vote_place_title"

@bot.message_handler(func=lambda message: user_states.get(message.from_user.id) == "waiting_for_remove_vote_place_title")
def handle_remove_vote_place_title(message):
    user_id = message.from_user.id
    
    if message.text == f"{EMOJIS['back']} ุจุฑฺฏุดุช":
        bot.send_message(user_id, "ฺฉุงูุด ุฑุฃ ูุบู ุดุฏ.", reply_markup=admin_menu())
        user_states[user_id] = None
        return
    
    user_data[user_id] = {"remove_vote_place_title": message.text}
    bot.send_message(user_id, "ูุทูุงู ุดูุงุณู ุนุฏุฏ ฺฉุงุฑุจุฑ ุตุงุญุจ ูฺฉุงู ุฑุง ูุงุฑุฏ ฺฉูุฏ (ุนุฏุฏ ุงูฺฏูุณ):", reply_markup=back_menu())
    user_states[user_id] = "waiting_for_remove_vote_user_id"

@bot.message_handler(func=lambda message: user_states.get(message.from_user.id) == "waiting_for_remove_vote_user_id")
def handle_remove_vote_user_id(message):
    user_id = message.from_user.id
    
    if message.text == f"{EMOJIS['back']} ุจุฑฺฏุดุช":
        bot.send_message(user_id, "ฺฉุงูุด ุฑุฃ ูุบู ุดุฏ.", reply_markup=admin_menu())
        user_states[user_id] = None
        return
    
    try:
        numeric_id = int(message.text)
        user_data[user_id]["remove_vote_numeric_id"] = numeric_id
        bot.send_message(user_id, "ูุทูุงู ุชุนุฏุงุฏ ุฑุฃโูุง ฺฉู ูโุฎูุงูุฏ ฺฉู ฺฉูุฏ ุฑุง ูุงุฑุฏ ฺฉูุฏ (ุนุฏุฏ ุงูฺฏูุณ):", reply_markup=back_menu())
        user_states[user_id] = "waiting_for_remove_vote_count"
    except ValueError:
        bot.send_message(user_id, "ูุทูุงู ฺฉ ุนุฏุฏ ูุนุชุจุฑ ูุงุฑุฏ ฺฉูุฏ:", reply_markup=back_menu())

@bot.message_handler(func=lambda message: user_states.get(message.from_user.id) == "waiting_for_remove_vote_count")
def handle_remove_vote_count(message):
    user_id = message.from_user.id
    
    if message.text == f"{EMOJIS['back']} ุจุฑฺฏุดุช":
        bot.send_message(user_id, "ฺฉุงูุด ุฑุฃ ูุบู ุดุฏ.", reply_markup=admin_menu())
        user_states[user_id] = None
        return
    
    try:
        vote_count = int(message.text)
        if vote_count <= 0:
            bot.send_message(user_id, "ูุทูุงู ุนุฏุฏ ุจุฒุฑฺฏุชุฑ ุงุฒ ุตูุฑ ูุงุฑุฏ ฺฉูุฏ:", reply_markup=back_menu())
            return
        
        user_data[user_id]["remove_vote_count"] = vote_count
        bot.send_message(user_id, "ูุทูุงู ุงูุชุงุฒ ุฑุฃโูุง ฺฉู ูโุฎูุงูุฏ ฺฉู ฺฉูุฏ ุฑุง ูุงุฑุฏ ฺฉูุฏ (ุนุฏุฏ ุจู 0 ุชุง 10ุ ุงูฺฏูุณ):", reply_markup=back_menu())
        user_states[user_id] = "waiting_for_remove_vote_score"
    except ValueError:
        bot.send_message(user_id, "ูุทูุงู ฺฉ ุนุฏุฏ ูุนุชุจุฑ ูุงุฑุฏ ฺฉูุฏ:", reply_markup=back_menu())

@bot.message_handler(func=lambda message: user_states.get(message.from_user.id) == "waiting_for_remove_vote_score")
def handle_remove_vote_score(message):
    user_id = message.from_user.id
    
    if message.text == f"{EMOJIS['back']} ุจุฑฺฏุดุช":
        bot.send_message(user_id, "ฺฉุงูุด ุฑุฃ ูุบู ุดุฏ.", reply_markup=admin_menu())
        user_states[user_id] = None
        return
    
    try:
        vote_score = float(message.text)
        if vote_score < 0 or vote_score > 10:
            bot.send_message(user_id, "ูุทูุงู ุนุฏุฏ ุจู 0 ุชุง 10 ูุงุฑุฏ ฺฉูุฏ:", reply_markup=back_menu())
            return
        
        user_data[user_id]["remove_vote_score"] = vote_score
        
        # ููุงุด ุงุทูุงุนุงุช ู ุฏุฑุฎูุงุณุช ุชุฃุฏ
        place_title = user_data[user_id]["remove_vote_place_title"]
        numeric_id = user_data[user_id]["remove_vote_numeric_id"]
        vote_count = user_data[user_id]["remove_vote_count"]
        vote_score = user_data[user_id]["remove_vote_score"]
        
        confirmation_text = f"""
{EMOJIS['info']} ุงุทูุงุนุงุช ฺฉุงูุด ุฑุฃ:

ุนููุงู ูฺฉุงู: {place_title}
ุดูุงุณู ุนุฏุฏ ฺฉุงุฑุจุฑ: {numeric_id}
ุชุนุฏุงุฏ ุฑุฃ: {vote_count}
ุงูุชุงุฒ ุฑุฃ: {vote_score}

ุขุง ุงุฒ ฺฉุงูุด ุงู ุฑุฃ ุงุทููุงู ุฏุงุฑุฏุ
        """
        
        bot.send_message(user_id, confirmation_text, reply_markup=confirm_menu())
        user_states[user_id] = "waiting_for_remove_vote_confirmation"
    except ValueError:
        bot.send_message(user_id, "ูุทูุงู ฺฉ ุนุฏุฏ ูุนุชุจุฑ ูุงุฑุฏ ฺฉูุฏ:", reply_markup=back_menu())

@bot.message_handler(func=lambda message: user_states.get(message.from_user.id) == "waiting_for_remove_vote_confirmation")
def handle_remove_vote_confirmation(message):
    user_id = message.from_user.id
    
    if message.text == f"{EMOJIS['confirm']} ุชุฃุฏ":
        place_title = user_data[user_id]["remove_vote_place_title"]
        numeric_id = user_data[user_id]["remove_vote_numeric_id"]
        vote_count = user_data[user_id]["remove_vote_count"]
        vote_score = user_data[user_id]["remove_vote_score"]
        
        # ุงูุชู ฺฉุงุฑุจุฑ ุจุฑ ุงุณุงุณ ุดูุงุณู ุนุฏุฏ
        target_user = get_user_by_numeric_id(numeric_id)
        if not target_user:
            bot.send_message(user_id, f"{EMOJIS['error']} ฺฉุงุฑุจุฑ ุจุง ุดูุงุณู ุนุฏุฏ {numeric_id} ุงูุช ูุดุฏ.", reply_markup=admin_menu())
            user_states[user_id] = None
            return
        
        target_user_id = target_user[0]
        
        # ุงูุชู ูฺฉุงู ุจุฑ ุงุณุงุณ ุนููุงู ู ฺฉุงุฑุจุฑ
        conn = sqlite3.connect(DB_NAME)
        c = conn.cursor()
        c.execute("SELECT place_id, rating_sum, rating_count FROM places WHERE user_id = ? AND title = ?", 
                 (target_user_id, place_title))
        place = c.fetchone()
        
        if not place:
            bot.send_message(user_id, f"{EMOJIS['error']} ูฺฉุงู ุจุง ุนููุงู '{place_title}' ุจุฑุง ฺฉุงุฑุจุฑ ุงูุช ูุดุฏ.", reply_markup=admin_menu())
            conn.close()
            user_states[user_id] = None
            return
        
        place_id, current_rating_sum, current_rating_count = place
        
        # ุจุฑุฑุณ ุชุนุฏุงุฏ ุฑุฃโูุง ููุฌูุฏ
        if current_rating_count < vote_count:
            bot.send_message(user_id, f"{EMOJIS['error']} ุชุนุฏุงุฏ ุฑุฃโูุง ููุฌูุฏ ({current_rating_count}) ฺฉูุชุฑ ุงุฒ ุชุนุฏุงุฏ ููุฑุฏ ูุธุฑ ุจุฑุง ฺฉุงูุด ({vote_count}) ุงุณุช.", reply_markup=admin_menu())
            conn.close()
            user_states[user_id] = None
            return
        
        # ูุญุงุณุจู ุงูุชุงุฒ ุฌุฏุฏ
        new_rating_sum = max(0, current_rating_sum - (vote_count * vote_score))
        new_rating_count = max(0, current_rating_count - vote_count)
        
        # ุจูโุฑูุฒุฑุณุงู ุงูุชุงุฒ ูฺฉุงู
        c.execute("UPDATE places SET rating_sum = ?, rating_count = ? WHERE place_id = ?",
                 (new_rating_sum, new_rating_count, place_id))
        conn.commit()
        conn.close()
        
        # ุงุทูุงุน ุจู ุตุงุญุจ ูฺฉุงู
        new_rating = new_rating_sum / new_rating_count if new_rating_count > 0 else 0
        notification_text = f"""
{EMOJIS['warning']} ูฺฉุงู ุดูุง ุจุฑูุฒุฑุณุงู ุดุฏ!

ูฺฉุงู: {place_title}
ุชุนุฏุงุฏ ุฑุฃ ฺฉู ุดุฏู: {vote_count}
ุงูุชุงุฒ ฺฉู ุดุฏู: {vote_score}
ุงูุชุงุฒ ุฌุฏุฏ: {new_rating:.1f} ({new_rating_count} ุฑุฃ)
        """
        
        bot.send_message(target_user_id, notification_text)
        
        # ุชุฃุฏ ุจู ุงุฏูู
        bot.send_message(user_id, f"{EMOJIS['success']} ุฑุฃ ุจุง ููููุช ฺฉุงูุด ุงูุช!", reply_markup=admin_menu())
        
    elif message.text == f"{EMOJIS['cancel']} ุงูุตุฑุงู":
        bot.send_message(user_id, "ฺฉุงูุด ุฑุฃ ูุบู ุดุฏ.", reply_markup=admin_menu())
    else:
        bot.send_message(user_id, "ูุทูุงู ฺฉ ุงุฒ ฺฏุฒููโูุง ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ:", reply_markup=confirm_menu())
        return
    
    user_states[user_id] = None

@bot.message_handler(func=lambda message: message.text == f"{EMOJIS['document']} ูุฏุฑุช ูุธุฑุงุช")
def handle_manage_comments(message):
    user_id = message.from_user.id
    
    if user_id != ADMIN_ID:
        bot.send_message(user_id, f"{EMOJIS['error']} ุดูุง ุฏุณุชุฑุณ ุจู ุงู ุจุฎุด ูุฏุงุฑุฏ.", reply_markup=main_menu(user_id))
        return
    
    bot.send_message(user_id, "ูุทูุงู ุนููุงู ูฺฉุงู ููุฑุฏ ูุธุฑ ุฑุง ูุงุฑุฏ ฺฉูุฏ:", reply_markup=back_menu())
    user_states[user_id] = "waiting_for_comment_manage_place_title"

@bot.message_handler(func=lambda message: user_states.get(message.from_user.id) == "waiting_for_comment_manage_place_title")
def handle_comment_manage_place_title(message):
    user_id = message.from_user.id
    
    if message.text == f"{EMOJIS['back']} ุจุฑฺฏุดุช":
        bot.send_message(user_id, "ูุฏุฑุช ูุธุฑุงุช ูุบู ุดุฏ.", reply_markup=admin_menu())
        user_states[user_id] = None
        return
    
    user_data[user_id] = {"comment_manage_place_title": message.text}
    bot.send_message(user_id, "ูุทูุงู ุดูุงุณู ุนุฏุฏ ฺฉุงุฑุจุฑ ุตุงุญุจ ูฺฉุงู ุฑุง ูุงุฑุฏ ฺฉูุฏ (ุนุฏุฏ ุงูฺฏูุณ):", reply_markup=back_menu())
    user_states[user_id] = "waiting_for_comment_manage_user_id"

@bot.message_handler(func=lambda message: user_states.get(message.from_user.id) == "waiting_for_comment_manage_user_id")
def handle_comment_manage_user_id(message):
    user_id = message.from_user.id
    
    if message.text == f"{EMOJIS['back']} ุจุฑฺฏุดุช":
        bot.send_message(user_id, "ูุฏุฑุช ูุธุฑุงุช ูุบู ุดุฏ.", reply_markup=admin_menu())
        user_states[user_id] = None
        return
    
    try:
        numeric_id = int(message.text)
        user_data[user_id]["comment_manage_numeric_id"] = numeric_id
        bot.send_message(user_id, "ูุทูุงู ฺฉููู ุงูู ูุธุฑ ููุฑุฏ ูุธุฑ ุจุฑุง ุญุฐู ุฑุง ูุงุฑุฏ ฺฉูุฏ:", reply_markup=back_menu())
        user_states[user_id] = "waiting_for_comment_first_word"
    except ValueError:
        bot.send_message(user_id, "ูุทูุงู ฺฉ ุนุฏุฏ ูุนุชุจุฑ ูุงุฑุฏ ฺฉูุฏ:", reply_markup=back_menu())

@bot.message_handler(func=lambda message: user_states.get(message.from_user.id) == "waiting_for_comment_first_word")
def handle_comment_first_word(message):
    user_id = message.from_user.id
    
    if message.text == f"{EMOJIS['back']} ุจุฑฺฏุดุช":
        bot.send_message(user_id, "ูุฏุฑุช ูุธุฑุงุช ูุบู ุดุฏ.", reply_markup=admin_menu())
        user_states[user_id] = None
        return
    
    user_data[user_id]["comment_first_word"] = message.text
    bot.send_message(user_id, "ูุทูุงู ุดูุงุณู ุนุฏุฏ ฺฉุงุฑุจุฑ ฺฉู ูุธุฑ ุฑุง ุฏุงุฏู ูุงุฑุฏ ฺฉูุฏ (ุนุฏุฏ ุงูฺฏูุณ):", reply_markup=back_menu())
    user_states[user_id] = "waiting_for_commenter_numeric_id"

@bot.message_handler(func=lambda message: user_states.get(message.from_user.id) == "waiting_for_commenter_numeric_id")
def handle_commenter_numeric_id(message):
    user_id = message.from_user.id
    
    if message.text == f"{EMOJIS['back']} ุจุฑฺฏุดุช":
        bot.send_message(user_id, "ูุฏุฑุช ูุธุฑุงุช ูุบู ุดุฏ.", reply_markup=admin_menu())
        user_states[user_id] = None
        return
    
    try:
        commenter_numeric_id = int(message.text)
        user_data[user_id]["commenter_numeric_id"] = commenter_numeric_id
        
        # ููุงุด ุงุทูุงุนุงุช ู ุฏุฑุฎูุงุณุช ุชุฃุฏ
        place_title = user_data[user_id]["comment_manage_place_title"]
        owner_numeric_id = user_data[user_id]["comment_manage_numeric_id"]
        first_word = user_data[user_id]["comment_first_word"]
        commenter_numeric_id = user_data[user_id]["commenter_numeric_id"]
        
        confirmation_text = f"""
{EMOJIS['info']} ุงุทูุงุนุงุช ุญุฐู ูุธุฑ:

ุนููุงู ูฺฉุงู: {place_title}
ุดูุงุณู ุนุฏุฏ ุตุงุญุจ ูฺฉุงู: {owner_numeric_id}
ฺฉููู ุงูู ูุธุฑ: {first_word}
ุดูุงุณู ุนุฏุฏ ูุธุฑ ุฏููุฏู: {commenter_numeric_id}

ุขุง ุงุฒ ุญุฐู ุงู ูุธุฑ ุงุทููุงู ุฏุงุฑุฏุ
        """
        
        bot.send_message(user_id, confirmation_text, reply_markup=confirm_menu())
        user_states[user_id] = "waiting_for_comment_delete_confirmation"
    except ValueError:
        bot.send_message(user_id, "ูุทูุงู ฺฉ ุนุฏุฏ ูุนุชุจุฑ ูุงุฑุฏ ฺฉูุฏ:", reply_markup=back_menu())

@bot.message_handler(func=lambda message: user_states.get(message.from_user.id) == "waiting_for_comment_delete_confirmation")
def handle_comment_delete_confirmation(message):
    user_id = message.from_user.id
    
    if message.text == f"{EMOJIS['confirm']} ุชุฃุฏ":
        place_title = user_data[user_id]["comment_manage_place_title"]
        owner_numeric_id = user_data[user_id]["comment_manage_numeric_id"]
        first_word = user_data[user_id]["comment_first_word"]
        commenter_numeric_id = user_data[user_id]["commenter_numeric_id"]
        
        # ุงูุชู ุตุงุญุจ ูฺฉุงู ุจุฑ ุงุณุงุณ ุดูุงุณู ุนุฏุฏ
        owner_user = get_user_by_numeric_id(owner_numeric_id)
        if not owner_user:
            bot.send_message(user_id, f"{EMOJIS['error']} ุตุงุญุจ ูฺฉุงู ุจุง ุดูุงุณู ุนุฏุฏ {owner_numeric_id} ุงูุช ูุดุฏ.", reply_markup=admin_menu())
            user_states[user_id] = None
            return
        
        owner_user_id = owner_user[0]
        
        # ุงูุชู ูุธุฑ ุฏููุฏู ุจุฑ ุงุณุงุณ ุดูุงุณู ุนุฏุฏ
        commenter_user = get_user_by_numeric_id(commenter_numeric_id)
        if not commenter_user:
            bot.send_message(user_id, f"{EMOJIS['error']} ูุธุฑ ุฏููุฏู ุจุง ุดูุงุณู ุนุฏุฏ {commenter_numeric_id} ุงูุช ูุดุฏ.", reply_markup=admin_menu())
            user_states[user_id] = None
            return
        
        commenter_user_id = commenter_user[0]
        
        # ุงูุชู ูฺฉุงู ุจุฑ ุงุณุงุณ ุนููุงู ู ุตุงุญุจ
        conn = sqlite3.connect(DB_NAME)
        c = conn.cursor()
        c.execute("SELECT place_id FROM places WHERE user_id = ? AND title = ?", 
                 (owner_user_id, place_title))
        place = c.fetchone()
        
        if not place:
            bot.send_message(user_id, f"{EMOJIS['error']} ูฺฉุงู ุจุง ุนููุงู '{place_title}' ุจุฑุง ฺฉุงุฑุจุฑ ุงูุช ูุดุฏ.", reply_markup=admin_menu())
            conn.close()
            user_states[user_id] = None
            return
        
        place_id = place[0]
        
        # ุงูุชู ูุธุฑ ุจุฑ ุงุณุงุณ ูฺฉุงูุ ูุธุฑ ุฏููุฏู ู ฺฉููู ุงูู
        c.execute("SELECT comment_id, comment_text FROM comments WHERE place_id = ? AND user_id = ? AND comment_text LIKE ?",
                 (place_id, commenter_user_id, f"{first_word}%"))
        comment = c.fetchone()
        
        if not comment:
            bot.send_message(user_id, f"{EMOJIS['error']} ูุธุฑ ุจุง ูุดุฎุตุงุช ูุงุฑุฏ ุดุฏู ุงูุช ูุดุฏ.", reply_markup=admin_menu())
            conn.close()
            user_states[user_id] = None
            return
        
        comment_id, comment_text = comment
        
        # ุญุฐู ูุธุฑ
        c.execute("DELETE FROM comments WHERE comment_id = ?", (comment_id,))
        conn.commit()
        conn.close()
        
        # ุงุทูุงุน ุจู ูุธุฑ ุฏููุฏู
        notification_text = f"""
{EMOJIS['warning']} ูุธุฑ ุดูุง ุญุฐู ุดุฏ!

ูุธุฑ ุดูุง ุฏุฑ ูุธุฑุงุช ูฺฉุงู "{place_title}" ุชูุณุท ุงุฏูู ุจู ุฏูู ููุถ ููุงูู ุญุฐู ุดุฏ.

ูุชู ูุธุฑ ุญุฐู ุดุฏู:
{comment_text}
        """
        
        bot.send_message(commenter_user_id, notification_text)
        
        # ุชุฃุฏ ุจู ุงุฏูู
        bot.send_message(user_id, f"{EMOJIS['success']} ูุธุฑ ุจุง ููููุช ุญุฐู ุดุฏ!", reply_markup=admin_menu())
        
    elif message.text == f"{EMOJIS['cancel']} ุงูุตุฑุงู":
        bot.send_message(user_id, "ุญุฐู ูุธุฑ ูุบู ุดุฏ.", reply_markup=admin_menu())
    else:
        bot.send_message(user_id, "ูุทูุงู ฺฉ ุงุฒ ฺฏุฒููโูุง ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ:", reply_markup=confirm_menu())
        return
    
    user_states[user_id] = None

@bot.message_handler(func=lambda message: message.text == f"{EMOJIS['help']} ุฑุงูููุง")
def handle_help(message):
    user_id = message.from_user.id
    show_help_page(user_id, 1)

def show_help_page(user_id, page):
    if page < 1 or page > len(HELP_PAGES):
        return
    
    bot.send_message(user_id, HELP_PAGES[page-1], reply_markup=help_menu(page))

@bot.message_handler(func=lambda message: message.text == f"{EMOJIS['next']} ุตูุญู ุจุนุฏ")
def handle_next_page(message):
    user_id = message.from_user.id
    
    # ูพุฏุง ฺฉุฑุฏู ุตูุญู ูุนู
    current_page = 1
    if user_id in user_data and "help_page" in user_data[user_id]:
        current_page = user_data[user_id]["help_page"]
    
    next_page = current_page + 1
    if next_page > len(HELP_PAGES):
        next_page = len(HELP_PAGES)
    
    user_data[user_id] = {"help_page": next_page}
    show_help_page(user_id, next_page)

@bot.message_handler(func=lambda message: message.text == f"{EMOJIS['previous']} ุตูุญู ูุจู")
def handle_previous_page(message):
    user_id = message.from_user.id
    
    # ูพุฏุง ฺฉุฑุฏู ุตูุญู ูุนู
    current_page = 1
    if user_id in user_data and "help_page" in user_data[user_id]:
        current_page = user_data[user_id]["help_page"]
    
    prev_page = current_page - 1
    if prev_page < 1:
        prev_page = 1
    
    user_data[user_id] = {"help_page": prev_page}
    show_help_page(user_id, prev_page)

# ููุฏูุฑ ุจุฑุง ูุฏุฑุช ุณุงุฑ ูพุงูโูุง
@bot.message_handler(func=lambda message: True)
def handle_all_messages(message):
    user_id = message.from_user.id
    
    if user_id in user_states:
        # ุงฺฏุฑ ฺฉุงุฑุจุฑ ุฏุฑ ุญุงูุช ุงุณุช ฺฉู ููุชุธุฑ ูุฑูุฏ ุงุณุชุ ุงุฒ ููุฏูุฑูุง ุฎุงุต ุงุณุชูุงุฏู ูโุดูุฏ
        return
    
    # ุงฺฏุฑ ูพุงู ูุชู ูุนููู ุงุณุชุ ููู ุงุตู ุฑุง ูุดุงู ุจุฏู
    show_main_menu(user_id)

if __name__ == '__main__':
    print("Starting bot...")
    app.run(host='0.0.0.0', port=PORT)